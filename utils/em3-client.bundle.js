(function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,t.EasyMediasoup=e()}})(function(){var e=Math.abs,t=Math.min,d=Math.max,c=Math.round,p=Math.pow,l;return function(){function s(d,e,r){function t(o,i){if(!e[o]){if(!d[o]){var l="function"==typeof require&&require;if(!i&&l)return l(o,!0);if(n)return n(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var a=e[o]={exports:{}};d[o][0].call(a.exports,function(e){var r=d[o][1][e];return t(r||e)},a,a.exports,s,d,e,r)}return e[o].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)t(r[a]);return t}return s}()({1:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var n=a(e("@babel/runtime/helpers/classCallCheck")),s=a(e("@babel/runtime/helpers/createClass")),o=a(e("@babel/runtime/helpers/defineProperty")),i=a(e("debug")),d="mediasoup",c=function(){function e(t){(0,n["default"])(this,e),(0,o["default"])(this,"_debug",void 0),(0,o["default"])(this,"_warn",void 0),(0,o["default"])(this,"_error",void 0),t?(this._debug=(0,i["default"])("".concat(d,":").concat(t)),this._warn=(0,i["default"])("".concat(d,":WARN:").concat(t)),this._error=(0,i["default"])("".concat(d,":ERROR:").concat(t))):(this._debug=(0,i["default"])(d),this._warn=(0,i["default"])("".concat(d,":WARN")),this._error=(0,i["default"])("".concat(d,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return(0,s["default"])(e,[{key:"enable",value:function(e){i["default"].enable(e)}},{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}();r["default"]=c},{"@babel/runtime/helpers/classCallCheck":13,"@babel/runtime/helpers/createClass":14,"@babel/runtime/helpers/defineProperty":15,"@babel/runtime/helpers/interopRequireDefault":16,debug:27}],2:[function(e,t,r){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function n(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,m["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var s=e("@babel/runtime/helpers/interopRequireWildcard"),o=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var i=o(e("@babel/runtime/regenerator")),d=o(e("@babel/runtime/helpers/asyncToGenerator")),c=o(e("@babel/runtime/helpers/classCallCheck")),l=o(e("@babel/runtime/helpers/createClass")),m=o(e("@babel/runtime/helpers/defineProperty")),u=o(e("protoo-client")),g=s(e("mediasoup-client")),f=o(e("./Logger")),b=e("./utils"),_=e("./handlers"),h=o(e("./handlers/Stats")),v=o(e("./handlers/Debug")),S=new f["default"]("RoomClient"),y={optional:[{googDscp:!0}]},P=function(){function e(t,r){(0,c["default"])(this,e),(0,m["default"])(this,"emitter",void 0),(0,m["default"])(this,"config",void 0),(0,m["default"])(this,"device",null),(0,m["default"])(this,"closed",!1),(0,m["default"])(this,"protooUrl",void 0),(0,m["default"])(this,"protoo",null),(0,m["default"])(this,"nextDataChannelTestNumber",0),(0,m["default"])(this,"mediasoupDevice",null),(0,m["default"])(this,"sendTransport",null),(0,m["default"])(this,"recvTransport",null),(0,m["default"])(this,"producersHandler",void 0),(0,m["default"])(this,"consumersHandler",void 0),(0,m["default"])(this,"statsHandler",void 0),(0,m["default"])(this,"debugHandler",void 0),(0,m["default"])(this,"peers",{}),(0,m["default"])(this,"autoReconnectTimeout",void 0),(0,m["default"])(this,"reconnectInProgress",!1),(0,m["default"])(this,"me",{displayName:""}),S.debug("constructor() [roomId:\"%s\", peerId:\"%s\"]",t.roomId,t.peerId),this.config=t,this.emitter=r,this.device=t.device||(0,b.deviceInfo)(),this.producersHandler=new _.ProducersHandler(this),this.consumersHandler=new _.ConsumersHandler(this),this.statsHandler=new h["default"](this),this.debugHandler=new v["default"](this),this.me.displayName=this.config.displayName,this.protooUrl=(0,b.getProtooUrl)({mediaServerWss:this.config.mediaServerWss,roomId:this.config.roomId,peerId:this.config.peerId,forceH264:this.config.forceH264,forceVP9:this.config.forceVP9}),this.autoReconnectTimeout=this.config.autoReconnectTimeout||7e3,this.join()}return(0,l["default"])(e,[{key:"close",value:function(){this.closed||(this.closed=!0,S.debug("close()"),this.protoo.close(),this.sendTransport&&this.sendTransport.close(),this.sendTransport=null,this.recvTransport&&this.recvTransport.close(),this.recvTransport=null)}},{key:"reconnect",value:function(){var e=(0,d["default"])(i["default"].mark(function e(){var t=this;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.reconnectInProgress){e.next=2;break}return e.abrupt("return");case 2:this.reconnectInProgress=!0,this.protoo&&this.protoo.connected&&this.close(),this.join(),setTimeout(function(){t.reconnectInProgress=!1;var e=!("onLine"in navigator)||navigator.onLine;S.warn("Reconnecting",{isOnline:e,protooConnected:t.protoo&&t.protoo.connected,recvTransportExists:!!t.recvTransport}),t.emitter.emit("NOTIFICATION",{isOnline:e,protooConnected:t.protoo&&t.protoo.connected,recvTransportExists:!!t.recvTransport}),e&&(!t.protoo||t.protoo.connected)&&t.recvTransport||t.reconnect()},this.autoReconnectTimeout);case 6:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"join",value:function(){var e=(0,d["default"])(i["default"].mark(function e(){var t=this,r;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=new u["default"].WebSocketTransport(this.protooUrl,{retry:{retries:0}}),this.protoo=new u["default"].Peer(r),this.emitter.emit("SET_ROOM_STATE","connecting"),this.protoo.on("open",function(){t.closed=!1,t._joinRoom()}),this.protoo.on("failed",function(){t.emitter.emit("NOTIFICATION",{type:"error",text:"WebSocket connection failed"})}),this.protoo.on("disconnected",function(){t.emitter.emit("NOTIFICATION",{type:"error",text:"WebSocket disconnected"}),t.emitter.emit("SET_ROOM_STATE","disconnected"),t.close()}),this.protoo.on("close",function(){t.closed||(t.emitter.emit("SET_ROOM_STATE","closed"),t.close())}),this.protoo.on("request",function(){var e=(0,d["default"])(i["default"].mark(function e(r,a,s){var o,d,c,l,m,u,g,f,b,_;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:S.debug("proto \"request\" event [method:%s, data:%o]",r.method,r.data),e.t0=r.method,e.next="newConsumer"===e.t0?4:"newDataConsumer"===e.t0?13:39;break;case 4:if(t.config.consume){e.next=7;break}return s(403,"I do not want to consume"),e.abrupt("return");case 7:return e.next=9,t.consumersHandler.createConsumer(r.data);case 9:return o=e.sent,a(),"video"===o.kind&&t.config.audioOnly&&t.consumersHandler._pauseConsumer(o),e.abrupt("break",39);case 13:if(t.config.consume){e.next=16;break}return s(403,"I do not want to data consume"),e.abrupt("return");case 16:if(t.config.useDataChannel){e.next=19;break}return s(403,"I do not want DataChannels"),e.abrupt("return");case 19:return d=r.data,c=d.peerId,l=d.dataProducerId,m=d.id,u=d.sctpStreamParameters,g=d.label,f=d.protocol,b=d.appData,e.prev=20,e.next=23,t.recvTransport.consumeData({id:m,dataProducerId:l,sctpStreamParameters:u,label:g,protocol:f,appData:n({},b,{peerId:c})});case 23:_=e.sent,t.consumersHandler.dataConsumers.set(_.id,_),_.on("transportclose",function(){t.consumersHandler.dataConsumers["delete"](_.id)}),_.on("open",function(){S.debug("DataConsumer \"open\" event")}),_.on("close",function(){S.warn("DataConsumer \"close\" event"),t.consumersHandler.dataConsumers["delete"](_.id),t.emitter.emit("NOTIFICATION",{type:"error",text:"DataConsumer closed"})}),_.on("error",function(e){S.error("DataConsumer \"error\" event:%o",e),t.emitter.emit("NOTIFICATION",{type:"error",text:"DataConsumer error: ".concat(e)})}),_.on("message",function(e){if(S.debug("DataConsumer \"message\" event [streamId:%d]",_.sctpStreamParameters.streamId),e instanceof ArrayBuffer){var r=new DataView(e),a=r.getUint32(0);return a==p(2,32)-1?(S.warn("dataChannelTest finished!"),void(t.nextDataChannelTestNumber=0)):(a>t.nextDataChannelTestNumber&&S.warn("dataChannelTest: %s packets missing",a-t.nextDataChannelTestNumber),void(t.nextDataChannelTestNumber=a+1))}if("string"!=typeof e)return void S.warn("ignoring DataConsumer \"message\" (not a string)");if("data"===_.label){var n=t.peers,s=Object.keys(n).map(function(e){return n[e]}),o=s.find(function(e){return e.dataConsumers.includes(_.id)});o||S.warn("DataConsumer \"message\" from unknown peer"),t.emitter.emit("NOTIFICATION",{type:"dataConsumerRecieveMessage",peer:o,message:e}),t.emitter.emit("onDataMessage",e)}}),t.emitter.emit("ADD_DATA_CONSUMER",{dataConsumer:{id:_.id,sctpStreamParameters:_.sctpStreamParameters,label:_.label,protocol:_.protocol},peerId:c}),a(),e.next=38;break;case 34:e.prev=34,e.t1=e["catch"](20),S.error("\"newDataConsumer\" request failed:%o",e.t1),t.emitter.emit("NOTIFICATION",{type:"error",text:"Error creating a DataConsumer: ".concat(e.t1)});case 38:return e.abrupt("break",39);case 39:case"end":return e.stop();}},e,null,[[20,34]])}));return function(){return e.apply(this,arguments)}}()),this.protoo.on("notification",function(e){switch(S.debug("proto \"notification\" event [method:%s, data:%o]",e.method,e.data),e.method){case"producerManifest":t.emitter.emit("producerManifest",e.data);break;case"debugState":t.debugHandler.handleDebug(e.data);break;case"workerdied":t.emitter.emit("workerdied"),t.close();break;case"WSPROXY_MOVE_START":{t.emitter.emit("WSPROXY_MOVE_START");break}case"WSPROXY_MOVE_END":{t.emitter.emit("WSPROXY_MOVE_END");break}case"internetQuality":{t.emitter.emit("INTERNET_QUALITY",{peer_id:e.data.peer_id,quality:e.data.quality,kick:e.data.kick});break}case"videoorientationchange":{var r=e.data;t.emitter.emit("videoOrientationChange",r);break}case"setPeerStatsInterval":{t.statsHandler.setPeerStatsInterval(e.data);break}case"producerScore":{var a=e.data,s=a.producerId,o=a.score;t.emitter.emit("SET_PRODUCER_SCORE",{producerId:s,score:o});break}case"newPeer":{var i=e.data;t.addPeer(n({},i,{consumers:[],dataConsumers:[]})),t.emitter.emit("NOTIFICATION",{type:"info",text:"".concat(i.displayName," has joined the room")});break}case"peerClosed":{var d=e.data.peerId;t.removePeer(d);break}case"peerDisplayNameChanged":{var c=e.data,p=c.peerId,l=c.displayName,m=c.oldDisplayName,u=t.peers[p];if(!u)throw new Error("no Peer found");u.displayName=l;break}case"consumerClosed":{var g=e.data.consumerId,f=t.consumersHandler.consumers.get(g);if(!f)break;f.close(),t.consumersHandler.consumers["delete"](g);var b=f.appData.peerId;t.emitter.emit("REMOVE_CONSUMER",{consumerId:g,peerId:b});break}case"consumerPaused":{var _=e.data.consumerId,h=t.consumersHandler.consumers.get(_);if(!h)break;t.emitter.emit("SET_CONSUMER_PAUSED",{consumerId:_,originator:"remote"});break}case"consumerResumed":{var v=e.data.consumerId,y=t.consumersHandler.consumers.get(v);if(!y)break;t.emitter.emit("SET_CONSUMER_RESUMED",{consumerId:v,originator:"remote"});break}case"consumerLayersChanged":{var P=e.data,R=P.consumerId,C=P.spatialLayer,k=P.temporalLayer,x=t.consumersHandler.consumers.get(R);if(!x)break;t.emitter.emit("SET_CONSUMER_CURRENT_LAYERS",{consumer:x,spatialLayer:C,temporalLayer:k});break}case"consumerScore":{var T=e.data,M=T.consumerId,w=T.score,D=t.consumersHandler.consumers.get(M);if(!D)break;t.emitter.emit("SET_CONSUMER_SCORE",D);break}case"dataConsumerClosed":{var I=e.data.dataConsumerId,O=t.consumersHandler.dataConsumers.get(I);if(!O)break;O.close(),t.consumersHandler.dataConsumers["delete"](I);var E=O.appData.peerId;t.emitter.emit("REMOVE_DATA_CONSUMER",{dataConsumerId:I,peerId:E,dataConsumer:O});break}case"activeSpeaker":{var L=e.data;t.emitter.emit("SET_ROOM_ACTIVE_SPEAKER",L);break}case"producerCreated":{var F=e.data;t.emitter.emit("PRODUCER_CREATED",F);break}default:S.error("unknown protoo notification.method \"%s\"",e.method);}});case 9:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"enableAudioOnly",value:function(){var e=(0,d["default"])(i["default"].mark(function e(){var t,r,a,n,s,o;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:S.debug("enableAudioOnly()"),this.producersHandler.disableWebcam(),t=!0,r=!1,a=void 0,e.prev=5,n=this.consumersHandler.consumers.values()[Symbol.iterator]();case 7:if(t=(s=n.next()).done){e.next=15;break}if(o=s.value,"video"===o.kind){e.next=11;break}return e.abrupt("continue",12);case 11:this.consumersHandler._pauseConsumer(o);case 12:t=!0,e.next=7;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e["catch"](5),r=!0,a=e.t0;case 21:e.prev=21,e.prev=22,t||null==n["return"]||n["return"]();case 24:if(e.prev=24,!r){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(21);case 29:case"end":return e.stop();}},e,this,[[5,17,21,29],[22,,24,28]])}));return function(){return e.apply(this,arguments)}}()},{key:"disableAudioOnly",value:function(){var e=(0,d["default"])(i["default"].mark(function e(){var t,r,a,n,s,o;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:S.debug("disableAudioOnly()"),!this.producersHandler.webcamProducer&&this.config.produce&&this.producersHandler.enableWebcam(),t=!0,r=!1,a=void 0,e.prev=5,n=this.consumersHandler.consumers.values()[Symbol.iterator]();case 7:if(t=(s=n.next()).done){e.next=15;break}if(o=s.value,"video"===o.kind){e.next=11;break}return e.abrupt("continue",12);case 11:this.consumersHandler._resumeConsumer(o);case 12:t=!0,e.next=7;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e["catch"](5),r=!0,a=e.t0;case 21:e.prev=21,e.prev=22,t||null==n["return"]||n["return"]();case 24:if(e.prev=24,!r){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(21);case 29:case"end":return e.stop();}},e,this,[[5,17,21,29],[22,,24,28]])}));return function(){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=(0,d["default"])(i["default"].mark(function e(){var t,r;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(S.debug("restartIce()"),e.prev=1,!this.sendTransport){e.next=8;break}return e.next=5,this.protoo.request("restartIce",{transportId:this.sendTransport.id});case 5:return t=e.sent,e.next=8,this.sendTransport.restartIce({iceParameters:t});case 8:if(!this.recvTransport){e.next=14;break}return e.next=11,this.protoo.request("restartIce",{transportId:this.recvTransport.id});case 11:return r=e.sent,e.next=14,this.recvTransport.restartIce({iceParameters:r});case 14:this.emitter.emit("NOTIFICATION",{type:"info",text:"ICE restarted"}),e.next=21;break;case 17:e.prev=17,e.t0=e["catch"](1),S.error("restartIce() | failed:%o",e.t0),this.emitter.emit("NOTIFICATION",{type:"error",text:"ICE restart failed: ".concat(e.t0)});case 21:case"end":return e.stop();}},e,this,[[1,17]])}));return function(){return e.apply(this,arguments)}}()},{key:"setMaxSendingSpatialLayer",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(S.debug("setMaxSendingSpatialLayer() [spatialLayer:%s]",t),e.prev=1,!this.producersHandler.webcamProducer){e.next=7;break}return e.next=5,this.producersHandler.webcamProducer.setMaxSpatialLayer(t);case 5:e.next=10;break;case 7:if(!this.producersHandler.shareProducer){e.next=10;break}return e.next=10,this.producersHandler.shareProducer.setMaxSpatialLayer(t);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](1),S.error("setMaxSendingSpatialLayer() | failed:%o",e.t0),this.emitter.emit("NOTIFICATION",{type:"error",text:"Error setting max sending video spatial layer: ".concat(e.t0)});case 16:case"end":return e.stop();}},e,this,[[1,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"requestConsumerKeyFrame",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("requestConsumerKeyFrame() [consumerId:%s]",t),e.prev=1,e.next=4,this.protoo.request("requestConsumerKeyFrame",{consumerId:t});case 4:this.emitter.emit("NOTIFICATION",{text:"Keyframe requested for video consumer"}),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](1),S.error("requestConsumerKeyFrame() | failed:%o",e.t0),this.emitter.emit("NOTIFICATION",{type:"error",text:"Error requesting key frame for Consumer: ".concat(e.t0)});case 11:case"end":return e.stop();}},e,this,[[1,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"changeDisplayName",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("changeDisplayName() [displayName:\"%s\"]",t),e.prev=1,e.next=4,this.protoo.request("changeDisplayName",{displayName:t});case 4:this.me.displayName=t,this.emitter.emit("CHANGE_DISPLAY_NAME",t),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](1),S.error("changeDisplayName() | failed: %o",e.t0),this.emitter.emit("NOTIFICATION",{type:"error",text:"Could not change display name: ".concat(e.t0)});case 12:case"end":return e.stop();}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"applyNetworkThrottle",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){var r,a,n,s;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uplink,a=t.downlink,n=t.rtt,s=t.secret,S.debug("applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",r,a,n),e.prev=2,e.next=5,this.protoo.request("applyNetworkThrottle",{uplink:r,downlink:a,rtt:n,secret:s});case 5:e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](2),S.error("applyNetworkThrottle() | failed:%o",e.t0),this.emitter.emit("NOTIFICATION",{type:"error",text:"Error applying network throttle: ".concat(e.t0)});case 11:case"end":return e.stop();}},e,this,[[2,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"resetNetworkThrottle",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){var r,a,n;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.silent,a=void 0!==r&&r,n=t.secret,S.debug("resetNetworkThrottle()"),e.prev=2,e.next=5,this.protoo.request("resetNetworkThrottle",{secret:n});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](2),a||(S.error("resetNetworkThrottle() | failed:%o",e.t0),this.emitter.emit("NOTIFICATION",{type:"error",text:"Error resetting network throttle: ".concat(e.t0)}));case 10:case"end":return e.stop();}},e,this,[[2,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"_joinRoom",value:function(){var e=(0,d["default"])(i["default"].mark(function e(){var t=this,r,a,s,o,c,p,l,m,u,f,b,_,h,v,P,R,C,k,x,T,M;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(S.debug("_joinRoom()"),this.consumersHandler.consumers.clear(),this.consumersHandler.dataConsumers.clear(),e.prev=3,!this.config.checkPremissionsInAdvance){e.next=9;break}return e.next=7,navigator.mediaDevices.getUserMedia({audio:!0});case 7:return e.next=9,navigator.mediaDevices.getUserMedia({video:!0});case 9:e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](3),console.error(e.t0);case 14:return e.prev=14,this.mediasoupDevice=new g.Device({Handler:this.config.handler}),e.next=18,this.protoo.request("getRouterRtpCapabilities");case 18:return r=e.sent,e.next=21,this.mediasoupDevice.load({routerRtpCapabilities:r});case 21:if(!this.config.produce){e.next=31;break}return e.next=24,this.protoo.request("createWebRtcTransport",{forceTcp:this.config.forceTcp,producing:!0,consuming:!1,isMobile:this.config.isMobile,sctpCapabilities:this.config.useDataChannel?this.mediasoupDevice.sctpCapabilities:void 0});case 24:a=e.sent,s=a.id,o=a.iceParameters,c=a.iceCandidates,p=a.dtlsParameters,l=a.sctpParameters,this.sendTransport=this.mediasoupDevice.createSendTransport({id:s,iceParameters:o,iceServers:this.config.turnservers,iceCandidates:c,dtlsParameters:p,sctpParameters:l,proprietaryConstraints:y}),this.sendTransport.on("connectionstatechange",function(e){return t.emitter.emit("transportConnectionStateChange",{kind:"send",state:e})}),this.sendTransport.on("connect",function(e,r,a){var n=e.dtlsParameters;t.protoo.request("connectWebRtcTransport",{transportId:t.sendTransport.id,dtlsParameters:n}).then(r)["catch"](a)}),this.sendTransport.on("produce",function(){var e=(0,d["default"])(i["default"].mark(function e(r,a,n){var s,o,d,c,p;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.kind,o=r.rtpParameters,d=r.appData,e.prev=1,e.next=4,t.protoo.request("produce",{transportId:t.sendTransport.id,kind:s,rtpParameters:o,appData:d});case 4:c=e.sent,p=c.id,a({id:p}),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),n(e.t0);case 12:case"end":return e.stop();}},e,null,[[1,9]])}));return function(){return e.apply(this,arguments)}}()),this.sendTransport.on("producedata",function(){var e=(0,d["default"])(i["default"].mark(function e(r,a,n){var s,o,d,c,p,l;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.sctpStreamParameters,o=r.label,d=r.protocol,c=r.appData,S.debug("\"producedata\" event: [sctpStreamParameters:%o, appData:%o]",s,c),e.prev=2,e.next=5,t.protoo.request("produceData",{transportId:t.sendTransport.id,sctpStreamParameters:s,label:o,protocol:d,appData:c});case 5:p=e.sent,l=p.id,a({id:l}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),n(e.t0);case 13:case"end":return e.stop();}},e,null,[[2,10]])}));return function(){return e.apply(this,arguments)}}());case 31:if(!this.config.consume){e.next=39;break}return e.next=34,this.protoo.request("createWebRtcTransport",{forceTcp:this.config.forceTcp,producing:!1,consuming:!0,isMobile:this.config.isMobile,sctpCapabilities:this.config.useDataChannel?this.mediasoupDevice.sctpCapabilities:void 0});case 34:m=e.sent,u=m.id,f=m.iceParameters,b=m.iceCandidates,_=m.dtlsParameters,h=m.sctpParameters,this.recvTransport=this.mediasoupDevice.createRecvTransport({id:u,iceServers:this.config.turnservers,iceParameters:f,iceCandidates:b,dtlsParameters:_,sctpParameters:h}),this.recvTransport.on("connectionstatechange",function(e){return t.emitter.emit("transportConnectionStateChange",{kind:"recv",state:e})}),this.recvTransport.on("connect",function(e,r,a){var n=e.dtlsParameters;t.protoo.request("connectWebRtcTransport",{transportId:t.recvTransport.id,dtlsParameters:n}).then(r)["catch"](a)});case 39:return e.next=41,this.protoo.request("join",{displayName:this.me.displayName,customData:this.config.customData,skipConsumers:this.config.skipConsumers,isMobile:this.config.isMobile,device:this.device,rtpCapabilities:this.config.consume?this.mediasoupDevice.rtpCapabilities:void 0,sctpCapabilities:this.config.useDataChannel&&this.config.consume?this.mediasoupDevice.sctpCapabilities:void 0});case 41:for(v=e.sent,P=v.peers,this.emitter.emit("SET_ROOM_STATE","connected"),this.emitter.emit("NOTIFICATION",{text:"You are in the room!",timeout:3e3}),R=!0,C=!1,k=void 0,e.prev=48,x=P[Symbol.iterator]();!(R=(T=x.next()).done);R=!0)M=T.value,this.addPeer(n({},M,{consumers:[],dataConsumers:[]}));e.next=56;break;case 52:e.prev=52,e.t1=e["catch"](48),C=!0,k=e.t1;case 56:e.prev=56,e.prev=57,R||null==x["return"]||x["return"]();case 59:if(e.prev=59,!C){e.next=62;break}throw k;case 62:return e.finish(59);case 63:return e.finish(56);case 64:if(!this.config.produce){e.next=72;break}if(this.config.initialMicMuted){e.next=68;break}return e.next=68,this.producersHandler.enableMic();case 68:if(this.config.initialCamMuted){e.next=71;break}return e.next=71,this.producersHandler.enableWebcam();case 71:this.config.useDataChannel&&this.enableDataProducer();case 72:this.emitter.emit("WSPROXY_MOVE_DONE"),e.next=80;break;case 75:e.prev=75,e.t2=e["catch"](14),S.error("_joinRoom() failed:%o",e.t2),this.emitter.emit("NOTIFICATION",{type:"error",text:"Could not join the room: ".concat(e.t2)}),this.close();case 80:case"end":return e.stop();}},e,this,[[3,11],[14,75],[48,52,56,64],[57,,59,63]])}));return function(){return e.apply(this,arguments)}}()},{key:"addPeer",value:function(e){this.peers,this.peers=n({},this.peers,(0,m["default"])({},e.id,e)),this.emitter.emit("peerAdded",e)}},{key:"removePeer",value:function(e){delete this.peers[e],this.emitter.emit("peerRemoved",e)}},{key:"enableMic",value:function(){return this.producersHandler.enableMic()}},{key:"disableMic",value:function(){return this.producersHandler.disableMic()}},{key:"muteMic",value:function(){return this.producersHandler.muteMic()}},{key:"unmuteMic",value:function(){return this.producersHandler.unmuteMic()}},{key:"enableWebcam",value:function(){return this.producersHandler.enableWebcam()}},{key:"disableWebcam",value:function(){return this.producersHandler.disableWebcam()}},{key:"changeMic",value:function(e){return this.producersHandler.changeMic(e)}},{key:"changeWebcam",value:function(e){return this.producersHandler.changeWebcam(e)}},{key:"changeWebcamResolution",value:function(e){return this.producersHandler.changeWebcamResolution(e)}},{key:"enableCanvasShare",value:function(e){return this.producersHandler.enableCanvasShare(e)}},{key:"disableCanvasShare",value:function(){return this.producersHandler.disableCanvasShare()}},{key:"enableShare",value:function(e){return this.producersHandler.enableShare(e)}},{key:"disableShare",value:function(){return this.producersHandler.disableShare()}},{key:"enableDataProducer",value:function(){return this.producersHandler.enableDataProducer()}},{key:"sendMessage",value:function(e){return this.producersHandler.sendMessage(e)}},{key:"enableConsumer",value:function(e){return this.consumersHandler.enableConsumer(e)}},{key:"disableConsumer",value:function(e){return this.consumersHandler.disableConsumer(e)}},{key:"_pauseConsumer",value:function(e){return this.consumersHandler._pauseConsumer(e)}},{key:"_resumeConsumer",value:function(e){return this.consumersHandler._resumeConsumer(e)}},{key:"setConsumerPreferredLayers",value:function(e,t,r){return this.consumersHandler.setConsumerPreferredLayers(e,t,r)}},{key:"setConsumerPriority",value:function(e,t){return this.consumersHandler.setConsumerPriority(e,t)}},{key:"getPeerStats",value:function(e){return this.statsHandler.getPeerStats(e)}},{key:"getSendTransportRemoteStats",value:function(){return this.statsHandler.getSendTransportRemoteStats()}},{key:"getRecvTransportRemoteStats",value:function(){return this.statsHandler.getRecvTransportRemoteStats()}},{key:"getAudioRemoteStats",value:function(){return this.statsHandler.getAudioRemoteStats()}},{key:"getVideoRemoteStats",value:function(){return this.statsHandler.getVideoRemoteStats()}},{key:"getConsumerRemoteStats",value:function(e){return this.statsHandler.getConsumerRemoteStats(e)}},{key:"getDataProducerRemoteStats",value:function(){return this.statsHandler.getDataProducerRemoteStats()}},{key:"getDataConsumerRemoteStats",value:function(e){return this.statsHandler.getDataConsumerRemoteStats(e)}},{key:"getSendTransportLocalStats",value:function(){return this.statsHandler.getSendTransportLocalStats()}},{key:"getRecvTransportLocalStats",value:function(){return this.statsHandler.getRecvTransportLocalStats()}},{key:"getAudioLocalStats",value:function(){return this.statsHandler.getAudioLocalStats()}},{key:"getVideoLocalStats",value:function(){return this.statsHandler.getVideoLocalStats()}},{key:"getConsumerLocalStats",value:function(e){return this.statsHandler.getConsumerLocalStats(e)}},{key:"getCurrentWebcamResolution",value:function(){return this.producersHandler.webcam.resolution}},{key:"setConsumerState",value:function(e,t,r){return this.consumersHandler.setConsumerState(e,t,r)}},{key:"createConsumerForPeer",value:function(e,t){return this.consumersHandler.createConsumerForPeer(e,t)}},{key:"closeConsumerForPeer",value:function(e,t){return this.consumersHandler.closeConsumerForPeer(e,t)}}]),e}();r["default"]=P},{"./Logger":1,"./handlers":7,"./handlers/Debug":4,"./handlers/Stats":6,"./utils":9,"@babel/runtime/helpers/asyncToGenerator":12,"@babel/runtime/helpers/classCallCheck":13,"@babel/runtime/helpers/createClass":14,"@babel/runtime/helpers/defineProperty":15,"@babel/runtime/helpers/interopRequireDefault":16,"@babel/runtime/helpers/interopRequireWildcard":17,"@babel/runtime/regenerator":23,"mediasoup-client":55,"protoo-client":69}],3:[function(e,t,r){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function n(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,l["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var s=e("@babel/runtime/helpers/interopRequireWildcard"),o=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var i=o(e("@babel/runtime/regenerator")),d=o(e("@babel/runtime/helpers/asyncToGenerator")),c=o(e("@babel/runtime/helpers/classCallCheck")),p=o(e("@babel/runtime/helpers/createClass")),l=o(e("@babel/runtime/helpers/defineProperty")),m=o(e("../Logger")),u=s(e("mediasoup-client")),g=new m["default"]("ConsumersHandler"),f=function(){function e(t){(0,c["default"])(this,e),(0,l["default"])(this,"room",void 0),(0,l["default"])(this,"consumers",new Map),(0,l["default"])(this,"dataConsumers",new Map),this.room=t}return(0,p["default"])(e,[{key:"enableConsumer",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){var r;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(g.debug("enableMicConsumer()"),r=this.consumers.get(t),!r){e.next=5;break}return e.next=5,this._resumeConsumer(r);case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"disableConsumer",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){var r;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(g.debug("disableMicConsumer()"),r=this.consumers.get(t),!r){e.next=5;break}return e.next=5,this._pauseConsumer(r);case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_pauseConsumer",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.room.protoo.request("pauseConsumer",{consumerId:t.id});case 3:t.pause(),this.room.emitter.emit("SET_CONSUMER_PAUSED",{consumerId:t.id,originator:"local"}),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),g.error("_pauseConsumer() | failed:%o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error pausing Consumer: ".concat(e.t0)});case 11:case"end":return e.stop();}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"_resumeConsumer",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.room.protoo.request("resumeConsumer",{consumerId:t.id});case 3:t.resume(),this.room.emitter.emit("SET_CONSUMER_RESUMED",{consumerId:t.id,originator:"local"}),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),g.error("_resumeConsumer() | failed:%o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error resuming Consumer: ".concat(e.t0)});case 11:case"end":return e.stop();}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"setConsumerPreferredLayers",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t,r,a){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g.debug("setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",t,r,a),e.prev=1,e.next=4,this.room.protoo.request("setConsumerPreferredLayers",{consumerId:t,spatialLayer:r,temporalLayer:a});case 4:e.next=10;break;case 6:e.prev=6,e.t0=e["catch"](1),g.error("setConsumerPreferredLayers() | failed:%o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error setting Consumer preferred layers: ".concat(e.t0)});case 10:case"end":return e.stop();}},e,this,[[1,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"setConsumerPriority",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t,r){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return g.debug("setConsumerPriority() [consumerId:%s, priority:%d]",t,r),e.prev=1,e.next=4,this.room.protoo.request("setConsumerPriority",{consumerId:t,priority:r});case 4:this.room.emitter.emit("SET_CONSUMER_PRIORITY",{consumerId:t,priority:r}),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](1),g.error("setConsumerPriority() | failed:%o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error setting Consumer priority: ".concat(e.t0)});case 11:case"end":return e.stop();}},e,this,[[1,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"createConsumer",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t){var r=this,a,s,o,d,c,p,l,m,f,b,_,h,v;return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.peerId,s=t.producerId,o=t.id,d=t.kind,c=t.rtpParameters,p=t.type,l=t.appData,m=t.producerPaused,"audio"===d&&(f={opusStereo:1}),e.prev=2,e.next=5,this.room.recvTransport.consume({id:o,producerId:s,kind:d,rtpParameters:c,appData:n({},l,{peerId:a})});case 5:return b=e.sent,this.consumers.set(b.id,b),b.on("transportclose",function(){r.consumers["delete"](b.id)}),_=u.parseScalabilityMode(b.rtpParameters.encodings[0].scalabilityMode),h=_.spatialLayers,v=_.temporalLayers,this.room.emitter.emit("ADD_CONSUMER",{consumer:{id:b.id,type:p,locallyPaused:!1,remotelyPaused:m,rtpParameters:b.rtpParameters,spatialLayers:h,temporalLayers:v,preferredSpatialLayer:h-1,preferredTemporalLayer:v-1,priority:1,codec:b.rtpParameters.codecs[0].mimeType.split("/")[1],track:b.track,appData:l},peerId:a}),e.abrupt("return",b);case 13:e.prev=13,e.t0=e["catch"](2),g.error("Error: can't create new consumer",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error creating a Consumer: ".concat(e.t0)});case 17:case"end":return e.stop();}},e,this,[[2,13]])}));return function(){return e.apply(this,arguments)}}()},{key:"setConsumerState",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t,r,a){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.room.protoo.request("setConsumerState",{peerId:this.room.config.peerId,targetPeerId:t,sourceType:r,state:a});case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e["catch"](0),g.error("setConsumerState Error: ",e.t0);case 9:case"end":return e.stop();}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"createConsumerForPeer",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t,r){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.room.protoo.request("createConsumerBySourceType",{peerId:this.room.config.peerId,targetPeerId:t,sourceType:r});case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e["catch"](0),g.error("createConsumerForPeer Error: ",e.t0);case 9:case"end":return e.stop();}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"closeConsumerForPeer",value:function(){var e=(0,d["default"])(i["default"].mark(function e(t,r){return i["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.room.protoo.request("closeConsumerBySourceType",{peerId:this.room.config.peerId,targetPeerId:t,sourceType:r});case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e["catch"](0),g.error("closeConsumerForPeer Error: ",e.t0);case 9:case"end":return e.stop();}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()}]),e}();r["default"]=f},{"../Logger":1,"@babel/runtime/helpers/asyncToGenerator":12,"@babel/runtime/helpers/classCallCheck":13,"@babel/runtime/helpers/createClass":14,"@babel/runtime/helpers/defineProperty":15,"@babel/runtime/helpers/interopRequireDefault":16,"@babel/runtime/helpers/interopRequireWildcard":17,"@babel/runtime/regenerator":23,"mediasoup-client":55}],4:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var n=a(e("@babel/runtime/helpers/classCallCheck")),s=a(e("@babel/runtime/helpers/createClass")),o=a(e("@babel/runtime/helpers/defineProperty")),i=a(e("../Logger")),d=new i["default"]("DebugHandler"),c=function(){function e(t){(0,n["default"])(this,e),(0,o["default"])(this,"consumersHandler",void 0),(0,o["default"])(this,"remoteConsumersState",void 0),this.consumersHandler=t.consumersHandler}return(0,s["default"])(e,[{key:"handleDebug",value:function(e){this.remoteConsumersState=e.consumersState,this.fixConsumerStatuses()}},{key:"fixConsumerStatuses",value:function(){var e=!0,t=!1,r=void 0;try{for(var a=this.consumersHandler.consumers.values()[Symbol.iterator](),n;!(e=(n=a.next()).done);e=!0){var s=n.value,o=this.remoteConsumersState[s.id];if(!o)return;s.paused!==o.paused&&(d.warn("Consumers state doesnt match","local",s,"remote",o),s.paused?this.consumersHandler._pauseConsumer(s):this.consumersHandler._resumeConsumer(s))}}catch(e){t=!0,r=e}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw r}}}}]),e}();r["default"]=c},{"../Logger":1,"@babel/runtime/helpers/classCallCheck":13,"@babel/runtime/helpers/createClass":14,"@babel/runtime/helpers/defineProperty":15,"@babel/runtime/helpers/interopRequireDefault":16}],5:[function(e,t,r){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function n(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,p["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var o=s(e("@babel/runtime/regenerator")),i=s(e("@babel/runtime/helpers/asyncToGenerator")),d=s(e("@babel/runtime/helpers/classCallCheck")),c=s(e("@babel/runtime/helpers/createClass")),p=s(e("@babel/runtime/helpers/defineProperty")),l=s(e("../Logger")),m=new l["default"]("ProducersHandler"),u={height:320},g={},f={audio:!1,video:{displaySurface:"monitor",logicalSurface:!0,cursor:!0,width:{max:1920},height:{max:1080},frameRate:{max:30}}},b=[{maxBitrate:18e4,scaleResolutionDownBy:4},{maxBitrate:36e4,scaleResolutionDownBy:2},{maxBitrate:15e5,scaleResolutionDownBy:1}],_=[{scalabilityMode:"S3T3_KEY"}],h=[{scalabilityMode:"S3T3",dtx:!0}],v=function(){function e(t){(0,d["default"])(this,e),(0,p["default"])(this,"room",void 0),(0,p["default"])(this,"defaultVideoResolution",void 0),(0,p["default"])(this,"defaultAudioConstraints",void 0),(0,p["default"])(this,"shareConstrains",void 0),(0,p["default"])(this,"simulcastEncodings",void 0),(0,p["default"])(this,"micProducer",null),(0,p["default"])(this,"webcamProducer",null),(0,p["default"])(this,"shareProducer",null),(0,p["default"])(this,"canvasShareProducer",null),(0,p["default"])(this,"dataProducer",null),(0,p["default"])(this,"webcams",new Map),(0,p["default"])(this,"webcam",void 0),(0,p["default"])(this,"mic",void 0),(0,p["default"])(this,"webcamInProgress",!1),(0,p["default"])(this,"micInProgress",!1),(0,p["default"])(this,"audioEncodings",void 0),this.room=t,this.defaultVideoResolution=this.room.config.defaultResolution||u,this.defaultAudioConstraints=this.room.config.defaultAudioConstraints||g,this.shareConstrains=this.room.config.shareConstrains||f,this.simulcastEncodings=this.room.config.videoEncodings||b,this.audioEncodings=this.room.config.audioEncodings,this.webcam={device:this.room.config.camDeviceId?{deviceId:this.room.config.camDeviceId}:null,resolution:this.room.config.initialCameraResolution||this.defaultVideoResolution},this.mic={device:this.room.config.micDeviceId?{deviceId:this.room.config.micDeviceId}:null},this.room.config.svc&&(_[0].scalabilityMode="".concat(this.room.config.svc,"_KEY"))}return(0,c["default"])(e,[{key:"enableMic",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){var t=this,r,a,s,i;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("enableMic()"),this.room.mediasoupDevice){e.next=4;break}return m.error("enableMic() | this._mediasoupDevice is null"),e.abrupt("return");case 4:if(!(this.micProducer||this.micInProgress)){e.next=6;break}return e.abrupt("return");case 6:if(this.micInProgress=!0,this.room.mediasoupDevice.canProduce("audio")){e.next=10;break}return m.error("enableMic() | cannot produce audio"),e.abrupt("return");case 10:return e.prev=10,m.debug("enableMic() | calling getUserMedia()"),a=this.mic.device?this.mic.device.deviceId:null,s={audio:n({deviceId:{exact:a}},this.defaultAudioConstraints)},a&&"ReactNative"!==this.room.mediasoupDevice.handlerName||delete s.audio.deviceId,e.next=17,navigator.mediaDevices.getUserMedia(s);case 17:return i=e.sent,r=i.getAudioTracks()[0],e.next=21,this.room.sendTransport.produce({track:r,codecOptions:{opusStereo:!0,opusDtx:!0},encodings:this.audioEncodings});case 21:this.micProducer=e.sent,this.micProducer.on("transportclose",function(){t.micProducer=null}),this.micProducer.on("trackended",function(){t.room.emitter.emit("NOTIFICATION",{type:"error",text:"Microphone disconnected!"}),t.disableMic()["catch"](function(){})}),this.micInProgress=!1,this.room.emitter.emit("ADD_PRODUCER",{id:this.micProducer.id,paused:this.micProducer.paused,track:this.micProducer.track,rtpParameters:this.micProducer.rtpParameters,codec:this.micProducer.rtpParameters.codecs[0].mimeType.split("/")[1]}),e.next=33;break;case 28:e.prev=28,e.t0=e["catch"](10),m.error("enableMic() | failed:%o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error enabling microphone: ".concat(e.t0)}),r&&r.stop();case 33:return e.prev=33,this.micInProgress=!1,e.finish(33);case 36:case"end":return e.stop();}},e,this,[[10,28,33,36]])}));return function(){return e.apply(this,arguments)}}()},{key:"disableMic",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("disableMic()"),this.micProducer&&!this.micInProgress){e.next=3;break}return e.abrupt("return");case 3:return this.micInProgress=!0,this.micProducer.close(),e.prev=5,e.next=8,this.room.protoo.request("closeProducer",{producerId:this.micProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](5),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error closing server-side mic Producer: ".concat(e.t0)});case 13:this.micInProgress=!1,this.room.emitter.emit("REMOVE_PRODUCER",this.micProducer.id),this.micProducer=null;case 16:case"end":return e.stop();}},e,this,[[5,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"_updateWebcams",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){var t,r,a,n,s,i,d,c,p,l;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m.debug("_updateWebcams()"),this.webcams=new Map,m.debug("_updateWebcams() | calling enumerateDevices()"),e.next=5,navigator.mediaDevices.enumerateDevices();case 5:t=e.sent,r=!0,a=!1,n=void 0,e.prev=9,s=t[Symbol.iterator]();case 11:if(r=(i=s.next()).done){e.next=19;break}if(d=i.value,"videoinput"===d.kind){e.next=15;break}return e.abrupt("continue",16);case 15:this.webcams.set(d.deviceId,d);case 16:r=!0,e.next=11;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e["catch"](9),a=!0,n=e.t0;case 25:e.prev=25,e.prev=26,r||null==s["return"]||s["return"]();case 28:if(e.prev=28,!a){e.next=31;break}throw n;case 31:return e.finish(28);case 32:return e.finish(25);case 33:c=Array.from(this.webcams.values()),p=c.length,l=this.webcam.device?this.webcam.device.deviceId:void 0,m.debug("_updateWebcams() [webcams:%o]",c),0===p?this.webcam.device=null:!this.webcams.has(l)&&(this.webcam.device=c[0]);case 38:case"end":return e.stop();}},e,this,[[9,21,25,33],[26,,28,32]])}));return function(){return e.apply(this,arguments)}}()},{key:"_getWebcamType",value:function(e){return /(back|rear)/i.test(e.label)?(m.debug("_getWebcamType() | it seems to be a back camera"),"back"):(m.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"muteMic",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("muteMic()"),this.micProducer){e.next=3;break}return e.abrupt("return");case 3:return this.micProducer.pause(),e.prev=4,e.next=7,this.room.protoo.request("pauseProducer",{producerId:this.micProducer.id});case 7:this.room.emitter.emit("SET_PRODUCER_PAUSED",this.micProducer),e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](4),m.error("muteMic() | failed: %o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error pausing server-side mic Producer: ".concat(e.t0)});case 14:case"end":return e.stop();}},e,this,[[4,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"unmuteMic",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("unmuteMic()"),this.micProducer){e.next=4;break}return this.enableMic(),e.abrupt("return");case 4:return this.micProducer.resume(),e.prev=5,e.next=8,this.room.protoo.request("resumeProducer",{producerId:this.micProducer.id});case 8:this.room.emitter.emit("SET_PRODUCER_RESUMED",this.micProducer),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](5),m.error("unmuteMic() | failed: %o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error resuming server-side mic Producer: ".concat(e.t0)});case 15:case"end":return e.stop();}},e,this,[[5,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"enableWebcam",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){var t=this,r,a,s,i,d,c,p;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("enableWebcam()"),this.room.mediasoupDevice){e.next=4;break}return m.error("enableWebcam() | this._mediasoupDevice is null"),e.abrupt("return");case 4:if(!(this.webcamProducer||this.webcamInProgress)){e.next=7;break}return m.error("enableWebcam() | webcamProducer || webcamInProgress"),e.abrupt("return");case 7:if(this.room.mediasoupDevice.canProduce("video")){e.next=10;break}return m.error("enableWebcam() | cannot produce video"),e.abrupt("return");case 10:return this.webcamInProgress=!0,e.prev=11,e.next=14,this._updateWebcams();case 14:if(a=this.webcam.device,s=this.webcam.resolution,a){e.next=18;break}throw new Error("no webcam devices");case 18:return m.debug("enableWebcam() | calling getUserMedia()",s),""===a.deviceId?(i="default",console.warn("deviceId is \"\", will use \"default\" instead")):i=a.deviceId,e.next=22,navigator.mediaDevices.getUserMedia({video:n({deviceId:{exact:i}},this.room.config.defaultWebcamConstraints,{},s)});case 22:if(d=e.sent,r=d.getVideoTracks()[0],!this.room.config.useSimulcast){e.next=32;break}return c=this.room.mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video"===e.kind}),p="video/vp9"===c.mimeType.toLowerCase()?_:this.simulcastEncodings,e.next=29,this.room.sendTransport.produce({track:r,encodings:p,codecOptions:{videoGoogleStartBitrate:1e3}});case 29:this.webcamProducer=e.sent,e.next=35;break;case 32:return e.next=34,this.room.sendTransport.produce({track:r});case 34:this.webcamProducer=e.sent;case 35:this.webcamProducer.on("transportclose",function(){t.webcamProducer=null}),this.webcamProducer.on("trackended",function(){t.room.emitter.emit("NOTIFICATION",{type:"error",text:"Webcam disconnected!"}),t.disableWebcam()["catch"](function(){})}),this.webcamInProgress=!1,this.room.emitter.emit("ADD_PRODUCER",{id:this.webcamProducer.id,deviceLabel:a.label,type:this._getWebcamType(a),paused:this.webcamProducer.paused,track:this.webcamProducer.track,rtpParameters:this.webcamProducer.rtpParameters,codec:this.webcamProducer.rtpParameters.codecs[0].mimeType.split("/")[1]}),e.next=46;break;case 41:e.prev=41,e.t0=e["catch"](11),m.error("enableWebcam() | failed:%o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error enabling webcam: ".concat(e.t0)}),r&&r.stop();case 46:return e.prev=46,this.webcamInProgress=!1,e.finish(46);case 49:case"end":return e.stop();}},e,this,[[11,41,46,49]])}));return function(){return e.apply(this,arguments)}}()},{key:"disableWebcam",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("disableWebcam()"),this.webcamProducer&&!this.webcamInProgress){e.next=3;break}return e.abrupt("return");case 3:return this.webcamInProgress=!0,this.webcamProducer.close(),e.prev=5,e.next=8,this.room.protoo.request("closeProducer",{producerId:this.webcamProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](5),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error closing server-side webcam Producer: ".concat(e.t0)});case 13:this.webcamInProgress=!1,this.room.emitter.emit("REMOVE_PRODUCER",this.webcamProducer.id),this.webcamProducer=null;case 16:case"end":return e.stop();}},e,this,[[5,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"changeMic",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){var t=arguments,r,a,s;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0<t.length&&void 0!==t[0]?t[0]:null,m.debug("changeWebcam()"),!(this.mic.device&&r===this.mic.device.deviceId)){e.next=4;break}return e.abrupt("return");case 4:return this.micInProgress=!0,e.prev=5,r&&this.mic.device?this.mic.device.deviceId=r:r="default",this.micProducer.track.stop(),e.next=10,navigator.mediaDevices.getUserMedia({audio:n({deviceId:{exact:r}},this.defaultAudioConstraints)});case 10:return a=e.sent,s=a.getAudioTracks()[0],e.next=14,this.micProducer.replaceTrack({track:s});case 14:this.micInProgress=!1,this.room.emitter.emit("SET_PRODUCER_TRACK",this.micProducer),e.next=22;break;case 18:e.prev=18,e.t0=e["catch"](5),m.error("changeWebcam() | failed: %o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Could not change webcam: ".concat(e.t0)});case 22:return e.prev=22,this.micInProgress=!1,e.finish(22);case 25:case"end":return e.stop();}},e,this,[[5,18,22,25]])}));return function(){return e.apply(this,arguments)}}()},{key:"changeWebcam",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){var t=arguments,r,a,s,i;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0<t.length&&void 0!==t[0]?t[0]:null,m.debug("changeWebcam()"),!(this.webcam.device&&r===this.webcam.device.deviceId)){e.next=4;break}return e.abrupt("return");case 4:return this.webcamInProgress=!0,e.prev=5,e.next=8,this._updateWebcams();case 8:if(a=this.webcams.get(r),a||(a=this.webcams.get(Object.keys(this.webcams)[0])),this.webcam.device=a,m.debug("changeWebcam() | new selected webcam [device:%o]",this.webcam.device),this.webcam.device){e.next=14;break}throw new Error("no webcam devices");case 14:if(!this.webcamProducer){e.next=25;break}return this.webcamProducer.track.stop(),m.debug("changeWebcam() | calling getUserMedia()"),e.next=19,navigator.mediaDevices.getUserMedia({video:n({deviceId:{exact:this.webcam.device.deviceId}},this.room.config.defaultWebcamConstraints,{},this.webcam.resolution)});case 19:return s=e.sent,i=s.getVideoTracks()[0],e.next=23,this.webcamProducer.replaceTrack({track:i});case 23:this.webcamInProgress=!1,this.room.emitter.emit("SET_PRODUCER_TRACK",this.webcamProducer);case 25:this.webcamInProgress=!1,e.next=32;break;case 28:e.prev=28,e.t0=e["catch"](5),m.error("changeWebcam() | failed: %o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Could not change webcam: ".concat(e.t0)});case 32:return e.prev=32,this.webcamInProgress=!1,e.finish(32);case 35:case"end":return e.stop();}},e,this,[[5,28,32,35]])}));return function(){return e.apply(this,arguments)}}()},{key:"changeWebcamResolution",value:function(){var e=(0,i["default"])(o["default"].mark(function e(t){var r,a;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("changeWebcamResolution()"),this.webcamInProgress=!0,e.prev=2,this.webcam.resolution=t,m.debug("changeWebcamResolution() | calling getUserMedia()"),!this.webcamProducer){e.next=13;break}return e.next=8,navigator.mediaDevices.getUserMedia({video:n({deviceId:{exact:this.webcam.device.deviceId}},this.room.config.defaultWebcamConstraints,{},this.webcam.resolution)});case 8:return r=e.sent,a=r.getVideoTracks()[0],e.next=12,this.webcamProducer.replaceTrack({track:a});case 12:this.room.emitter.emit("SET_PRODUCER",this.webcamProducer);case 13:e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](2),m.error("changeWebcamResolution() | failed: %o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Could not change webcam resolution: ".concat(e.t0)});case 19:this.webcamInProgress=!1;case 20:case"end":return e.stop();}},e,this,[[2,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"enableCanvasShare",value:function(){var e=(0,i["default"])(o["default"].mark(function e(t){var r=this,a,n;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("enableShare()"),this.room.mediasoupDevice){e.next=4;break}return m.error("enableCanvasShare() | this._mediasoupDevice is null"),e.abrupt("return");case 4:if(!this.canvasShareProducer){e.next=6;break}return e.abrupt("return");case 6:if(this.room.mediasoupDevice.canProduce("video")){e.next=9;break}return m.error("enableCanvasShare() | cannot produce video"),e.abrupt("return");case 9:return e.prev=9,m.debug("enableCanvasShare() | calling getUserMedia()"),e.next=13,t.captureStream(this.room.config.canvasShareFPS);case 13:if(n=e.sent,n){e.next=16;break}return e.abrupt("return");case 16:return a=n.getVideoTracks()[0],e.next=19,this.room.sendTransport.produce({track:a,appData:{canvasShare:!0}});case 19:this.canvasShareProducer=e.sent,this.canvasShareProducer.on("transportclose",function(){r.canvasShareProducer=null}),this.canvasShareProducer.on("trackended",function(){r.room.emitter.emit("NOTIFICATION",{type:"error",text:"Canvas share disconnected!"}),r.disableCanvasShare()["catch"](function(){})}),e.next=29;break;case 24:e.prev=24,e.t0=e["catch"](9),m.error("enableCanvasShare() | failed:%o",e.t0),"NotAllowedError"!==e.t0.name&&this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error canvas sharing: ".concat(e.t0)}),a&&a.stop();case 29:case"end":return e.stop();}},e,this,[[9,24]])}));return function(){return e.apply(this,arguments)}}()},{key:"disableCanvasShare",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("disableCanvasShare()"),this.canvasShareProducer){e.next=3;break}return e.abrupt("return");case 3:return this.canvasShareProducer.close(),this.room.emitter.emit("REMOVE_PRODUCER",this.canvasShareProducer.id),e.prev=5,e.next=8,this.room.protoo.request("closeProducer",{producerId:this.canvasShareProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](5),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error closing server-side canvas share Producer: ".concat(e.t0)});case 13:this.canvasShareProducer=null;case 14:case"end":return e.stop();}},e,this,[[5,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"enableShare",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){var t=this,r=arguments,a,s,i,d,c,p,l;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=0<r.length&&void 0!==r[0]?r[0]:{},m.debug("enableShare()"),this.room.mediasoupDevice){e.next=5;break}return m.error("enableShare() | this._mediasoupDevice is null"),e.abrupt("return");case 5:if(!this.shareProducer){e.next=7;break}return e.abrupt("return");case 7:if(this.room.mediasoupDevice.canProduce("video")){e.next=10;break}return m.error("enableShare() | cannot produce video"),e.abrupt("return");case 10:return e.prev=10,m.debug("enableShare() | calling getUserMedia()"),e.next=14,navigator.mediaDevices.getDisplayMedia(this.shareConstrains);case 14:if(i=e.sent,i){e.next=17;break}return e.abrupt("return");case 17:if(s=i.getVideoTracks()[0],d=null,!(s.getSettings&&"function"==typeof s.getSettings)){e.next=24;break}return e.next=22,s.getSettings();case 22:c=e.sent,c&&(d={aspectRatio:c.aspectRatio,frameRate:c.frameRate,width:c.width,height:c.height});case 24:if(!this.room.config.useSharingSimulcast){e.next=32;break}return p=this.room.mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video"===e.kind}),l="video/vp9"===p.mimeType.toLowerCase()?h:this.simulcastEncodings.map(function(e){return n({},e,{dtx:!0})}),e.next=29,this.room.sendTransport.produce({track:s,encodings:l,codecOptions:{videoGoogleStartBitrate:1e3},appData:n({share:!0,params:d},a)});case 29:this.shareProducer=e.sent,e.next=35;break;case 32:return e.next=34,this.room.sendTransport.produce({track:s,appData:n({share:!0,params:d},a)});case 34:this.shareProducer=e.sent;case 35:this.room.emitter.emit("ADD_PRODUCER",{id:this.shareProducer.id,type:"share",paused:this.shareProducer.paused,track:this.shareProducer.track,rtpParameters:this.shareProducer.rtpParameters,codec:this.shareProducer.rtpParameters.codecs[0].mimeType.split("/")[1]}),this.shareProducer.on("transportclose",function(){t.shareProducer=null}),this.shareProducer.on("trackended",function(){t.room.emitter.emit("NOTIFICATION",{type:"error",text:"Share disconnected!"}),t.disableShare()["catch"](function(){})}),e.next=45;break;case 40:e.prev=40,e.t0=e["catch"](10),m.error("enableShare() | failed:%o",e.t0),"NotAllowedError"!==e.t0.name&&this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error sharing: ".concat(e.t0)}),s&&s.stop();case 45:case"end":return e.stop();}},e,this,[[10,40]])}));return function(){return e.apply(this,arguments)}}()},{key:"disableShare",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("disableShare()"),this.shareProducer){e.next=3;break}return e.abrupt("return");case 3:return this.shareProducer.close(),this.room.emitter.emit("REMOVE_PRODUCER",this.shareProducer.id),e.prev=5,e.next=8,this.room.protoo.request("closeProducer",{producerId:this.shareProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](5),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error closing server-side share Producer: ".concat(e.t0)});case 13:this.shareProducer=null;case 14:case"end":return e.stop();}},e,this,[[5,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"enableDataProducer",value:function(){var e=(0,i["default"])(o["default"].mark(function e(){var t=this;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("enableDataProducer()"),this.room.config.useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this.room.sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"data",priority:"medium",appData:{info:"dataProducer"}});case 6:this.dataProducer=e.sent,this.room.emitter.emit("ADD_DATA_PRODUCER",{id:this.dataProducer.id,sctpStreamParameters:this.dataProducer.sctpStreamParameters,label:this.dataProducer.label,protocol:this.dataProducer.protocol}),this.dataProducer.on("transportclose",function(){t.dataProducer=null}),this.dataProducer.on("open",function(){m.debug("dataProducer \"open\" event")}),this.dataProducer.on("close",function(){m.error("data DataProducer \"close\" event"),t.dataProducer=null,t.room.emitter.emit("NOTIFICATION",{type:"error",text:"DataProducer closed"})}),this.dataProducer.on("error",function(e){m.error("dataProducer \"error\" event:%o",e),t.room.emitter.emit("NOTIFICATION",{type:"error",text:"DataProducer error: ".concat(e)})}),this.dataProducer.on("bufferedamountlow",function(){m.debug("DataProducer \"bufferedamountlow\" event")}),e.next=20;break;case 15:throw e.prev=15,e.t0=e["catch"](3),m.error("enable dataProducer() | failed:%o",e.t0),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"Error enabling dataProducer: ".concat(e.t0)}),e.t0;case 20:case"end":return e.stop();}},e,this,[[3,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=(0,i["default"])(o["default"].mark(function e(t){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("sendMessage() [text:\"%s]",t),this.dataProducer){e.next=4;break}return this.room.emitter.emit("NOTIFICATION",{type:"error",text:"No dataProducer"}),e.abrupt("return");case 4:try{this.dataProducer.send(t)}catch(e){m.error("dataProducer.send() failed:%o",e),this.room.emitter.emit("NOTIFICATION",{type:"error",text:"dataProducer.send() failed: ".concat(e)})}case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();r["default"]=v},{"../Logger":1,"@babel/runtime/helpers/asyncToGenerator":12,"@babel/runtime/helpers/classCallCheck":13,"@babel/runtime/helpers/createClass":14,"@babel/runtime/helpers/defineProperty":15,"@babel/runtime/helpers/interopRequireDefault":16,"@babel/runtime/regenerator":23}],6:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var n=a(e("@babel/runtime/regenerator")),s=a(e("@babel/runtime/helpers/asyncToGenerator")),o=a(e("@babel/runtime/helpers/classCallCheck")),i=a(e("@babel/runtime/helpers/createClass")),d=a(e("@babel/runtime/helpers/defineProperty")),c=a(e("../Logger")),p=new c["default"]("StatsHandler"),l=function(){function e(t){(0,o["default"])(this,e),(0,d["default"])(this,"room",void 0),(0,d["default"])(this,"consumersHandler",void 0),(0,d["default"])(this,"producersHandler",void 0),(0,d["default"])(this,"sendPeerStatsInterval",null),(0,d["default"])(this,"sendPeerStatsIntervalTime",void 0),(0,d["default"])(this,"prevPeerStats",{bytesSent:0,bytesReceived:0}),this.room=t,this.consumersHandler=t.consumersHandler,this.producersHandler=t.producersHandler,this.sendPeerStatsIntervalTime=t.config.sendPeerStatsIntervalTime}return(0,i["default"])(e,[{key:"setPeerStatsInterval",value:function(e){var t=this;this.sendPeerStatsIntervalTime=e.interval,clearInterval(this.sendPeerStatsInterval),this.sendPeerStatsInterval=setInterval((0,s["default"])(n["default"].mark(function e(){var r,a,s,o,i,d,c,p,l,m,u,g,f,b,_,h,S,y,P,R;return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.room.sendTransport||!t.room.recvTransport||t.room.sendTransport.closed||t.room.recvTransport.closed){e.next=53;break}return e.next=3,Promise.all([t.room.sendTransport.getStats(),t.room.recvTransport.getStats()]);case 3:for(r=e.sent,a={bytesSent:0,bytesReceived:0},s=!0,o=!1,i=void 0,e.prev=8,d=r[0][Symbol.iterator]();!(s=(c=d.next()).done);s=!0)p=c.value,p[0].includes("RTCTransport")&&(a.bytesSent=p[1].bytesSent);e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](8),o=!0,i=e.t0;case 16:e.prev=16,e.prev=17,s||null==d["return"]||d["return"]();case 19:if(e.prev=19,!o){e.next=22;break}throw i;case 22:return e.finish(19);case 23:return e.finish(16);case 24:for(l=!0,m=!1,u=void 0,e.prev=27,g=r[1][Symbol.iterator]();!(l=(f=g.next()).done);l=!0)b=f.value,b[0].includes("RTCTransport")&&(a.bytesReceived=b[1].bytesReceived);e.next=35;break;case 31:e.prev=31,e.t1=e["catch"](27),m=!0,u=e.t1;case 35:e.prev=35,e.prev=36,l||null==g["return"]||g["return"]();case 38:if(e.prev=38,!m){e.next=41;break}throw u;case 41:return e.finish(38);case 42:return e.finish(35);case 43:_=a.bytesSent-t.prevPeerStats.bytesSent,h=a.bytesReceived-t.prevPeerStats.bytesReceived,(0>_||0>h)&&(_=a.bytesSent,h=a.bytesReceived),S=(1e3*(_/t.sendPeerStatsIntervalTime)).toFixed(),y=(1e3*(h/t.sendPeerStatsIntervalTime)).toFixed(),t.prevPeerStats=a,t.room.protoo.notify("peerStats",{sendBitrate:S,recvBitrate:y}),P=t.getLocalConsumersStatuses(),R=t.getLocalProducersStatuses(),t.room.protoo.notify("debugData",{consumers:P,producers:R});case 53:case"end":return e.stop();}},e,null,[[8,12,16,24],[17,,19,23],[27,31,35,43],[36,,38,42]])})),this.sendPeerStatsIntervalTime)}},{key:"getPeerStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(t){return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.debug("getPeerStats()"),e.abrupt("return",this.room.protoo.request("getPeerStats",{peerId:t}));case 2:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSendTransportRemoteStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(){return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getSendTransportRemoteStats()"),this.room.sendTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.room.protoo.request("getTransportStats",{transportId:this.room.sendTransport.id}));case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getRecvTransportRemoteStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(){return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getRecvTransportRemoteStats()"),this.room.recvTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.room.protoo.request("getTransportStats",{transportId:this.room.recvTransport.id}));case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAudioRemoteStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(){return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getAudioRemoteStats()"),this.producersHandler.micProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.room.protoo.request("getProducerStats",{producerId:this.producersHandler.micProducer.id}));case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getVideoRemoteStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(){var t;return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getVideoRemoteStats()"),t=this.producersHandler.webcamProducer||this.producersHandler.shareProducer,t){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this.room.protoo.request("getProducerStats",{producerId:t.id}));case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getConsumerRemoteStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(t){var r;return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getConsumerRemoteStats()"),r=this.consumersHandler.consumers.get(t),r){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this.room.protoo.request("getConsumerStats",{consumerId:t}));case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getDataProducerRemoteStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(){var t;return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getDataProducerRemoteStats()"),t=this.producersHandler.dataProducer,t){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this.room.protoo.request("getDataProducerStats",{dataProducerId:t.id}));case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getDataConsumerRemoteStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(t){var r;return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getDataConsumerRemoteStats()"),r=this.consumersHandler.dataConsumers.get(t),r){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this.room.protoo.request("getDataConsumerStats",{dataConsumerId:t}));case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSendTransportLocalStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(){return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getSendTransportLocalStats()"),this.room.sendTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.room.sendTransport.getStats());case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getRecvTransportLocalStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(){return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getRecvTransportLocalStats()"),this.room.recvTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.room.recvTransport.getStats());case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAudioLocalStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(){return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getAudioLocalStats()"),this.producersHandler.micProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.producersHandler.micProducer.getStats());case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getVideoLocalStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(){var t;return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.debug("getVideoLocalStats()"),t=this.producersHandler.webcamProducer||this.producersHandler.shareProducer,t){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",t.getStats());case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getConsumerLocalStats",value:function(){var e=(0,s["default"])(n["default"].mark(function e(t){var r;return n["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.consumersHandler.consumers.get(t),r){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getLocalConsumersStatuses",value:function(){return Array.from(this.room.consumersHandler.consumers.values()).map(function(e){var t;return{id:e.id,peerId:null===(t=e.appData)||void 0===t?void 0:t.peerId,closed:e.closed,paused:e.paused,kind:e.kind}})}},{key:"getLocalProducersStatuses",value:function(){var e=this.room.producersHandler.webcamProducer,t=this.room.producersHandler.micProducer,r=this.room.producersHandler.shareProducer,a=this.room.producersHandler.canvasShareProducer;return[e,t,r,a].filter(function(e){return e}).map(function(e){return{id:e.id,closed:e.closed,paused:e.paused,kind:e.kind}})}}]),e}();r["default"]=l},{"../Logger":1,"@babel/runtime/helpers/asyncToGenerator":12,"@babel/runtime/helpers/classCallCheck":13,"@babel/runtime/helpers/createClass":14,"@babel/runtime/helpers/defineProperty":15,"@babel/runtime/helpers/interopRequireDefault":16,"@babel/runtime/regenerator":23}],7:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ConsumersHandler",{enumerable:!0,get:function(){return n["default"]}}),Object.defineProperty(r,"ProducersHandler",{enumerable:!0,get:function(){return s["default"]}}),Object.defineProperty(r,"statsHandler",{enumerable:!0,get:function(){return o["default"]}});var n=a(e("./Consumers")),s=a(e("./Producers")),o=a(e("./Stats"))},{"./Consumers":3,"./Producers":5,"./Stats":6,"@babel/runtime/helpers/interopRequireDefault":16}],8:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireWildcard"),n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.Init=void 0;var s=n(e("@babel/runtime/regenerator")),o=n(e("@babel/runtime/helpers/asyncToGenerator")),i=n(e("@babel/runtime/helpers/toConsumableArray")),d=n(e("@babel/runtime/helpers/classCallCheck")),p=n(e("@babel/runtime/helpers/createClass")),l=n(e("@babel/runtime/helpers/defineProperty")),m=n(e("url-parse")),u=n(e("./Logger")),g=n(e("./RoomClient")),f=n(e("wildemitter")),b=a(e("../package.json")),_=n(e("debug")),h=b.version;console.warn("Easy-mediasoup-v3 client version ".concat(h));var v=function(){function e(t){(0,d["default"])(this,e),(0,l["default"])(this,"initial",!0),(0,l["default"])(this,"emitter",new f["default"]),(0,l["default"])(this,"current_emitter",new f["default"]),(0,l["default"])(this,"new_emitter",new f["default"]),(0,l["default"])(this,"client",void 0),(0,l["default"])(this,"new_client",void 0),(0,l["default"])(this,"logger",new u["default"]),(0,l["default"])(this,"config",void 0),this.config=t;var r=[],a=function(){if("WSPROXY_MOVE_START"===arguments[0])this.logger.debug("WSPROXY_MOVE_START"),this.new_emitter.on("*",n),this.run();else{var e;(e=this.emitter).emit.apply(e,arguments)}}.bind(this),n=function(){if("WSPROXY_MOVE_END"===arguments[0]){this.logger.debug("WSPROXY_MOVE_END"),this.client.close(),this.current_emitter.off(a);var e=!0,t=!1,n=void 0;try{for(var s=r[Symbol.iterator](),o;!(e=(o=s.next()).done);e=!0){var d=o.value,c;(c=this.emitter).emit.apply(c,(0,i["default"])(d))}}catch(e){t=!0,n=e}finally{try{e||null==s["return"]||s["return"]()}finally{if(t)throw n}}r=[],this.new_emitdebugModent_emitter=this.new_emitter,this.new_emitter=new f["default"],this.client=this.new_client}else"WSPROXY_MOVE_DONE"===arguments[0]?(this.logger.debug("WSPROXY_MOVE_DONE"),this.new_client._protoo._transport._ws.send("WSPROXY_MOVE_DONE")):r.push(arguments)}.bind(this);this.current_emitter.on("*",a),this.config.autorun&&this.run()}return(0,p["default"])(e,[{key:"run",value:function(){var e=(0,o["default"])(s["default"].mark(function e(){var t=arguments,r,a,n,o;return s["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!!(0<t.length&&void 0!==t[0])&&t[0],this.logger.debug("run() [environment:%s]",this.config),o=new m["default"]((null===(r=window)||void 0===r||null===(a=r.location)||void 0===a?void 0:a.href)||"",!0),this.config.peerId=this.config.peerId||c(1e8*Math.random()).toString(),this.config.handler=o.query.handler,this.config.useSimulcast=this.config.useSimulcast||"true"==o.query.simulcast,this.config.useSharingSimulcast=this.config.useSharingSimulcast||"true"==o.query.sharingSimulcast,this.config.forceTcp=this.config.forceTcp||"true"===o.query.forceTcp,this.config.produce=!0==this.config.produce,this.config.consume=!0==this.config.consume,this.config.forceH264=this.config.forceH264||"true"===o.query.forceH264,this.config.forceVP9=this.config.forceVP9||"true"===o.query.forceVP9,this.config.svc=this.config.svc||o.query.svc,this.config.useDataChannel=this.config.useDataChannel||"true"===o.query.datachannel,this.config.faceDetection=this.config.faceDetection||"true"===o.query.faceDetection,this.config.externalVideo=this.config.externalVideo||"true"===o.query.externalVideo,this.config.camDeviceId=this.config.camDeviceId||"default",this.config.micDeviceId=this.config.micDeviceId||"default",this.config.initialCamMuted=!0===this.config.initialCamMuted,this.config.initialMicMuted=!0===this.config.initialMicMuted,this.config.customData=this.config.customData||{},this.config.sendPeerStatsIntervalTime=this.config.sendPeerStatsIntervalTime||2e3,this.config.audioOnly=this.config.audioOnly||!1,this.config.debugMode&&_["default"].enable(this.config.debugMode),console.log("Mediasoup config",this.config),this.initial||n?this.client=new g["default"](this.config,this.current_emitter):this.new_client=new g["default"](this.config,this.new_emitter),this.initial=!1;case 27:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();r.Init=v},{"../package.json":88,"./Logger":1,"./RoomClient":2,"@babel/runtime/helpers/asyncToGenerator":12,"@babel/runtime/helpers/classCallCheck":13,"@babel/runtime/helpers/createClass":14,"@babel/runtime/helpers/defineProperty":15,"@babel/runtime/helpers/interopRequireDefault":16,"@babel/runtime/helpers/interopRequireWildcard":17,"@babel/runtime/helpers/toConsumableArray":20,"@babel/runtime/regenerator":23,debug:27,"url-parse":83,wildemitter:87}],9:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.getProtooUrl=function(e){var t=e.mediaServerWss,r=e.roomId,a=e.peerId,n=e.forceH264,s=e.forceVP9;t||console.error("config.media_server_wss don't set.");var o="".concat(t,"/?roomId=").concat(r,"&peerId=").concat(a);return n?o="".concat(o,"&forceH264=true"):s&&(o="".concat(o,"&forceVP9=true")),o},r.deviceInfo=void 0;var n=a(e("bowser"));r.deviceInfo=function(){if(navigator.userAgent){var e=navigator.userAgent,t=n["default"].getParser(e),r;return r=t.satisfies({chrome:">=0",chromium:">=0"})?"chrome":t.satisfies({firefox:">=0"})?"firefox":t.satisfies({safari:">=0"})?"safari":t.satisfies({opera:">=0"})?"opera":t.satisfies({"microsoft edge":">=0"})?"edge":"unknown",{flag:r,name:t.getBrowserName(),version:t.getBrowserVersion()}}}},{"@babel/runtime/helpers/interopRequireDefault":16,bowser:25}],10:[function(e,t){t.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}},{}],11:[function(e,t){var r=e("./arrayLikeToArray");t.exports=function(e){if(Array.isArray(e))return r(e)}},{"./arrayLikeToArray":10}],12:[function(e,t){function r(e,t,r,a,n,s,o){try{var i=e[s](o),d=i.value}catch(e){return void r(e)}i.done?t(d):Promise.resolve(d).then(a,n)}t.exports=function(e){return function(){var t=this,a=arguments;return new Promise(function(n,s){function o(e){r(d,n,s,o,i,"next",e)}function i(e){r(d,n,s,o,i,"throw",e)}var d=e.apply(t,a);o(void 0)})}}},{}],13:[function(e,t){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],14:[function(e,t){function r(e,t){for(var r=0,a;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}t.exports=function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}},{}],15:[function(e,t){function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.exports=r},{}],16:[function(e,t){t.exports=function(e){return e&&e.__esModule?e:{default:e}}},{}],17:[function(e,t){function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function a(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var a={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(a,o,i):a[o]=e[o]}return a["default"]=e,t&&t.set(e,a),a}var n=e("../helpers/typeof");t.exports=a},{"../helpers/typeof":21}],18:[function(e,t){function r(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}t.exports=r},{}],19:[function(e,t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},{}],20:[function(e,t){var r=e("./arrayWithoutHoles"),a=e("./iterableToArray"),n=e("./unsupportedIterableToArray"),s=e("./nonIterableSpread");t.exports=function(e){return r(e)||a(e)||n(e)||s()}},{"./arrayWithoutHoles":11,"./iterableToArray":18,"./nonIterableSpread":19,"./unsupportedIterableToArray":22}],21:[function(e,t){function r(e){"@babel/helpers - typeof";return t.exports="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?r=function(e){return typeof e}:r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r},{}],22:[function(e,t){var r=e("./arrayLikeToArray");t.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(e,t):void 0}}},{"./arrayLikeToArray":10}],23:[function(e,t){t.exports=e("regenerator-runtime")},{"regenerator-runtime":74}],24:[function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,t,r,a){function n(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function o(e){try{d(a.next(e))}catch(t){s(t)}}function i(e){try{d(a["throw"](e))}catch(t){s(t)}}function d(e){e.done?r(e.value):n(e.value).then(o,i)}d((a=a.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});class n{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=e,this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(e,t){return a(this,void 0,void 0,function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if("function"!=typeof e)throw new TypeError("given task is not a function");if(!e.name&&t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise((r,a)=>{const n={task:e,name:t,resolve:r,reject:a,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(n),1===this.pendingTasks.length&&this.next()})})}stop(){if(!this.closed){for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){const e=new Date;return this.pendingTasks.map(t=>({task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt.getTime()-t.enqueuedAt.getTime():e.getTime()-t.enqueuedAt.getTime(),executingTime:t.executedAt?e.getTime()-t.executedAt.getTime():0}))}next(){return a(this,void 0,void 0,function*(){const e=this.pendingTasks[0];e&&(yield this.executeTask(e),this.pendingTasks.shift(),this.next())})}executeTask(e){return a(this,void 0,void 0,function*(){if(!e.stopped){e.executedAt=new Date;try{const t=yield e.task();if(e.stopped)return;e.resolve(t)}catch(t){if(e.stopped)return;e.reject(t)}}})}}r.AwaitQueue=n},{}],25:[function(e,r,a){!function(n,e){"object"==typeof a&&"object"==typeof r?r.exports=e():"function"==typeof l&&l.amd?l([],e):"object"==typeof a?a.bowser=e():n.bowser=e()}(this,function(){return function(a){function s(t){if(e[t])return e[t].exports;var r=e[t]={i:t,l:!1,exports:{}};return a[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}var e={};return s.m=a,s.c=e,s.d=function(r,e,t){s.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:t})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(r,a){if(1&a&&(r=s(r)),8&a)return r;if(4&a&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&a&&"string"!=typeof r)for(var n in r)s.d(t,n,function(e){return r[e]}.bind(null,n));return t},s.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return s.d(e,"a",e),e},s.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},s.p="",s(s.s=90)}({17:function(a,e,s){"use strict";e.__esModule=!0,e.default=void 0;var r=s(18),n=function(){function c(){}return c.getFirstMatch=function(a,e){var t=e.match(a);return t&&0<t.length&&t[1]||""},c.getSecondMatch=function(a,e){var t=e.match(a);return t&&1<t.length&&t[2]||""},c.matchAndReturnConst=function(a,e,t){if(a.test(e))return t},c.getWindowsVersionName=function(t){return"NT"===t?"NT":"XP"===t?"XP":"NT 5.0"===t?"2000":"NT 5.1"===t?"XP":"NT 5.2"===t?"2003":"NT 6.0"===t?"Vista":"NT 6.1"===t?"7":"NT 6.2"===t?"8":"NT 6.3"===t?"8.1":"NT 10.0"===t?"10":void 0},c.getMacOSVersionName=function(r){var e=r.split(".").splice(0,2).map(function(t){return parseInt(t,10)||0});if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:}},c.getAndroidVersionName=function(r){var e=r.split(".").splice(0,2).map(function(t){return parseInt(t,10)||0});if(e.push(0),!(1===e[0]&&5>e[1]))return 1===e[0]&&6>e[1]?"Cupcake":1===e[0]&&6<=e[1]?"Donut":2===e[0]&&2>e[1]?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&2<e[1]?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&1>e[1]?"Ice Cream Sandwich":4===e[0]&&4>e[1]?"Jelly Bean":4===e[0]&&4<=e[1]?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},c.getVersionPrecision=function(t){return t.split(".").length},c.compareVersions=function(e,p,r){void 0===r&&(r=!1);var l=c.getVersionPrecision(e),i=c.getVersionPrecision(p),s=d(l,i),m=0,g=c.map([e,p],function(e){var t=s-c.getVersionPrecision(e),r=e+Array(t+1).join(".0");return c.map(r.split("."),function(t){return Array(20-t.length).join("0")+t}).reverse()});for(r&&(m=s-t(l,i)),s-=1;s>=m;){if(g[0][s]>g[1][s])return 1;if(g[0][s]===g[1][s]){if(s===m)return 0;s-=1}else if(g[0][s]<g[1][s])return-1}},c.map=function(a,e){var t=[],n;if(Array.prototype.map)return Array.prototype.map.call(a,e);for(n=0;n<a.length;n+=1)t.push(e(a[n]));return t},c.find=function(a,e){var t,s;if(Array.prototype.find)return Array.prototype.find.call(a,e);for(t=0,s=a.length;t<s;t+=1){var o=a[t];if(e(o,t))return o}},c.assign=function(d){for(var c=d,e=arguments.length,n=Array(1<e?e-1:0),s=1,i,p;s<e;s++)n[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[d].concat(n));var l=function(){var r=n[i];"object"==typeof r&&null!==r&&Object.keys(r).forEach(function(e){c[e]=r[e]})};for(i=0,p=n.length;i<p;i+=1)l();return d},c.getBrowserAlias=function(t){return r.BROWSER_ALIASES_MAP[t]},c.getBrowserTypeByAlias=function(t){return r.BROWSER_MAP[t]||""},c}();e.default=n,a.exports=e.default},18:function(r,e){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(d,e,t){"use strict";function c(a,e){for(var t=0,s;t<e.length;t++)s=e[t],s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(a,s.key,s)}e.__esModule=!0,e.default=void 0;var r=(a=t(91))&&a.__esModule?a:{default:a},o=t(18),s=function(){function a(){}var e,s,i;return a.getParser=function(a,e){if(void 0===e&&(e=!1),"string"!=typeof a)throw new Error("UserAgent should be a string");return new r.default(a,e)},a.parse=function(t){return new r.default(t).getResult()},e=a,i=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(s=null)&&c(e.prototype,s),i&&c(e,i),a}(),a;e.default=s,d.exports=e.default},91:function(c,e,t){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0,e.default=void 0;var p=r(t(92)),n=r(t(93)),i=r(t(94)),s=r(t(95)),m=r(t(17)),a=function(){function r(r,e){if(void 0===e&&(e=!1),null==r||""===r)throw new Error("UserAgent parameter can't be empty");this._ua=r,this.parsedResult={},!0!==e&&this.parse()}var e=r.prototype;return e.getUA=function(){return this._ua},e.test=function(t){return t.test(this._ua)},e.parseBrowser=function(){var r=this;this.parsedResult.browser={};var e=m.default.find(p.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},e.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},e.getBrowserName=function(t){return t?(this.getBrowser().name+"").toLowerCase()||"":this.getBrowser().name||""},e.getBrowserVersion=function(){return this.getBrowser().version},e.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},e.parseOS=function(){var r=this;this.parsedResult.os={};var e=m.default.find(n.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},e.getOSName=function(r){var e=this.getOS().name;return r?(e+"").toLowerCase()||"":e||""},e.getOSVersion=function(){return this.getOS().version},e.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},e.getPlatformType=function(r){void 0===r&&(r=!1);var a=this.getPlatform().type;return r?(a+"").toLowerCase()||"":a||""},e.parsePlatform=function(){var r=this;this.parsedResult.platform={};var e=m.default.find(i.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},e.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},e.getEngineName=function(t){return t?(this.getEngine().name+"").toLowerCase()||"":this.getEngine().name||""},e.parseEngine=function(){var r=this;this.parsedResult.engine={};var e=m.default.find(s.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},e.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},e.getResult=function(){return m.default.assign({},this.parsedResult)},e.satisfies=function(a){var p=this,e={},r=0,g={},i=0;if(Object.keys(a).forEach(function(n){var t=a[n];"string"==typeof t?(g[n]=t,i+=1):"object"==typeof t&&(e[n]=t,r+=1)}),0<r){var t=Object.keys(e),o=m.default.find(t,function(t){return p.isOS(t)});if(o){var u=this.satisfies(e[o]);if(void 0!==u)return u}var d=m.default.find(t,function(t){return p.isPlatform(t)});if(d){var c=this.satisfies(e[d]);if(void 0!==c)return c}}if(0<i){var f=Object.keys(g),l=m.default.find(f,function(t){return p.isBrowser(t,!0)});if(void 0!==l)return this.compareVersion(g[l])}},e.isBrowser=function(a,e){void 0===e&&(e=!1);var s=this.getBrowserName().toLowerCase(),r=a.toLowerCase(),o=m.default.getBrowserTypeByAlias(r);return e&&o&&(r=o.toLowerCase()),r===s},e.compareVersion=function(a){var e=[0],s=a,o=!1,d=this.getBrowserVersion();if("string"==typeof d)return">"===a[0]||"<"===a[0]?(s=a.substr(1),"="===a[1]?(o=!0,s=a.substr(2)):e=[],">"===a[0]?e.push(1):e.push(-1)):"="===a[0]?s=a.substr(1):"~"===a[0]&&(o=!0,s=a.substr(1)),-1<e.indexOf(m.default.compareVersions(d,s,o))},e.isOS=function(t){return this.getOSName(!0)===(t+"").toLowerCase()},e.isPlatform=function(t){return this.getPlatformType(!0)===(t+"").toLowerCase()},e.isEngine=function(t){return this.getEngineName(!0)===(t+"").toLowerCase()},e.is=function(t){return this.isBrowser(t)||this.isOS(t)||this.isPlatform(t)},e.some=function(r){var a=this;return void 0===r&&(r=[]),r.some(function(t){return a.is(t)})},r}();e.default=a,c.exports=e.default},92:function(a,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(s=t(17))&&s.__esModule?s:{default:s},i=/version\/(\d+(\.?_?\d+)+)/i,r=[{test:[/googlebot/i],describe:function(a){var e={name:"Googlebot"},t=d.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/opera/i],describe:function(a){var e={name:"Opera"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/opr\/|opios/i],describe:function(a){var e={name:"Opera"},t=d.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/SamsungBrowser/i],describe:function(a){var e={name:"Samsung Internet for Android"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/Whale/i],describe:function(a){var e={name:"NAVER Whale Browser"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/MZBrowser/i],describe:function(a){var e={name:"MZ Browser"},t=d.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/focus/i],describe:function(a){var e={name:"Focus"},t=d.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/swing/i],describe:function(a){var e={name:"Swing"},t=d.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/coast/i],describe:function(a){var e={name:"Opera Coast"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/yabrowser/i],describe:function(a){var e={name:"Yandex Browser"},t=d.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/ucbrowser/i],describe:function(a){var e={name:"UC Browser"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/Maxthon|mxios/i],describe:function(a){var e={name:"Maxthon"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/epiphany/i],describe:function(a){var e={name:"Epiphany"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/puffin/i],describe:function(a){var e={name:"Puffin"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/sleipnir/i],describe:function(a){var e={name:"Sleipnir"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/k-meleon/i],describe:function(a){var e={name:"K-Meleon"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/micromessenger/i],describe:function(a){var e={name:"WeChat"},t=d.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/qqbrowser/i],describe:function(a){var e={name:/qqbrowserlite/i.test(a)?"QQ Browser Lite":"QQ Browser"},t=d.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/msie|trident/i],describe:function(a){var e={name:"Internet Explorer"},t=d.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/\sedg\//i],describe:function(a){var e={name:"Microsoft Edge"},t=d.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/edg([ea]|ios)/i],describe:function(a){var e={name:"Microsoft Edge"},t=d.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/vivaldi/i],describe:function(a){var e={name:"Vivaldi"},t=d.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/seamonkey/i],describe:function(a){var e={name:"SeaMonkey"},t=d.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/sailfish/i],describe:function(a){var e={name:"Sailfish"},t=d.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,a);return t&&(e.version=t),e}},{test:[/silk/i],describe:function(a){var e={name:"Amazon Silk"},t=d.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/phantom/i],describe:function(a){var e={name:"PhantomJS"},t=d.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/slimerjs/i],describe:function(a){var e={name:"SlimerJS"},t=d.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(a){var e={name:"BlackBerry"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var e={name:"WebOS Browser"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/bada/i],describe:function(a){var e={name:"Bada"},t=d.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/tizen/i],describe:function(a){var e={name:"Tizen"},t=d.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/qupzilla/i],describe:function(a){var e={name:"QupZilla"},t=d.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/firefox|iceweasel|fxios/i],describe:function(a){var e={name:"Firefox"},t=d.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/electron/i],describe:function(a){var e={name:"Electron"},t=d.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/chromium/i],describe:function(a){var e={name:"Chromium"},t=d.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/chrome|crios|crmo/i],describe:function(a){var e={name:"Chrome"},t=d.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/GSA/i],describe:function(a){var e={name:"Google Search"},t=d.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:function(a){var e=!a.test(/like android/i),t=a.test(/android/i);return e&&t},describe:function(a){var e={name:"Android Browser"},t=d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/playstation 4/i],describe:function(a){var e={name:"PlayStation 4"},t=d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/safari|applewebkit/i],describe:function(a){var e={name:"Safari"},t=d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/.*/i],describe:function(r){var e=-1===r.search("\\(")?/^(.*)\/(.*) /:/^(.*)\/(.*)[ \t]\((.*)/;return{name:d.default.getFirstMatch(e,r),version:d.default.getSecondMatch(e,r)}}}],s;e.default=r,a.exports=e.default},93:function(a,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(s=t(17))&&s.__esModule?s:{default:s},i=t(18),r=[{test:[/Roku\/DVP/],describe:function(r){var e=d.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,r);return{name:i.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(r){var e=d.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(a){var e=d.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,a),t=d.default.getWindowsVersionName(e);return{name:i.OS_MAP.Windows,version:e,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(r){var e=d.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,r);return{name:i.OS_MAP.iOS,version:e}}},{test:[/macintosh/i],describe:function(a){var e=d.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,a).replace(/[_\s]/g,"."),t=d.default.getMacOSVersionName(e),r={name:i.OS_MAP.MacOS,version:e};return t&&(r.versionName=t),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(r){var e=d.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,r).replace(/[_\s]/g,".");return{name:i.OS_MAP.iOS,version:e}}},{test:function(a){var e=!a.test(/like android/i),t=a.test(/android/i);return e&&t},describe:function(a){var e=d.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,a),t=d.default.getAndroidVersionName(e),r={name:i.OS_MAP.Android,version:e};return t&&(r.versionName=t),r}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var e=d.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,a),t={name:i.OS_MAP.WebOS};return e&&e.length&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(r){var e=d.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,r)||d.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,r)||d.default.getFirstMatch(/\bbb(\d+)/i,r);return{name:i.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(r){var e=d.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(r){var e=d.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:i.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:i.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(r){var e=d.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.PlayStation4,version:e}}}],s;e.default=r,a.exports=e.default},94:function(a,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(s=t(17))&&s.__esModule?s:{default:s},i=t(18),r=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(a){var e=d.default.getFirstMatch(/(can-l01)/i,a)&&"Nova",t={type:i.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(t.model=e),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(a){var e=a.test(/ipod|iphone/i),t=a.test(/like (ipod|iphone)/i);return e&&!t},describe:function(r){var e=d.default.getFirstMatch(/(ipod|iphone)/i,r);return{type:i.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(r){var e=+(r.getOSVersion()+"").split(".")[0];return"android"===r.getOSName(!0)&&3<=e},describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(t){return"playstation 4"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}},{test:function(t){return"roku"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}}],s;e.default=r,a.exports=e.default},95:function(a,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(s=t(17))&&s.__esModule?s:{default:s},i=t(18),r=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(r){if(/\sedg\//i.test(r))return{name:i.ENGINE_MAP.Blink};var e=d.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,r);return{name:i.ENGINE_MAP.EdgeHTML,version:e}}},{test:[/trident/i],describe:function(a){var e={name:i.ENGINE_MAP.Trident},t=d.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:function(t){return t.test(/presto/i)},describe:function(a){var e={name:i.ENGINE_MAP.Presto},t=d.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:function(a){var e=a.test(/gecko/i),t=a.test(/like gecko/i);return e&&!t},describe:function(a){var e={name:i.ENGINE_MAP.Gecko},t=d.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:i.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(a){var e={name:i.ENGINE_MAP.WebKit},t=d.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}}],s;e.default=r,a.exports=e.default}})})},{}],26:[function(e,t){function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=v(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function a(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function n(e,t,r){if(t)e.call(r);else for(var a=e.length,n=_(e,a),s=0;s<a;++s)n[s].call(r)}function s(e,t,r,a){if(t)e.call(r,a);else for(var n=e.length,s=_(e,n),o=0;o<n;++o)s[o].call(r,a)}function d(e,t,r,a,n){if(t)e.call(r,a,n);else for(var s=e.length,o=_(e,s),d=0;d<s;++d)o[d].call(r,a,n)}function c(e,t,r,a,n,s){if(t)e.call(r,a,n,s);else for(var o=e.length,d=_(e,o),c=0;c<o;++c)d[c].call(r,a,n,s)}function p(e,t,r,a){if(t)e.apply(r,a);else for(var n=e.length,s=_(e,n),o=0;o<n;++o)s[o].apply(r,a)}function l(e,t,r,n){var s,o,i;if("function"!=typeof r)throw new TypeError("\"listener\" argument must be a function");if(o=e._events,o?(o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),i=o[t]):(o=e._events=v(null),e._eventsCount=0),!i)i=o[t]=r,++e._eventsCount;else if("function"==typeof i?i=o[t]=n?[r,i]:[i,r]:n?i.unshift(r):i.push(r),!i.warned&&(s=a(e),s&&0<s&&i.length>s)){i.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+i.length+" \""+(t+"\" listeners added. Use emitter.setMaxListeners() to increase limit."));d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=i.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",d.name,d.message)}return e}function m(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e);}}function u(e,t,r){var a={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=y.call(m,a);return n.listener=r,a.wrapFn=n,n}function g(e,t,r){var a=e._events;if(!a)return[];var n=a[t];return n?"function"==typeof n?r?[n.listener||n]:[n]:r?h(n):_(n,n.length):[]}function f(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function b(e,t){for(var r=t,a=r+1,s=e.length;a<s;r+=1,a+=1)e[r]=e[a];e.pop()}function _(e,t){for(var r=Array(t),a=0;a<t;++a)r[a]=e[a];return r}function h(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}var v=Object.create||function(e){var t=function(){};return t.prototype=e,new t},S=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},y=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var P=10,R;try{var C={};Object.defineProperty&&Object.defineProperty(C,"x",{value:0}),R=0===C.x}catch(e){R=!1}R?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return P},set:function(e){if("number"!=typeof e||0>e||e!==e)throw new TypeError("\"defaultMaxListeners\" must be a positive number");P=e}}):r.defaultMaxListeners=P,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||isNaN(e))throw new TypeError("\"n\" argument must be a positive number");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return a(this)},r.prototype.emit=function(e){var t="error"===e,r,a,o,l,m,u;if(u=this._events,u)t=t&&null==u.error;else if(!t)return!1;if(t){if(1<arguments.length&&(r=arguments[1]),r instanceof Error)throw r;else{var g=new Error("Unhandled \"error\" event. ("+r+")");throw g.context=r,g}return!1}if(a=u[e],!a)return!1;var f="function"==typeof a;switch(o=arguments.length,o){case 1:n(a,f,this);break;case 2:s(a,f,this,arguments[1]);break;case 3:d(a,f,this,arguments[1],arguments[2]);break;case 4:c(a,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(l=Array(o-1),m=1;m<o;m++)l[m-1]=arguments[m];p(a,f,this,l);}return!0},r.prototype.addListener=function(e,t){return l(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return l(this,e,t,!0)},r.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError("\"listener\" argument must be a function");return this.on(e,u(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError("\"listener\" argument must be a function");return this.prependListener(e,u(this,e,t)),this},r.prototype.removeListener=function(e,t){var r,a,n,s,o;if("function"!=typeof t)throw new TypeError("\"listener\" argument must be a function");if(a=this._events,!a)return this;if(r=a[e],!r)return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=v(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;0<=s;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,n=s;break}if(0>n)return this;0===n?r.shift():b(r,n),1===r.length&&(a[e]=r[0]),a.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.removeAllListeners=function(e){var t,r,a;if(r=this._events,!r)return this;if(!r.removeListener)return 0===arguments.length?(this._events=v(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=v(null):delete r[e]),this;if(0===arguments.length){var n=S(r),s;for(a=0;a<n.length;++a)s=n[a],"removeListener"===s||this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=v(null),this._eventsCount=0,this}if(t=r[e],"function"==typeof t)this.removeListener(e,t);else if(t)for(a=t.length-1;0<=a;a--)this.removeListener(e,t[a]);return this},r.prototype.listeners=function(e){return g(this,e,!0)},r.prototype.rawListeners=function(e){return g(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},r.prototype.listenerCount=f,r.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],27:[function(e,t,r){(function(a){function n(){let e;try{e=r.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof a&&"env"in a&&(e=a.env.DEBUG),e}r.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let a=0,n=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"===e||(a++,"%c"===e&&(n=a))}),e.splice(n,0,r)},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=n,r.useColors=function(){return!!("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},r.storage=function(){try{return localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=e("./common")(r);const{formatters:s}=t.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e("_process"))},{"./common":28,_process:64}],28:[function(t,r){r.exports=function(r){function a(t){let r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return n.colors[e(r)%n.colors.length]}function n(e){function t(...e){if(!t.enabled)return;const a=t,s=+new Date,o=s-(r||s);a.diff=o,a.prev=r,a.curr=s,r=s,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,r)=>{if("%%"===t)return t;i++;const s=n.formatters[r];if("function"==typeof s){const r=e[i];t=s.call(a,r),e.splice(i,1),i--}return t}),n.formatArgs.call(a,e);const d=a.log||n.log;d.apply(a,e)}let r;return t.namespace=e,t.enabled=n.enabled(e),t.useColors=n.useColors(),t.color=a(e),t.destroy=s,t.extend=o,"function"==typeof n.init&&n.init(t),n.instances.push(t),t}function s(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function o(e,t){const r=n(this.namespace+("undefined"==typeof t?":":t)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){const e=[...n.names.map(i),...n.skips.map(i).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){n.save(e),n.names=[],n.skips=[];let t;const r=("string"==typeof e?e:"").split(/[\s,]+/),a=r.length;for(t=0;t<a;t++)r[t]&&(e=r[t].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=t("ms"),Object.keys(r).forEach(e=>{n[e]=r[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=a,n.enable(n.load()),n}},{ms:63}],29:[function(e,t,r){function a(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function n(e,t){return e===u?t!==g&&t!==u:t===u?e!==g:e<t}function s(e,t){return n(e,t)?e:t}function o(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}const i=e("debug")("h264-profile-level-id");i.log=console.info.bind(console);const d=1,c=2,p=3,l=4,m=5;r.ProfileConstrainedBaseline=1,r.ProfileBaseline=c,r.ProfileMain=p,r.ProfileConstrainedHigh=l,r.ProfileHigh=m;const u=0,g=10,f=11,b=12,_=13,h=20,v=21,S=22,y=30,P=31,R=32,C=40,k=41,x=42,T=50,M=51,w=52;r.Level1_b=0,r.Level1=g,r.Level1_1=f,r.Level1_2=b,r.Level1_3=_,r.Level2=h,r.Level2_1=v,r.Level2_2=S,r.Level3=y,r.Level3_1=P,r.Level3_2=R,r.Level4=C,r.Level4_1=k,r.Level4_2=x,r.Level5=T,r.Level5_1=M,r.Level5_2=w;class D{constructor(e,t){this.profile=e,this.level=t}}r.ProfileLevelId=D;const I=new D(1,P);class O{constructor(e){this._mask=~a("x",e),this._maskedValue=a("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class E{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const L=[new E(66,new O("x1xx0000"),1),new E(77,new O("1xxx0000"),1),new E(88,new O("11xx0000"),1),new E(66,new O("x0xx0000"),c),new E(88,new O("10xx0000"),c),new E(77,new O("0x0x0000"),p),new E(100,new O("00000000"),m),new E(100,new O("00001100"),l)];r.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const t=parseInt(e,16);if(0===t)return null;const r=255&t,a=255&t>>8;let n;switch(r){case f:{n=0==(a&16)?f:u;break}case g:case b:case _:case h:case v:case S:case y:case P:case R:case C:case k:case x:case T:case M:case w:{n=r;break}default:return i("parseProfileLevelId() | unrecognized level_idc:%s",r),null;}for(const r of L)if((255&t>>16)===r.profile_idc&&r.profile_iop.isMatch(a))return new D(r.profile,n);return i("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},r.profileLevelIdToString=function(e){if(e.level==u)switch(e.profile){case d:return"42f00b";case c:return"42100b";case p:return"4d100b";default:return i("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null;}let t;switch(e.profile){case d:{t="42e0";break}case c:{t="4200";break}case p:{t="4d00";break}case l:{t="640c";break}case m:{t="6400";break}default:return i("profileLevelIdToString() | unrecognized profile:%s",e.profile),null;}let r=e.level.toString(16);return 1===r.length&&(r=`0${r}`),`${t}${r}`},r.parseSdpProfileLevelId=function(e={}){const t=e["profile-level-id"];return t?r.parseProfileLevelId(t):I},r.isSameProfile=function(e={},t={}){const a=r.parseSdpProfileLevelId(e),n=r.parseSdpProfileLevelId(t);return!!(a&&n&&a.profile===n.profile)},r.generateProfileLevelIdForAnswer=function(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"])return i("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const a=r.parseSdpProfileLevelId(e),n=r.parseSdpProfileLevelId(t);if(!a)throw new TypeError("invalid local_profile_level_id");if(!n)throw new TypeError("invalid remote_profile_level_id");if(a.profile!==n.profile)throw new TypeError("H264 Profile mismatch");const d=o(e)&&o(t),c=a.level,p=n.level,l=s(c,p),m=d?c:l;return i("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",a.profile,m),r.profileLevelIdToString(new D(a.profile,m))}},{debug:27}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("./Logger"),n=e("./EnhancedEventEmitter"),s=e("./errors"),o=new a.Logger("Consumer");class i extends n.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:a,track:s,rtpParameters:i,appData:d}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,o.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=a,this._track=s,this._rtpParameters=i,this._paused=!s.enabled,this._appData=d,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(o.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){return o.debug("pause()"),this._closed?void o.error("pause() | Consumer closed"):void(this._paused=!0,this._track.enabled=!1,this._observer.safeEmit("pause"))}resume(){return o.debug("resume()"),this._closed?void o.error("resume() | Consumer closed"):void(this._paused=!1,this._track.enabled=!0,this._observer.safeEmit("resume"))}_onTrackEnded(){o.debug("track \"ended\" event"),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}}r.Consumer=i},{"./EnhancedEventEmitter":34,"./Logger":35,"./errors":38}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("./Logger"),n=e("./EnhancedEventEmitter"),s=new a.Logger("DataConsumer");class o extends n.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:a,appData:o}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=a,this._appData=o,this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(s.debug("DataChannel \"open\" event"),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):s.error("DataChannel \"error\" event: %o",t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(s.warn("DataChannel \"close\" event"),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}}r.DataConsumer=o},{"./EnhancedEventEmitter":34,"./Logger":35}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("./Logger"),n=e("./EnhancedEventEmitter"),s=e("./errors"),o=new a.Logger("DataProducer");class i extends n.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:a}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,o.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=a,this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(o.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(o.debug("send()"),this._closed)throw new s.InvalidStateError("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(o.debug("DataChannel \"open\" event"),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?o.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):o.error("DataChannel \"error\" event: %o",t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(o.warn("DataChannel \"close\" event"),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||o.warn("DataChannel \"message\" event in a DataProducer, message discarded")}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}r.DataProducer=i},{"./EnhancedEventEmitter":34,"./Logger":35,"./errors":38}],33:[function(e,t,r){"use strict";function a(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void S.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(S.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"==typeof navigator&&"string"==typeof navigator.userAgent){const e=navigator.userAgent,t=n.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=+t[1];return 74<=e?"Chrome74":70<=e?"Chrome70":67<=e?"Chrome67":"Chrome55"}return"Chrome74"}return void S.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}S.warn("this._detectDevice() | unknown device")}Object.defineProperty(r,"__esModule",{value:!0});const n=e("bowser"),s=e("./Logger"),o=e("./EnhancedEventEmitter"),i=e("./errors"),d=e("./utils"),c=e("./ortc"),p=e("./Transport"),l=e("./handlers/Chrome74"),m=e("./handlers/Chrome70"),u=e("./handlers/Chrome67"),g=e("./handlers/Chrome55"),f=e("./handlers/Firefox60"),b=e("./handlers/Safari12"),_=e("./handlers/Safari11"),h=e("./handlers/Edge11"),v=e("./handlers/ReactNative"),S=new s.Logger("Device");r.detectDevice=a;class y{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new o.EnhancedEventEmitter,S.debug("constructor()"),r)if(S.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"==typeof r)e=r;else throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)S.debug("constructor() | handler given: %s",e);else if(e=a(),e)S.debug("constructor() | detected handler: %s",e);else throw new i.UnsupportedError("device not supported");switch(e){case"Chrome74":this._handlerFactory=l.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=m.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=u.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=g.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=f.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=b.Safari12.createFactory();break;case"Safari11":this._handlerFactory=_.Safari11.createFactory();break;case"Edge11":this._handlerFactory=h.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=v.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`);}}const n=this._handlerFactory();this._handlerName=n.name,n.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new i.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new i.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){S.debug("load() [routerRtpCapabilities:%o]",e),e=d.clone(e,void 0);let t;try{if(this._loaded)throw new i.InvalidStateError("already loaded");c.validateRtpCapabilities(e),t=this._handlerFactory();const r=await t.getNativeRtpCapabilities();S.debug("load() | got native RTP capabilities:%o",r),c.validateRtpCapabilities(r),this._extendedRtpCapabilities=c.getExtendedRtpCapabilities(r,e),S.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=c.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=c.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=c.getRecvRtpCapabilities(this._extendedRtpCapabilities),c.validateRtpCapabilities(this._recvRtpCapabilities),S.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),S.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),c.validateSctpCapabilities(this._sctpCapabilities),S.debug("load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}canProduce(e){if(!this._loaded)throw new i.InvalidStateError("not loaded");else if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:i,proprietaryConstraints:d,appData:c={}}){return S.debug("createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:i,proprietaryConstraints:d,appData:c})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:i,proprietaryConstraints:d,appData:c={}}){return S.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:i,proprietaryConstraints:d,appData:c})}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:s,iceServers:o,iceTransportPolicy:d,additionalSettings:c,proprietaryConstraints:l,appData:m={}}){if(!this._loaded)throw new i.InvalidStateError("not loaded");else if("string"!=typeof t)throw new TypeError("missing id");else if("object"!=typeof r)throw new TypeError("missing iceParameters");else if(!Array.isArray(a))throw new TypeError("missing iceCandidates");else if("object"!=typeof n)throw new TypeError("missing dtlsParameters");else if(s&&"object"!=typeof s)throw new TypeError("wrong sctpParameters");else if(m&&"object"!=typeof m)throw new TypeError("if given, appData must be an object");const u=new p.Transport({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:s,iceServers:o,iceTransportPolicy:d,additionalSettings:c,proprietaryConstraints:l,appData:m,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",u),u}}r.Device=y},{"./EnhancedEventEmitter":34,"./Logger":35,"./Transport":37,"./errors":38,"./handlers/Chrome55":39,"./handlers/Chrome67":40,"./handlers/Chrome70":41,"./handlers/Chrome74":42,"./handlers/Edge11":43,"./handlers/Firefox60":44,"./handlers/ReactNative":46,"./handlers/Safari11":47,"./handlers/Safari12":48,"./ortc":56,"./utils":59,bowser:60}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("events"),n=e("./Logger"),s=new n.Logger("EnhancedEventEmitter");class o extends a.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const r=this.listenerCount(e);try{return this.emit(e,...t)}catch(t){return s.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t),!!r}}async safeEmitAsPromise(e,...t){return new Promise((r,a)=>{try{this.emit(e,...t,r,a)}catch(t){s.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",e,t),a(t)}})}}r.EnhancedEventEmitter=o},{"./Logger":35,events:26}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("debug"),n="mediasoup-client";class s{constructor(e){e?(this._debug=a.default(`${n}:${e}`),this._warn=a.default(`${n}:WARN:${e}`),this._error=a.default(`${n}:ERROR:${e}`)):(this._debug=a.default(n),this._warn=a.default(`${n}:WARN`),this._error=a.default(`${n}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}r.Logger=s},{debug:61}],36:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("./Logger"),n=e("./EnhancedEventEmitter"),s=e("./errors"),o=new a.Logger("Producer");class i extends n.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:r,track:a,rtpParameters:s,stopTracks:i,disableTrackOnPause:d,zeroRtpOnPause:c,appData:p}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,o.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=a,this._kind=a.kind,this._rtpParameters=s,this._paused=!!d&&!a.enabled,this._maxSpatialLayer=void 0,this._stopTracks=i,this._disableTrackOnPause=d,this._zeroRtpOnPause=c,this._appData=p,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(o.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){return o.debug("pause()"),this._closed?void o.error("pause() | Producer closed"):void(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch(()=>{}),this._observer.safeEmit("pause"))}resume(){return o.debug("resume()"),this._closed?void o.error("resume() | Producer closed"):void(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch(()=>{}),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if(o.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(e){}throw new s.InvalidStateError("closed")}else if(e&&"ended"===e.readyState)throw new s.InvalidStateError("track ended");return e===this._track?void o.debug("replaceTrack() | same track, ignored"):void((!this._zeroRtpOnPause||!this._paused)&&(await this.safeEmitAsPromise("@replacetrack",e)),this._destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack())}async setMaxSpatialLayer(e){if(this._closed)throw new s.InvalidStateError("closed");else if("video"!==this._kind)throw new s.UnsupportedError("not a video Producer");else if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e===this._maxSpatialLayer||(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new s.InvalidStateError("closed");else if("object"!=typeof e)throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){o.debug("track \"ended\" event"),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}r.Producer=i},{"./EnhancedEventEmitter":34,"./Logger":35,"./errors":38}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("awaitqueue"),n=e("./Logger"),s=e("./EnhancedEventEmitter"),o=e("./errors"),i=e("./utils"),d=e("./ortc"),c=e("./Producer"),p=e("./Consumer"),l=e("./DataProducer"),m=e("./DataConsumer"),u=new n.Logger("Transport");class g extends s.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:d,sctpParameters:c,iceServers:p,iceTransportPolicy:l,additionalSettings:m,proprietaryConstraints:g,appData:f,handlerFactory:b,extendedRtpCapabilities:_,canProduceByKind:h}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new a.AwaitQueue({ClosedErrorClass:o.InvalidStateError}),this._observer=new s.EnhancedEventEmitter,u.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=_,this._canProduceByKind=h,this._maxSctpMessageSize=c?c.maxMessageSize:null,m=i.clone(m,{}),delete m.iceServers,delete m.iceTransportPolicy,delete m.bundlePolicy,delete m.rtcpMuxPolicy,delete m.sdpSemantics,this._handler=b(),this._handler.run({direction:e,iceParameters:r,iceCandidates:n,dtlsParameters:d,sctpParameters:c,iceServers:p,iceTransportPolicy:l,additionalSettings:m,proprietaryConstraints:g,extendedRtpCapabilities:_}),this._appData=f,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){u.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new o.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(u.debug("restartIce()"),this._closed)throw new o.InvalidStateError("closed");else if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(u.debug("updateIceServers()"),this._closed)throw new o.InvalidStateError("closed");else if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:r,codec:a,stopTracks:n=!0,disableTrackOnPause:s=!0,zeroRtpOnPause:i=!1,appData:p={}}={}){if(u.debug("produce() [track:%o]",e),!e)throw new TypeError("missing track");else if("send"!==this._direction)throw new o.UnsupportedError("not a sending Transport");else if(!this._canProduceByKind[e.kind])throw new o.UnsupportedError(`cannot produce ${e.kind}`);else if("ended"===e.readyState)throw new o.InvalidStateError("track ended");else if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError("no \"connect\" listener set into this transport");else if(0===this.listenerCount("produce"))throw new TypeError("no \"produce\" listener set into this transport");else if(p&&"object"!=typeof p)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let o;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");else t&&0===t.length?o=void 0:t&&(o=t.map(e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t}));const{localId:l,rtpParameters:m,rtpSender:u}=await this._handler.send({track:e,encodings:o,codecOptions:r,codec:a});try{d.validateRtpParameters(m);const{id:t}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:m,appData:p}),r=new c.Producer({id:t,localId:l,rtpSender:u,track:e,rtpParameters:m,stopTracks:n,disableTrackOnPause:s,zeroRtpOnPause:i,appData:p});return this._producers.set(r.id,r),this._handleProducer(r),this._observer.safeEmit("newproducer",r),r}catch(e){throw this._handler.stopSending(l).catch(()=>{}),e}},"transport.produce()").catch(t=>{if(n)try{e.stop()}catch(e){}throw t})}async consume({id:e,producerId:t,kind:r,rtpParameters:a,appData:n={}}){if(u.debug("consume()"),a=i.clone(a,void 0),this._closed)throw new o.InvalidStateError("closed");else if("recv"!==this._direction)throw new o.UnsupportedError("not a receiving Transport");else if("string"!=typeof e)throw new TypeError("missing id");else if("string"!=typeof t)throw new TypeError("missing producerId");else if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);else if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError("no \"connect\" listener set into this transport");else if(n&&"object"!=typeof n)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{const s=d.canReceive(a,this._extendedRtpCapabilities);if(!s)throw new o.UnsupportedError("cannot consume this Producer");const{localId:i,rtpReceiver:c,track:l}=await this._handler.receive({trackId:e,kind:r,rtpParameters:a}),m=new p.Consumer({id:e,localId:i,producerId:t,rtpReceiver:c,track:l,rtpParameters:a,appData:n});if(this._consumers.set(m.id,m),this._handleConsumer(m),!this._probatorConsumerCreated&&"video"===r)try{const e=d.generateProbatorRtpParameters(m.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:e}),u.debug("consume() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){u.error("consume() | failed to create Consumer for RTP probation:%o",e)}return this._observer.safeEmit("newconsumer",m),m},"transport.consume()")}async produceData({ordered:r=!0,maxPacketLifeTime:e,maxRetransmits:t,priority:a="low",label:n="",protocol:s="",appData:i={}}={}){if(u.debug("produceData()"),"send"!==this._direction)throw new o.UnsupportedError("not a sending Transport");else if(!this._maxSctpMessageSize)throw new o.UnsupportedError("SCTP not enabled by remote Transport");else if(!["very-low","low","medium","high"].includes(a))throw new TypeError("wrong priority");else if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError("no \"connect\" listener set into this transport");else if(0===this.listenerCount("producedata"))throw new TypeError("no \"producedata\" listener set into this transport");else if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return(e||t)&&(r=!1),this._awaitQueue.push(async()=>{const{dataChannel:o,sctpStreamParameters:c}=await this._handler.sendDataChannel({ordered:r,maxPacketLifeTime:e,maxRetransmits:t,priority:a,label:n,protocol:s});d.validateSctpStreamParameters(c);const{id:p}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:c,label:n,protocol:s,appData:i}),m=new l.DataProducer({id:p,dataChannel:o,sctpStreamParameters:c,appData:i});return this._dataProducers.set(m.id,m),this._handleDataProducer(m),this._observer.safeEmit("newdataproducer",m),m},"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:a="",protocol:n="",appData:s={}}){if(u.debug("consumeData()"),r=i.clone(r,void 0),this._closed)throw new o.InvalidStateError("closed");else if("recv"!==this._direction)throw new o.UnsupportedError("not a receiving Transport");else if(!this._maxSctpMessageSize)throw new o.UnsupportedError("SCTP not enabled by remote Transport");else if("string"!=typeof e)throw new TypeError("missing id");else if("string"!=typeof t)throw new TypeError("missing dataProducerId");else if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError("no \"connect\" listener set into this transport");else if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return d.validateSctpStreamParameters(r),this._awaitQueue.push(async()=>{const{dataChannel:o}=await this._handler.receiveDataChannel({sctpStreamParameters:r,label:a,protocol:n}),i=new m.DataConsumer({id:e,dataProducerId:t,dataChannel:o,sctpStreamParameters:r,appData:s});return this._dataConsumers.set(i.id,i),this._handleDataConsumer(i),this._observer.safeEmit("newdataconsumer",i),i},"transport.consumeData()")}_handleHandler(){const e=this._handler;e.on("@connect",({dtlsParameters:e},t,r)=>this._closed?void r(new o.InvalidStateError("closed")):void this.safeEmit("connect",{dtlsParameters:e},t,r)),e.on("@connectionstatechange",e=>{e===this._connectionState||(u.debug("connection state changed to %s",e),this._connectionState=e,!this._closed&&this.safeEmit("connectionstatechange",e))})}_handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id);this._closed||this._awaitQueue.push(async()=>this._handler.stopSending(e.localId),"producer @close event").catch(e=>u.warn("producer.close() failed:%o",e))}),e.on("@replacetrack",(t,r,a)=>{this._awaitQueue.push(async()=>this._handler.replaceTrack(e.localId,t),"producer @replacetrack event").then(r).catch(a)}),e.on("@setmaxspatiallayer",(t,r,a)=>{this._awaitQueue.push(async()=>this._handler.setMaxSpatialLayer(e.localId,t),"producer @setmaxspatiallayer event").then(r).catch(a)}),e.on("@setrtpencodingparameters",(t,r,a)=>{this._awaitQueue.push(async()=>this._handler.setRtpEncodingParameters(e.localId,t),"producer @setrtpencodingparameters event").then(r).catch(a)}),e.on("@getstats",(t,r)=>this._closed?r(new o.InvalidStateError("closed")):void this._handler.getSenderStats(e.localId).then(t).catch(r))}_handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id);this._closed||this._awaitQueue.push(async()=>this._handler.stopReceiving(e.localId),"consumer @close event").catch(()=>{})}),e.on("@getstats",(t,r)=>this._closed?r(new o.InvalidStateError("closed")):void this._handler.getReceiverStats(e.localId).then(t).catch(r))}_handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}_handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}r.Transport=g},{"./Consumer":30,"./DataConsumer":31,"./DataProducer":32,"./EnhancedEventEmitter":34,"./Logger":35,"./Producer":36,"./errors":38,"./ortc":56,"./utils":59,awaitqueue:24}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});class a extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,a):this.stack=new Error(e).stack}}r.UnsupportedError=a;class n extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,n):this.stack=new Error(e).stack}}r.InvalidStateError=n},{}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform"),n=e("../Logger"),s=e("../errors"),o=e("../utils"),i=e("../ortc"),d=e("./sdp/commonUtils"),c=e("./sdp/planBUtils"),p=e("./HandlerInterface"),l=e("./sdp/RemoteSdp"),m=new n.Logger("Chrome55"),u={OS:1024,MIS:1024};class g extends p.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Chrome55"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=a.parse(t.sdp),n=d.extractRtpCapabilities({sdpObject:r});return n}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:u}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:c,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",p),video:i.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",p),video:i.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},d),c),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let s=await this._pc.createOffer(),p=a.parse(s.sdp),l;const u=o.clone(this._sendingRtpParametersByKind[e.kind],{});u.codecs=i.reduceCodecs(u.codecs);const g=o.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(g.codecs=i.reduceCodecs(g.codecs),this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:p})),"video"===e.kind&&t&&1<t.length&&(m.debug("send() | enabling simulcast"),p=a.parse(s.sdp),l=p.media.find(e=>"video"===e.type),c.addLegacySimulcast({offerMediaObject:l,track:e,numStreams:t.length}),s={type:"offer",sdp:a.write(p)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),p=a.parse(this._pc.localDescription.sdp),l=p.media.find(t=>t.type===e.kind),u.rtcp.cname=d.getCname({offerMediaObject:l}),u.encodings=c.getRtpEncodings({offerMediaObject:l,track:e}),t)for(let e=0;e<u.encodings.length;++e)t[e]&&Object.assign(u.encodings[e],t[e]);if(1<u.encodings.length&&"video/vp8"===u.codecs[0].mimeType.toLowerCase())for(const e of u.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:l,offerRtpParameters:u,answerRtpParameters:g,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const b=this._nextSendLocalId+"";return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(b,e),{localId:b,rtpParameters:u}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void m.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"!==this._pc.signalingState){const e={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}}async replaceTrack(e,t){throw new s.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new s.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new s.UnsupportedError("not supported")}async getSenderStats(e){throw new s.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s,priority:o}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:s,priority:o};m.debug("sendDataChannel() [options:%o]",i);const d=this._pc.createDataChannel(n,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%u.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const n=e,s=t,o=r.rtcp.cname;this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:r,streamId:o,trackId:e});const i={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let c=await this._pc.createAnswer();const p=a.parse(c.sdp),l=p.media.find(e=>e.mid+""===s);d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:l}),c={type:"answer",sdp:a.write(p)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:p})),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const u=this._pc.getRemoteStreams().find(e=>e.id===o),g=u.getTrackById(n);if(!g)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(n,{mid:s,rtpParameters:r}),{localId:n,track:g}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new s.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:i,protocol:r};m.debug("receiveDataChannel() [options:%o]",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error("method can just be called for handlers with \"send\" direction")}_assertRecvDirection(){if("recv"!==this._direction)throw new Error("method can just be called for handlers with \"recv\" direction")}}r.Chrome55=g},{"../Logger":35,"../errors":38,"../ortc":56,"../utils":59,"./HandlerInterface":45,"./sdp/RemoteSdp":51,"./sdp/commonUtils":52,"./sdp/planBUtils":53,"sdp-transform":80}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform"),n=e("../Logger"),s=e("../utils"),o=e("../ortc"),i=e("./sdp/commonUtils"),d=e("./sdp/planBUtils"),c=e("./HandlerInterface"),p=e("./sdp/RemoteSdp"),l=new n.Logger("Chrome67"),m={OS:1024,MIS:1024};class u extends c.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new u}get name(){return"Chrome67"}close(){if(l.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=a.parse(t.sdp),n=i.extractRtpCapabilities({sdpObject:r});return n}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:i,additionalSettings:d,proprietaryConstraints:c,extendedRtpCapabilities:m}){l.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",m),video:o.getSendingRtpParameters("video",m)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",m),video:o.getSendingRemoteRtpParameters("video",m)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},d),c),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}async updateIceServers(e){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this._assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&l.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let c=await this._pc.createOffer(),p=a.parse(c.sdp),m;const u=s.clone(this._sendingRtpParametersByKind[e.kind],{});u.codecs=o.reduceCodecs(u.codecs);const g=s.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(g.codecs=o.reduceCodecs(g.codecs),this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:p})),"video"===e.kind&&t&&1<t.length&&(l.debug("send() | enabling simulcast"),p=a.parse(c.sdp),m=p.media.find(e=>"video"===e.type),d.addLegacySimulcast({offerMediaObject:m,track:e,numStreams:t.length}),c={type:"offer",sdp:a.write(p)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),p=a.parse(this._pc.localDescription.sdp),m=p.media.find(t=>t.type===e.kind),u.rtcp.cname=i.getCname({offerMediaObject:m}),u.encodings=d.getRtpEncodings({offerMediaObject:m,track:e}),t)for(let e=0;e<u.encodings.length;++e)t[e]&&Object.assign(u.encodings[e],t[e]);if(1<u.encodings.length&&"video/vp8"===u.codecs[0].mimeType.toLowerCase())for(const e of u.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:m,offerRtpParameters:u,answerRtpParameters:g,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const b=this._nextSendLocalId+"";this._nextSendLocalId++;const _=this._pc.getSenders().find(t=>t.track===e);return this._mapSendLocalIdRtpSender.set(b,_),{localId:b,rtpParameters:u,rtpSender:_}}async stopSending(e){this._assertSendDirection(),l.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void l.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"!==this._pc.signalingState){const e={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}}async replaceTrack(e,t){this._assertSendDirection(),t?l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):l.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.track;await r.replaceTrack(t),a&&this._sendStream.removeTrack(a),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)}),await r.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s,priority:o}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:s,priority:o};l.debug("sendDataChannel() [options:%o]",i);const d=this._pc.createDataChannel(n,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),l.debug("receive() [trackId:%s, kind:%s]",e,t);const n=e,s=t;this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const o={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let d=await this._pc.createAnswer();const c=a.parse(d.sdp),p=c.media.find(e=>e.mid+""===s);i.applyCodecParameters({offerRtpParameters:r,answerMediaObject:p}),d={type:"answer",sdp:a.write(c)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:c})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);const m=this._pc.getReceivers().find(e=>e.track&&e.track.id===n);if(!m)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(n,{mid:s,rtpParameters:r,rtpReceiver:m}),{localId:n,track:m.track,rtpReceiver:m}}async stopReceiving(e){this._assertRecvDirection(),l.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:i,protocol:r};l.debug("receiveDataChannel() [options:%o]",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=i.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error("method can just be called for handlers with \"send\" direction")}_assertRecvDirection(){if("recv"!==this._direction)throw new Error("method can just be called for handlers with \"recv\" direction")}}r.Chrome67=u},{"../Logger":35,"../ortc":56,"../utils":59,"./HandlerInterface":45,"./sdp/RemoteSdp":51,"./sdp/commonUtils":52,"./sdp/planBUtils":53,"sdp-transform":80}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform"),n=e("../Logger"),s=e("../utils"),o=e("../ortc"),i=e("./sdp/commonUtils"),d=e("./sdp/unifiedPlanUtils"),c=e("./HandlerInterface"),p=e("./sdp/RemoteSdp"),l=e("../scalabilityModes"),m=new n.Logger("Chrome70"),u={OS:1024,MIS:1024};class g extends c.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Chrome70"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=a.parse(t.sdp),n=i.extractRtpCapabilities({sdpObject:r});return n}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:u}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:i,additionalSettings:d,proprietaryConstraints:c,extendedRtpCapabilities:l}){m.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",l),video:o.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",l),video:o.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},d),c),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const c=s.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=o.reduceCodecs(c.codecs,n);const p=s.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});p.codecs=o.reduceCodecs(p.codecs,n);const u=this._remoteSdp.getNextMediaSectionIdx(),g=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let f=await this._pc.createOffer(),b=a.parse(f.sdp),_;this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:b})),t&&1<t.length&&(m.debug("send() | enabling legacy simulcast"),b=a.parse(f.sdp),_=b.media[u.idx],d.addLegacySimulcast({offerMediaObject:_,numStreams:t.length}),f={type:"offer",sdp:a.write(b)});let h=!1;const v=l.parse((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&1<v.spatialLayers&&"video/vp9"===c.codecs[0].mimeType.toLowerCase()&&(m.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,b=a.parse(f.sdp),_=b.media[u.idx],d.addLegacySimulcast({offerMediaObject:_,numStreams:v.spatialLayers}),f={type:"offer",sdp:a.write(b)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f),t){m.debug("send() | applying given encodings");const e=g.sender.getParameters();for(let r=0;r<(e.encodings||[]).length;++r){const a=e.encodings[r],n=t[r];if(!n)break;e.encodings[r]=Object.assign(a,n)}await g.sender.setParameters(e)}const S=g.mid;if(c.mid=S,b=a.parse(this._pc.localDescription.sdp),_=b.media[u.idx],c.rtcp.cname=i.getCname({offerMediaObject:_}),c.encodings=d.getRtpEncodings({offerMediaObject:_}),t)for(let e=0;e<c.encodings.length;++e)t[e]&&Object.assign(c.encodings[e],t[e]);if(h&&(c.encodings=[c.encodings[0]]),1<c.encodings.length&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:_,reuseMid:u.reuseMid,offerRtpParameters:c,answerRtpParameters:p,codecOptions:r});const y={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.set(S,g),{localId:S,rtpParameters:c,rtpSender:g.sender}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)}),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s,priority:o}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:s,priority:o};m.debug("sendDataChannel() [options:%o]",i);const d=this._pc.createDataChannel(n,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%u.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const n=r.mid||this._mapMidTransceiver.size+"";this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let o=await this._pc.createAnswer();const d=a.parse(o.sdp),c=d.media.find(e=>e.mid+""===n);i.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),o={type:"answer",sdp:a.write(d)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:d})),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const p=this._pc.getTransceivers().find(e=>e.mid===n);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(n,p),{localId:n,track:p.receiver.track,rtpReceiver:p.receiver}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:i,protocol:r};m.debug("receiveDataChannel() [options:%o]",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=i.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error("method can just be called for handlers with \"send\" direction")}_assertRecvDirection(){if("recv"!==this._direction)throw new Error("method can just be called for handlers with \"recv\" direction")}}r.Chrome70=g},{"../Logger":35,"../ortc":56,"../scalabilityModes":57,"../utils":59,"./HandlerInterface":45,"./sdp/RemoteSdp":51,"./sdp/commonUtils":52,"./sdp/unifiedPlanUtils":54,"sdp-transform":80}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform"),n=e("../Logger"),s=e("../utils"),o=e("../ortc"),i=e("./sdp/commonUtils"),d=e("./sdp/unifiedPlanUtils"),c=e("./HandlerInterface"),p=e("./sdp/RemoteSdp"),l=e("../scalabilityModes"),m=new n.Logger("Chrome74"),u={OS:1024,MIS:1024};class g extends c.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Chrome74"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=a.parse(t.sdp),n=i.extractRtpCapabilities({sdpObject:r});return n}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:u}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:i,additionalSettings:d,proprietaryConstraints:c,extendedRtpCapabilities:l}){m.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",l),video:o.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",l),video:o.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},d),c),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&1<t.length&&t.forEach((e,t)=>{e.rid=`r${t}`});const c=s.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=o.reduceCodecs(c.codecs,n);const p=s.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});p.codecs=o.reduceCodecs(p.codecs,n);const u=this._remoteSdp.getNextMediaSectionIdx(),g=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let f=await this._pc.createOffer(),b=a.parse(f.sdp),_;this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:b}));let h=!1;const v=l.parse((t||[{}])[0].scalabilityMode);t&&1===t.length&&1<v.spatialLayers&&"video/vp9"===c.codecs[0].mimeType.toLowerCase()&&(m.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,b=a.parse(f.sdp),_=b.media[u.idx],d.addLegacySimulcast({offerMediaObject:_,numStreams:v.spatialLayers}),f={type:"offer",sdp:a.write(b)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const S=g.mid;if(c.mid=S,b=a.parse(this._pc.localDescription.sdp),_=b.media[u.idx],c.rtcp.cname=i.getCname({offerMediaObject:_}),!t)c.encodings=d.getRtpEncodings({offerMediaObject:_});else if(1===t.length){let e=d.getRtpEncodings({offerMediaObject:_});Object.assign(e[0],t[0]),h&&(e=[e[0]]),c.encodings=e}else c.encodings=t;if(1<c.encodings.length&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:_,reuseMid:u.reuseMid,offerRtpParameters:c,answerRtpParameters:p,codecOptions:r,extmapAllowMixed:!0});const y={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.set(S,g),{localId:S,rtpParameters:c,rtpSender:g.sender}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)}),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s,priority:o}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s,priority:o};m.debug("sendDataChannel() [options:%o]",i);const d=this._pc.createDataChannel(n,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%u.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const n=r.mid||this._mapMidTransceiver.size+"";this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let o=await this._pc.createAnswer();const d=a.parse(o.sdp),c=d.media.find(e=>e.mid+""===n);i.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),o={type:"answer",sdp:a.write(d)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:d})),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const p=this._pc.getTransceivers().find(e=>e.mid===n);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(n,p),{localId:n,track:p.receiver.track,rtpReceiver:p.receiver}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i,protocol:r};m.debug("receiveDataChannel() [options:%o]",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=i.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error("method can just be called for handlers with \"send\" direction")}_assertRecvDirection(){if("recv"!==this._direction)throw new Error("method can just be called for handlers with \"recv\" direction")}}r.Chrome74=g},{"../Logger":35,"../ortc":56,"../scalabilityModes":57,"../utils":59,"./HandlerInterface":45,"./sdp/RemoteSdp":51,"./sdp/commonUtils":52,"./sdp/unifiedPlanUtils":54,"sdp-transform":80}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("../Logger"),n=e("../errors"),s=e("../utils"),o=e("../ortc"),i=e("./ortc/edgeUtils"),d=e("./HandlerInterface"),c=new a.Logger("Edge11");class p extends d.HandlerInterface{constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}static createFactory(){return()=>new p}get name(){return"Edge11"}close(){c.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const e of this._rtpReceivers.values())try{e.stop()}catch(e){}}async getNativeRtpCapabilities(){return c.debug("getNativeRtpCapabilities()"),i.getCapabilities()}async getNativeSctpCapabilities(){return c.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:m}){c.debug("run()"),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",m),video:o.getSendingRtpParameters("video",m)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=a,this._cname=`CNAME-${s.generateRandomNumber()}`,this._setIceGatherer({iceServers:i,iceTransportPolicy:d}),this._setIceTransport(),this._setDtlsTransport()}async updateIceServers(e){throw new n.UnsupportedError("not supported")}async restartIce(e){if(c.debug("restartIce()"),this._remoteIceParameters=e,!!this._transportReady){c.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){c.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||(await this._setupTransport({localDtlsRole:"server"})),c.debug("send() | calling new RTCRtpSender()");const n=new RTCRtpSender(e,this._dtlsTransport),d=s.clone(this._sendingRtpParametersByKind[e.kind],{});d.codecs=o.reduceCodecs(d.codecs,a);const p=d.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType));t||(t=[{}]);for(const n of t)n.ssrc=s.generateRandomNumber(),p&&(n.rtx={ssrc:s.generateRandomNumber()});d.encodings=t,d.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const l=i.mangleRtpParameters(d);c.debug("send() | calling rtpSender.send() [params:%o]",l),await n.send(l);const m=this._nextSendLocalId+"";return this._nextSendLocalId++,this._rtpSenders.set(m,n),{localId:m,rtpParameters:d,rtpSender:n}}async stopSending(e){c.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{c.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw c.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}async replaceTrack(e,t){t?c.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):c.debug("replaceTrack() [localId:%s, no track]",e);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}async setMaxSpatialLayer(e,t){c.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.setParameters(a)}async setRtpEncodingParameters(e,t){c.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)}),await r.setParameters(a)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new n.UnsupportedError("not implemented")}async receive({trackId:e,kind:t,rtpParameters:r}){c.debug("receive() [trackId:%s, kind:%s]",e,t),this._transportReady||(await this._setupTransport({localDtlsRole:"server"})),c.debug("receive() | calling new RTCRtpReceiver()");const a=new RTCRtpReceiver(this._dtlsTransport,t);a.addEventListener("error",e=>{c.error("rtpReceiver \"error\" event [event:%o]",e)});const n=i.mangleRtpParameters(r);c.debug("receive() | calling rtpReceiver.receive() [params:%o]",n),await a.receive(n);const s=e;return this._rtpReceivers.set(s,a),{localId:s,track:a.track,rtpReceiver:a}}async stopReceiving(e){c.debug("stopReceiving() [localId:%s]",e);const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{c.debug("stopReceiving() | calling rtpReceiver.stop()"),t.stop()}catch(e){c.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new n.UnsupportedError("not implemented")}_setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",e=>{c.error("iceGatherer \"error\" event [event:%o]",e)});try{r.gather()}catch(e){c.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=r}_setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}}),e.addEventListener("candidatepairchange",e=>{c.debug("iceTransport \"candidatepairchange\" event [pair:%o]",e.pair)}),this._iceTransport=e}_setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{c.debug("dtlsTransport \"statechange\" event [state:%s]",e.state)}),e.addEventListener("dtlsstatechange",()=>{c.debug("dtlsTransport \"dtlsstatechange\" event [state:%s]",e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",e=>{c.error("dtlsTransport \"error\" event [event:%o]",e)}),this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){c.debug("_setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}r.Edge11=p},{"../Logger":35,"../errors":38,"../ortc":56,"../utils":59,"./HandlerInterface":45,"./ortc/edgeUtils":49}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform"),n=e("../Logger"),s=e("../errors"),o=e("../utils"),i=e("../ortc"),d=e("./sdp/commonUtils"),c=e("./sdp/unifiedPlanUtils"),p=e("./HandlerInterface"),l=e("./sdp/RemoteSdp"),m=new n.Logger("Firefox60"),u={OS:16,MIS:2048};class g extends p.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Firefox60"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const r=t.captureStream(),n=r.getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const r=e.addTransceiver(n,{direction:"sendrecv"}),s=r.sender.getParameters();s.encodings=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],await r.sender.setParameters(s);const o=await e.createOffer();try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}const i=a.parse(o.sdp),c=d.extractRtpCapabilities({sdpObject:i});return c}catch(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:u}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:c,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",p),video:i.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",p),video:i.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},d),c),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}async updateIceServers(e){throw new s.UnsupportedError("not supported")}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=o.clone(t,[]),1<t.length&&(t.forEach((e,t)=>{e.rid=`r${t}`}),t.reverse()));const s=o.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=i.reduceCodecs(s.codecs,n);const p=o.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});p.codecs=i.reduceCodecs(p.codecs,n);const l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const e=l.sender.getParameters();e.encodings=t,await l.sender.setParameters(e)}const u=await this._pc.createOffer();let g=a.parse(u.sdp);this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:g})),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const f=l.mid;s.mid=f,g=a.parse(this._pc.localDescription.sdp);const b=g.media[g.media.length-1];if(s.rtcp.cname=d.getCname({offerMediaObject:b}),!t)s.encodings=c.getRtpEncodings({offerMediaObject:b});else if(1===t.length){const e=c.getRtpEncodings({offerMediaObject:b});Object.assign(e[0],t[0]),s.encodings=e}else s.encodings=t.reverse();if(1<s.encodings.length&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const e of s.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:b,offerRtpParameters:s,answerRtpParameters:p,codecOptions:r,extmapAllowMixed:!0});const _={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(f,l),{localId:f,rtpParameters:s,rtpSender:l.sender}}async stopSending(e){m.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const a=r.sender.getParameters();t=a.encodings.length-1-t,a.encodings.forEach((e,r)=>{e.active=!!(r>=t)}),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)}),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s,priority:o}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s,priority:o};m.debug("sendDataChannel() [options:%o]",i);const d=this._pc.createDataChannel(n,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%u.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const n=r.mid||this._mapMidTransceiver.size+"";this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let o=await this._pc.createAnswer();const i=a.parse(o.sdp),c=i.media.find(e=>e.mid+""===n);d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),o={type:"answer",sdp:a.write(i)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:i})),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const p=this._pc.getTransceivers().find(e=>e.mid===n);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(n,p),{localId:n,track:p.receiver.track,rtpReceiver:p.receiver}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i,protocol:r};m.debug("receiveDataChannel() [options:%o]",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error("method can just be called for handlers with \"send\" direction")}_assertRecvDirection(){if("recv"!==this._direction)throw new Error("method can just be called for handlers with \"recv\" direction")}}r.Firefox60=g},{"../Logger":35,"../errors":38,"../ortc":56,"../utils":59,"./HandlerInterface":45,"./sdp/RemoteSdp":51,"./sdp/commonUtils":52,"./sdp/unifiedPlanUtils":54,"sdp-transform":80}],45:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("../EnhancedEventEmitter");class n extends a.EnhancedEventEmitter{constructor(){super()}}r.HandlerInterface=n},{"../EnhancedEventEmitter":34}],46:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform"),n=e("../Logger"),s=e("../errors"),o=e("../utils"),i=e("../ortc"),d=e("./sdp/commonUtils"),c=e("./sdp/planBUtils"),p=e("./HandlerInterface"),l=e("./sdp/RemoteSdp"),m=new n.Logger("ReactNative"),u={OS:1024,MIS:1024};class g extends p.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"ReactNative"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=a.parse(t.sdp),n=d.extractRtpCapabilities({sdpObject:r});return n}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:u}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:c,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",p),video:i.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",p),video:i.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},d),c),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let s=await this._pc.createOffer(),p=a.parse(s.sdp),l;const u=o.clone(this._sendingRtpParametersByKind[e.kind],{});u.codecs=i.reduceCodecs(u.codecs);const g=o.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(g.codecs=i.reduceCodecs(g.codecs),this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:p})),"video"===e.kind&&t&&1<t.length&&(m.debug("send() | enabling simulcast"),p=a.parse(s.sdp),l=p.media.find(e=>"video"===e.type),c.addLegacySimulcast({offerMediaObject:l,track:e,numStreams:t.length}),s={type:"offer",sdp:a.write(p)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),p=a.parse(this._pc.localDescription.sdp),l=p.media.find(t=>t.type===e.kind),u.rtcp.cname=d.getCname({offerMediaObject:l}),u.encodings=c.getRtpEncodings({offerMediaObject:l,track:e}),t)for(let e=0;e<u.encodings.length;++e)t[e]&&Object.assign(u.encodings[e],t[e]);if(1<u.encodings.length&&("video/vp8"===u.codecs[0].mimeType.toLowerCase()||"video/h264"===u.codecs[0].mimeType.toLowerCase()))for(const e of u.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:l,offerRtpParameters:u,answerRtpParameters:g,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const b=this._nextSendLocalId+"";return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(b,e),{localId:b,rtpParameters:u}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void m.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"!==this._pc.signalingState){const e={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}}async replaceTrack(e,t){throw new s.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new s.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new s.UnsupportedError("not implemented")}async getSenderStats(e){throw new s.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s,priority:o}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:s,priority:o};m.debug("sendDataChannel() [options:%o]",i);const d=this._pc.createDataChannel(n,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%u.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const n=e,s=t;let i=r.rtcp.cname;m.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),i+=`-hack-${o.generateRandomNumber()}`,this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:r,streamId:i,trackId:e});const c={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let p=await this._pc.createAnswer();const l=a.parse(p.sdp),u=l.media.find(e=>e.mid+""===s);d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:u}),p={type:"answer",sdp:a.write(l)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:l})),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p);const g=this._pc.getRemoteStreams().find(e=>e.id===i),f=g.getTrackById(n);if(!f)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(n,{mid:s,rtpParameters:r}),{localId:n,track:f}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new s.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:i,protocol:r};m.debug("receiveDataChannel() [options:%o]",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error("method can just be called for handlers with \"send\" direction")}_assertRecvDirection(){if("recv"!==this._direction)throw new Error("method can just be called for handlers with \"recv\" direction")}}r.ReactNative=g},{"../Logger":35,"../errors":38,"../ortc":56,"../utils":59,"./HandlerInterface":45,"./sdp/RemoteSdp":51,"./sdp/commonUtils":52,"./sdp/planBUtils":53,"sdp-transform":80}],47:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform"),n=e("../Logger"),s=e("../utils"),o=e("../ortc"),i=e("./sdp/commonUtils"),d=e("./sdp/planBUtils"),c=e("./HandlerInterface"),p=e("./sdp/RemoteSdp"),l=new n.Logger("Safari11"),m={OS:1024,MIS:1024};class u extends c.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new u}get name(){return"Safari11"}close(){if(l.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=a.parse(t.sdp),n=i.extractRtpCapabilities({sdpObject:r});return n}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:i,additionalSettings:d,proprietaryConstraints:c,extendedRtpCapabilities:m}){l.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",m),video:o.getSendingRtpParameters("video",m)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",m),video:o.getSendingRemoteRtpParameters("video",m)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},d),c),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}async updateIceServers(e){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this._assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&l.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let c=await this._pc.createOffer(),p=a.parse(c.sdp),m;const u=s.clone(this._sendingRtpParametersByKind[e.kind],{});u.codecs=o.reduceCodecs(u.codecs);const g=s.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(g.codecs=o.reduceCodecs(g.codecs),this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:p})),"video"===e.kind&&t&&1<t.length&&(l.debug("send() | enabling simulcast"),p=a.parse(c.sdp),m=p.media.find(e=>"video"===e.type),d.addLegacySimulcast({offerMediaObject:m,track:e,numStreams:t.length}),c={type:"offer",sdp:a.write(p)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),p=a.parse(this._pc.localDescription.sdp),m=p.media.find(t=>t.type===e.kind),u.rtcp.cname=i.getCname({offerMediaObject:m}),u.encodings=d.getRtpEncodings({offerMediaObject:m,track:e}),t)for(let e=0;e<u.encodings.length;++e)t[e]&&Object.assign(u.encodings[e],t[e]);if(1<u.encodings.length&&"video/vp8"===u.codecs[0].mimeType.toLowerCase())for(const e of u.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:m,offerRtpParameters:u,answerRtpParameters:g,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const b=this._nextSendLocalId+"";this._nextSendLocalId++;const _=this._pc.getSenders().find(t=>t.track===e);return this._mapSendLocalIdRtpSender.set(b,_),{localId:b,rtpParameters:u,rtpSender:_}}async stopSending(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void l.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"!==this._pc.signalingState){const e={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}}async replaceTrack(e,t){this._assertSendDirection(),t?l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):l.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.track;await r.replaceTrack(t),a&&this._sendStream.removeTrack(a),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)}),await r.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s,priority:o}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s,priority:o};l.debug("sendDataChannel() [options:%o]",i);const d=this._pc.createDataChannel(n,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),l.debug("receive() [trackId:%s, kind:%s]",e,t);const n=e,s=t;this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const o={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let d=await this._pc.createAnswer();const c=a.parse(d.sdp),p=c.media.find(e=>e.mid+""===s);i.applyCodecParameters({offerRtpParameters:r,answerMediaObject:p}),d={type:"answer",sdp:a.write(c)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:c})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);const m=this._pc.getReceivers().find(e=>e.track&&e.track.id===n);if(!m)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(n,{mid:s,rtpParameters:r,rtpReceiver:m}),{localId:n,track:m.track,rtpReceiver:m}}async stopReceiving(e){this._assertRecvDirection(),l.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i,protocol:r};l.debug("receiveDataChannel() [options:%o]",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=i.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error("method can just be called for handlers with \"send\" direction")}_assertRecvDirection(){if("recv"!==this._direction)throw new Error("method can just be called for handlers with \"recv\" direction")}}r.Safari11=u},{"../Logger":35,"../ortc":56,"../utils":59,"./HandlerInterface":45,"./sdp/RemoteSdp":51,"./sdp/commonUtils":52,"./sdp/planBUtils":53,"sdp-transform":80}],48:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform"),n=e("../Logger"),s=e("../utils"),o=e("../ortc"),i=e("./sdp/commonUtils"),d=e("./sdp/unifiedPlanUtils"),c=e("./HandlerInterface"),p=e("./sdp/RemoteSdp"),l=new n.Logger("Safari12"),m={OS:1024,MIS:1024};class u extends c.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new u}get name(){return"Safari12"}close(){if(l.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=a.parse(t.sdp),n=i.extractRtpCapabilities({sdpObject:r});return n}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:s,iceTransportPolicy:i,additionalSettings:d,proprietaryConstraints:c,extendedRtpCapabilities:m}){l.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",m),video:o.getSendingRtpParameters("video",m)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",m),video:o.getSendingRemoteRtpParameters("video",m)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},d),c),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}async updateIceServers(e){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this._assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const c=s.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=o.reduceCodecs(c.codecs,n);const p=s.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});p.codecs=o.reduceCodecs(p.codecs,n);const m=this._remoteSdp.getNextMediaSectionIdx(),u=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let g=await this._pc.createOffer(),f=a.parse(g.sdp),b;this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:f})),t&&1<t.length&&(l.debug("send() | enabling legacy simulcast"),f=a.parse(g.sdp),b=f.media[m.idx],d.addLegacySimulcast({offerMediaObject:b,numStreams:t.length}),g={type:"offer",sdp:a.write(f)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const _=u.mid;if(c.mid=_,f=a.parse(this._pc.localDescription.sdp),b=f.media[m.idx],c.rtcp.cname=i.getCname({offerMediaObject:b}),c.encodings=d.getRtpEncodings({offerMediaObject:b}),t)for(let e=0;e<c.encodings.length;++e)t[e]&&Object.assign(c.encodings[e],t[e]);if(1<c.encodings.length&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:b,reuseMid:m.reuseMid,offerRtpParameters:c,answerRtpParameters:p,codecOptions:r});const h={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._mapMidTransceiver.set(_,u),{localId:_,rtpParameters:c,rtpSender:u.sender}}async stopSending(e){this._assertSendDirection(),l.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):l.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)}),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s,priority:o}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:s,priority:o};l.debug("sendDataChannel() [options:%o]",i);const d=this._pc.createDataChannel(n,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),l.debug("receive() [trackId:%s, kind:%s]",e,t);const n=r.mid||this._mapMidTransceiver.size+"";this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let o=await this._pc.createAnswer();const d=a.parse(o.sdp),c=d.media.find(e=>e.mid+""===n);i.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),o={type:"answer",sdp:a.write(d)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:d})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const p=this._pc.getTransceivers().find(e=>e.mid===n);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(n,p),{localId:n,track:p.receiver.track,rtpReceiver:p.receiver}}async stopReceiving(e){this._assertRecvDirection(),l.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:i,protocol:r};l.debug("receiveDataChannel() [options:%o]",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=i.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error("method can just be called for handlers with \"send\" direction")}_assertRecvDirection(){if("recv"!==this._direction)throw new Error("method can just be called for handlers with \"recv\" direction")}}r.Safari12=u},{"../Logger":35,"../ortc":56,"../utils":59,"./HandlerInterface":45,"./sdp/RemoteSdp":51,"./sdp/commonUtils":52,"./sdp/unifiedPlanUtils":54,"sdp-transform":80}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("../../utils");r.getCapabilities=function(){const e=RTCRtpReceiver.getCapabilities(),t=a.clone(e,{});for(const e of t.codecs){if(e.channels=e.numChannels,delete e.numChannels,e.mimeType=e.mimeType||`${e.kind}/${e.name}`,e.parameters){const t=e.parameters;t.apt&&(t.apt=+t.apt),t["packetization-mode"]&&(t["packetization-mode"]=+t["packetization-mode"])}for(const t of e.rtcpFeedback||[])t.parameter||(t.parameter="")}return t},r.mangleRtpParameters=function(e){const t=a.clone(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);for(const r of t.codecs)r.channels&&(r.numChannels=r.channels,delete r.channels),r.mimeType&&!r.name&&(r.name=r.mimeType.split("/")[1]),delete r.mimeType;return t}},{"../../utils":59}],50:[function(e,t,r){"use strict";function a(e){const t=/^(audio|video)\/(.+)/i,r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");return r[2]}Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../utils");class s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:a=!1}){if(this._mediaObject={},this._planB=a,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={};t.component=1,t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return this._mediaObject.mid+""}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}r.MediaSection=s;r.AnswerMediaSection=class extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:s,plainRtpParameters:o,planB:l=!1,offerMediaObject:i,offerRtpParameters:d,answerRtpParameters:c,codecOptions:p,extmapAllowMixed:m=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:l}),this._mediaObject.mid=i.mid+"",this._mediaObject.type=i.type,this._mediaObject.protocol=i.protocol,o?(this._mediaObject.connection={ip:o.ip,version:o.ipVersion},this._mediaObject.port=o.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),i.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of c.codecs){const t={payload:e.payloadType,codec:a(e),rate:e.clockRate};1<e.channels&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=n.clone(e.parameters,{});if(p){const{opusStereo:t,opusFec:a,opusDtx:n,opusMaxPlaybackRate:s,opusPtime:o,videoGoogleStartBitrate:i,videoGoogleMaxBitrate:c,videoGoogleMinBitrate:l}=p,m=d.codecs.find(t=>t.payloadType===e.payloadType);switch(e.mimeType.toLowerCase()){case"audio/opus":{void 0!==t&&(m.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==a&&(m.parameters.useinbandfec=a?1:0,r.useinbandfec=a?1:0),void 0!==n&&(m.parameters.usedtx=n?1:0,r.usedtx=n?1:0),void 0!==s&&(r.maxplaybackrate=s),void 0!==o&&(m.parameters.ptime=o,r.ptime=o);break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{void 0!==i&&(r["x-google-start-bitrate"]=i),void 0!==c&&(r["x-google-max-bitrate"]=c),void 0!==l&&(r["x-google-min-bitrate"]=l);break}}}const s={payload:e.payloadType,config:""};for(const e of Object.keys(r))s.config&&(s.config+=";"),s.config+=`${e}=${r[e]}`;s.config&&this._mediaObject.fmtp.push(s);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const e of c.headerExtensions){const t=(i.ext||[]).some(t=>t.uri===e.uri);t&&this._mediaObject.ext.push({uri:e.uri,value:e.id})}if(m&&"extmap-allow-mixed"===i.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),i.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:i.simulcast.list1},this._mediaObject.rids=[];for(const e of i.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(i.simulcast_03){this._mediaObject.simulcast_03={value:i.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of i.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{"number"==typeof i.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=s.port,this._mediaObject.maxMessageSize=s.maxMessageSize):i.sctpmap&&(this._mediaObject.payloads=s.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize});break}}}setDtlsRole(e){"client"===e?this._mediaObject.setup="active":"server"===e?this._mediaObject.setup="passive":"auto"===e?this._mediaObject.setup="actpass":void 0}};r.OfferMediaSection=class extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:s,planB:l=!1,mid:o,kind:i,offerRtpParameters:d,streamId:c,trackId:p,oldDataChannelSpec:m=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:l}),this._mediaObject.mid=o+"",this._mediaObject.type=i,s?(this._mediaObject.connection={ip:s.ip,version:s.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=s.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=n?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),i){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${c||"-"} ${p}`);for(const e of d.codecs){const t={payload:e.payloadType,codec:a(e),rate:e.clockRate};1<e.channels&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType,config:""};for(const t of Object.keys(e.parameters))r.config&&(r.config+=";"),r.config+=`${t}=${e.parameters[t]}`;r.config&&this._mediaObject.fmtp.push(r);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=d.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const e of d.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=d.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],d.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${c||"-"} ${p}`}),r&&(d.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${c||"-"} ${p}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":{m?(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize);break}}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const a=e.encodings[0],n=a.ssrc,s=a.rtx&&a.rtx.ssrc?a.rtx.ssrc:void 0;e.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} ${r}`}),s&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${s}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,a=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(e=>e.id!==r&&e.id!==a),a&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(e=>`${r} ${a}`!==e.ssrcs))}}},{"../../utils":59}],51:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform"),n=e("../../Logger"),s=e("./MediaSection"),o=new n.Logger("RemoteSdp");r.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:s=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=a,this._plainRtpParameters=n,this._planB=s,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}n&&(this._sdpObject.origin.address=n.ip,this._sdpObject.origin.ipVer=n.ipVersion)}updateIceParameters(e){o.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){o.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n,extmapAllowMixed:o=!1}){const i=new s.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n,extmapAllowMixed:o});t?this._replaceMediaSection(i,t):this._midToIndex.has(i.mid)?this._replaceMediaSection(i):this._addMediaSection(i)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:n}){const o=this._midToIndex.get(e);let i;if(void 0!==o&&(i=this._mediaSections[o]),!i){i=new s.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:n});const o=this._mediaSections.find(e=>e.closed);o?this._replaceMediaSection(i,o.mid):this._addMediaSection(i)}else i.planBReceive({offerRtpParameters:r,streamId:a,trackId:n}),this._replaceMediaSection(i)}disableMediaSection(e){const t=this._midToIndex.get(e);if(t===void 0)throw new Error(`no media section found with mid '${e}'`);const r=this._mediaSections[t];r.disable()}closeMediaSection(e){const t=this._midToIndex.get(e);if(t===void 0)throw new Error(`no media section found with mid '${e}'`);const r=this._mediaSections[t];return e===this._firstMid?(o.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),void this.disableMediaSection(e)):void(r.close(),this._regenerateBundleMids())}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._midToIndex.get(e);if(r===void 0)throw new Error(`no media section found with mid '${e}'`);const a=this._mediaSections[r];a.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(a)}sendSctpAssociation({offerMediaObject:e}){const t=new s.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new s.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,a.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(r===void 0)throw new Error(`no media section found for reuseMid '${t}'`);const a=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(a.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(t===void 0)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}}},{"../../Logger":35,"./MediaSection":50,"sdp-transform":80}],52:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("sdp-transform");r.extractRtpCapabilities=function({sdpObject:e}){const t=new Map,r=[];let n=!1,s=!1;for(const o of e.media){const e=o.type;switch(e){case"audio":{if(n)continue;n=!0;break}case"video":{if(s)continue;s=!0;break}default:continue;}for(const r of o.rtp){const a={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(a.preferredPayloadType,a)}for(const e of o.fmtp||[]){const r=a.parseParams(e.config),n=t.get(e.payload);n&&(r&&r["profile-level-id"]&&(r["profile-level-id"]=r["profile-level-id"]+""),n.parameters=r)}for(const e of o.rtcpFb||[]){const r=t.get(e.payload);if(!r)continue;const a={type:e.type,parameter:e.subtype};a.parameter||delete a.parameter,r.rtcpFeedback.push(a)}for(const t of o.ext||[]){if(t["encrypt-uri"])continue;const a={kind:e,uri:t.uri,preferredId:t.value};r.push(a)}}const o={codecs:Array.from(t.values()),headerExtensions:r};return o},r.extractDtlsParameters=function({sdpObject:e}){const t=(e.media||[]).find(e=>e.iceUfrag&&0!==e.port);if(!t)throw new Error("no active media section found");const r=t.fingerprint||e.fingerprint;let a;switch(t.setup){case"active":a="client";break;case"passive":a="server";break;case"actpass":a="auto";}const n={role:a,fingerprints:[{algorithm:r.type,value:r.hash}]};return n},r.getCname=function({offerMediaObject:e}){const t=(e.ssrcs||[]).find(e=>"cname"===e.attribute);return t?t.value:""},r.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(const n of e.codecs){const e=n.mimeType.toLowerCase();if("audio/opus"!==e)continue;const r=(t.rtp||[]).find(e=>e.payload===n.payloadType);if(!r)continue;t.fmtp=t.fmtp||[];let s=t.fmtp.find(e=>e.payload===n.payloadType);s||(s={payload:n.payloadType,config:""},t.fmtp.push(s));const o=a.parseParams(s.config);switch(e){case"audio/opus":{const e=n.parameters["sprop-stereo"];e!==void 0&&(o.stereo=e?1:0);break}}s.config="";for(const e of Object.keys(o))s.config&&(s.config+=";"),s.config+=`${e}=${o[e]}`}}},{"sdp-transform":80}],53:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getRtpEncodings=function({offerMediaObject:e,track:t}){let r;const a=new Set;for(const n of e.ssrcs||[]){if("msid"!==n.attribute)continue;const e=n.value.split(" ")[1];if(e===t.id){const e=n.id;a.add(e),r||(r=e)}}if(0===a.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const n=new Map;for(const r of e.ssrcGroups||[]){if("FID"!==r.semantics)continue;let[e,t]=r.ssrcs.split(/\s+/);e=+e,t=+t,a.has(e)&&(a.delete(e),a.delete(t),n.set(e,t))}for(const r of a)n.set(r,null);const s=[];for(const[r,a]of n){const e={ssrc:r};a&&(e.rtx={ssrc:a}),s.push(e)}return s},r.addLegacySimulcast=function({offerMediaObject:e,track:t,numStreams:r}){if(1>=r)throw new TypeError("numStreams must be greater than 1");let a,n,s;const o=(e.ssrcs||[]).find(e=>{if("msid"!==e.attribute)return!1;const r=e.value.split(" ")[1];return!(r!==t.id)&&(a=e.id,s=e.value.split(" ")[0],!0)});if(!o)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(e.ssrcGroups||[]).some(e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return!(+t[0]!==a)&&(n=+t[1],!0)});const i=e.ssrcs.find(e=>"cname"===e.attribute&&e.id===a);if(!i)throw new Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);const d=i.value,c=[],p=[];for(let s=0;s<r;++s)c.push(a+s),n&&p.push(n+s);e.ssrcGroups=e.ssrcGroups||[],e.ssrcs=e.ssrcs||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let a=0;a<c.length;++a){const r=c[a];e.ssrcs.push({id:r,attribute:"cname",value:d}),e.ssrcs.push({id:r,attribute:"msid",value:`${s} ${t.id}`})}for(let a=0;a<p.length;++a){const r=c[a],n=p[a];e.ssrcs.push({id:n,attribute:"cname",value:d}),e.ssrcs.push({id:n,attribute:"msid",value:`${s} ${t.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${n}`})}}},{}],54:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getRtpEncodings=function({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new Error("no a=ssrc lines found");const r=new Map;for(const a of e.ssrcGroups||[]){if("FID"!==a.semantics)continue;let[e,n]=a.ssrcs.split(/\s+/);e=+e,n=+n,t.has(e)&&(t.delete(e),t.delete(n),r.set(e,n))}for(const a of t)r.set(a,null);const a=[];for(const[t,n]of r){const e={ssrc:t};n&&(e.rtx={ssrc:n}),a.push(e)}return a},r.addLegacySimulcast=function({offerMediaObject:e,numStreams:t}){if(1>=t)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find(e=>"msid"===e.attribute);if(!r)throw new Error("a=ssrc line with msid information not found");const[a,n]=r.value.split(" ")[0],s=r.id;let o;(e.ssrcGroups||[]).some(e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return!(+t[0]!==s)&&(o=+t[1],!0)});const i=e.ssrcs.find(e=>"cname"===e.attribute);if(!i)throw new Error("a=ssrc line with cname information not found");const d=i.value,c=[],p=[];for(let r=0;r<t;++r)c.push(s+r),o&&p.push(o+r);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let r=0;r<c.length;++r){const t=c[r];e.ssrcs.push({id:t,attribute:"cname",value:d}),e.ssrcs.push({id:t,attribute:"msid",value:`${a} ${n}`})}for(let r=0;r<p.length;++r){const t=c[r],s=p[r];e.ssrcs.push({id:s,attribute:"cname",value:d}),e.ssrcs.push({id:s,attribute:"msid",value:`${a} ${n}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${s}`})}}},{}],55:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=e("./Device");r.Device=a.Device,r.detectDevice=a.detectDevice;const n=e("./types");r.types=n,r.version="3.6.26";var s=e("./scalabilityModes");r.parseScalabilityMode=s.parse},{"./Device":33,"./scalabilityModes":57,"./types":58}],56:[function(e,t,r){"use strict";function a(e){const t=/^(audio|video)\/(.+)/i;if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)n(t)}function n(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function s(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(e.kind&&"string"==typeof e.kind||(e.kind=""),""!==e.kind&&"audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");else e.preferredEncrypt||(e.preferredEncrypt=!1);if(e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");else e.direction||(e.direction="sendrecv")}function o(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)i(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");else e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)d(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");else e.encodings||(e.encodings=[]);for(const t of e.encodings)c(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");else e.rtcp||(e.rtcp={});p(e.rtcp)}function i(e){const t=/^(audio|video)\/(.+)/i;if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");const a=r[1].toLowerCase();"audio"===a?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)n(t)}function d(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");else e.encrypt||(e.encrypt=!1);e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function c(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");else if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function p(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function l(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function m(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function u(e,t,{strict:r=!1,modify:a=!1}={}){const n=e.mimeType.toLowerCase(),s=t.mimeType.toLowerCase();if(n!==s)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(n){case"video/h264":{const n=e.parameters["packetization-mode"]||0,s=t.parameters["packetization-mode"]||0;if(n!==s)return!1;if(r){if(!b.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=b.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}a&&(r?(e.parameters["profile-level-id"]=r,t.parameters["profile-level-id"]=r):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break}case"video/vp9":{if(r){const r=e.parameters["profile-id"]||0,a=t.parameters["profile-id"]||0;if(r!==a)return!1}break}}return!0}function g(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind)&&!(e.uri!==t.uri)}function f(e,t){const r=[];for(const a of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find(e=>e.type===a.type&&(e.parameter===a.parameter||!e.parameter&&!a.parameter));e&&r.push(e)}return r}Object.defineProperty(r,"__esModule",{value:!0});const b=e("h264-profile-level-id"),_=e("./utils");r.validateRtpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");else e.codecs||(e.codecs=[]);for(const t of e.codecs)a(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");else e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)s(t)},r.validateRtpCodecCapability=a,r.validateRtcpFeedback=n,r.validateRtpHeaderExtension=s,r.validateRtpParameters=o,r.validateRtpCodecParameters=i,r.validateRtpHeaderExtensionParameters=d,r.validateRtpEncodingParameters=c,r.validateRtcpParameters=p,r.validateSctpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");l(e.numStreams)},r.validateNumSctpStreams=l,r.validateSctpParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},r.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");else!t&&(e.maxPacketLifeTime||e.maxRetransmits)&&(e.ordered=!1);if(e.priority&&"string"!=typeof e.priority)throw new TypeError("invalid params.priority");if(e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},r.getExtendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};for(const a of t.codecs||[]){if(m(a))continue;const t=(e.codecs||[]).find(e=>u(e,a,{strict:!0,modify:!0}));if(!t)continue;const n={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:a.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:a.parameters,rtcpFeedback:f(t,a)};r.codecs.push(n)}for(const a of r.codecs){const r=e.codecs.find(e=>m(e)&&e.parameters.apt===a.localPayloadType),n=t.codecs.find(e=>m(e)&&e.parameters.apt===a.remotePayloadType);r&&n&&(a.localRtxPayloadType=r.preferredPayloadType,a.remoteRtxPayloadType=n.preferredPayloadType)}for(const a of t.headerExtensions){const t=e.headerExtensions.find(e=>g(e,a));if(!t)continue;const n={kind:a.kind,uri:a.uri,sendId:t.preferredId,recvId:a.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(a.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive";}r.headerExtensions.push(n)}return r},r.getRecvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.remotePayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.remoteRtxPayloadType)continue;const a={mimeType:`${r.kind}/rtx`,kind:r.kind,preferredPayloadType:r.remoteRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.remotePayloadType},rtcpFeedback:[]};t.codecs.push(a)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.recvId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t},r.getSendingRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const a of t.codecs){if(a.kind!==e)continue;const t={mimeType:a.mimeType,payloadType:a.localPayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.localParameters,rtcpFeedback:a.rtcpFeedback};if(r.codecs.push(t),a.localRtxPayloadType){const e={mimeType:`${a.kind}/rtx`,payloadType:a.localRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||"sendrecv"!==a.direction&&"sendonly"!==a.direction)continue;const t={uri:a.uri,id:a.sendId,encrypt:a.encrypt,parameters:{}};r.headerExtensions.push(t)}return r},r.getSendingRemoteRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const a of t.codecs){if(a.kind!==e)continue;const t={mimeType:a.mimeType,payloadType:a.localPayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.remoteParameters,rtcpFeedback:a.rtcpFeedback};if(r.codecs.push(t),a.localRtxPayloadType){const e={mimeType:`${a.kind}/rtx`,payloadType:a.localRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||"sendrecv"!==a.direction&&"sendonly"!==a.direction)continue;const t={uri:a.uri,id:a.sendId,encrypt:a.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter(e=>"goog-remb"!==e.type);else if(r.headerExtensions.some(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type);else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type&&"goog-remb"!==e.type);return r},r.reduceCodecs=function(e,t){const r=[];if(!t)r.push(e[0]),m(e[1])&&r.push(e[1]);else{for(let a=0;a<e.length;++a)if(u(e[a],t)){r.push(e[a]),m(e[a+1])&&r.push(e[a+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}return r},r.generateProbatorRtpParameters=function(e){e=_.clone(e,{}),o(e);const t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},r.canSend=function(e,t){return t.codecs.some(t=>t.kind===e)},r.canReceive=function(e,t){if(o(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some(e=>e.remotePayloadType===r.payloadType)}},{"./utils":59,"h264-profile-level-id":29}],57:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const a=/^[LS]([1-9]\d{0,1})T([1-9]\d{0,1})/;r.parse=function(e){const t=a.exec(e||"");return t?{spatialLayers:+t[1],temporalLayers:+t[2]}:{spatialLayers:1,temporalLayers:1}}},{}],58:[function(e,t,r){"use strict";function a(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),a(e("./Device")),a(e("./Transport")),a(e("./Producer")),a(e("./Consumer")),a(e("./DataProducer")),a(e("./DataConsumer")),a(e("./handlers/HandlerInterface")),a(e("./errors"))},{"./Consumer":30,"./DataConsumer":31,"./DataProducer":32,"./Device":33,"./Producer":36,"./Transport":37,"./errors":38,"./handlers/HandlerInterface":45}],59:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.clone=function(e,t){return"undefined"==typeof e?t:JSON.parse(JSON.stringify(e))},r.generateRandomNumber=function(){return c(1e7*Math.random())}},{}],60:[function(e,r,a){!function(n,e){"object"==typeof a&&"object"==typeof r?r.exports=e():"function"==typeof l&&l.amd?l([],e):"object"==typeof a?a.bowser=e():n.bowser=e()}(this,function(){return function(a){function s(t){if(e[t])return e[t].exports;var r=e[t]={i:t,l:!1,exports:{}};return a[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}var e={};return s.m=a,s.c=e,s.d=function(r,e,t){s.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:t})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(r,a){if(1&a&&(r=s(r)),8&a)return r;if(4&a&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&a&&"string"!=typeof r)for(var n in r)s.d(t,n,function(e){return r[e]}.bind(null,n));return t},s.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return s.d(e,"a",e),e},s.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},s.p="",s(s.s=90)}({17:function(a,e,s){"use strict";e.__esModule=!0,e.default=void 0;var r=s(18),n=function(){function c(){}return c.getFirstMatch=function(a,e){var t=e.match(a);return t&&0<t.length&&t[1]||""},c.getSecondMatch=function(a,e){var t=e.match(a);return t&&1<t.length&&t[2]||""},c.matchAndReturnConst=function(a,e,t){if(a.test(e))return t},c.getWindowsVersionName=function(t){return"NT"===t?"NT":"XP"===t?"XP":"NT 5.0"===t?"2000":"NT 5.1"===t?"XP":"NT 5.2"===t?"2003":"NT 6.0"===t?"Vista":"NT 6.1"===t?"7":"NT 6.2"===t?"8":"NT 6.3"===t?"8.1":"NT 10.0"===t?"10":void 0},c.getMacOSVersionName=function(r){var e=r.split(".").splice(0,2).map(function(t){return parseInt(t,10)||0});if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:}},c.getAndroidVersionName=function(r){var e=r.split(".").splice(0,2).map(function(t){return parseInt(t,10)||0});if(e.push(0),!(1===e[0]&&5>e[1]))return 1===e[0]&&6>e[1]?"Cupcake":1===e[0]&&6<=e[1]?"Donut":2===e[0]&&2>e[1]?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&2<e[1]?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&1>e[1]?"Ice Cream Sandwich":4===e[0]&&4>e[1]?"Jelly Bean":4===e[0]&&4<=e[1]?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},c.getVersionPrecision=function(t){return t.split(".").length},c.compareVersions=function(e,p,r){void 0===r&&(r=!1);var l=c.getVersionPrecision(e),i=c.getVersionPrecision(p),s=d(l,i),m=0,g=c.map([e,p],function(e){var t=s-c.getVersionPrecision(e),r=e+Array(t+1).join(".0");return c.map(r.split("."),function(t){return Array(20-t.length).join("0")+t}).reverse()});for(r&&(m=s-t(l,i)),s-=1;s>=m;){if(g[0][s]>g[1][s])return 1;if(g[0][s]===g[1][s]){if(s===m)return 0;s-=1}else if(g[0][s]<g[1][s])return-1}},c.map=function(a,e){var t=[],n;if(Array.prototype.map)return Array.prototype.map.call(a,e);for(n=0;n<a.length;n+=1)t.push(e(a[n]));return t},c.find=function(a,e){var t,s;if(Array.prototype.find)return Array.prototype.find.call(a,e);for(t=0,s=a.length;t<s;t+=1){var o=a[t];if(e(o,t))return o}},c.assign=function(d){for(var c=d,e=arguments.length,n=Array(1<e?e-1:0),s=1,i,p;s<e;s++)n[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[d].concat(n));var l=function(){var r=n[i];"object"==typeof r&&null!==r&&Object.keys(r).forEach(function(e){c[e]=r[e]})};for(i=0,p=n.length;i<p;i+=1)l();return d},c.getBrowserAlias=function(t){return r.BROWSER_ALIASES_MAP[t]},c.getBrowserTypeByAlias=function(t){return r.BROWSER_MAP[t]||""},c}();e.default=n,a.exports=e.default},18:function(r,e){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(d,e,t){"use strict";function c(a,e){for(var t=0,s;t<e.length;t++)s=e[t],s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(a,s.key,s)}e.__esModule=!0,e.default=void 0;var r=(o=t(91))&&o.__esModule?o:{default:o},a=t(18),s=function(){function s(){}var e,o,i;return s.getParser=function(a,e){if(void 0===e&&(e=!1),"string"!=typeof a)throw new Error("UserAgent should be a string");return new r.default(a,e)},s.parse=function(t){return new r.default(t).getResult()},e=s,i=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}],(o=null)&&c(e.prototype,o),i&&c(e,i),s}(),o;e.default=s,d.exports=e.default},91:function(c,e,t){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0,e.default=void 0;var p=r(t(92)),n=r(t(93)),i=r(t(94)),s=r(t(95)),m=r(t(17)),a=function(){function r(r,e){if(void 0===e&&(e=!1),null==r||""===r)throw new Error("UserAgent parameter can't be empty");this._ua=r,this.parsedResult={},!0!==e&&this.parse()}var e=r.prototype;return e.getUA=function(){return this._ua},e.test=function(t){return t.test(this._ua)},e.parseBrowser=function(){var r=this;this.parsedResult.browser={};var e=m.default.find(p.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},e.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},e.getBrowserName=function(t){return t?(this.getBrowser().name+"").toLowerCase()||"":this.getBrowser().name||""},e.getBrowserVersion=function(){return this.getBrowser().version},e.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},e.parseOS=function(){var r=this;this.parsedResult.os={};var e=m.default.find(n.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},e.getOSName=function(r){var e=this.getOS().name;return r?(e+"").toLowerCase()||"":e||""},e.getOSVersion=function(){return this.getOS().version},e.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},e.getPlatformType=function(r){void 0===r&&(r=!1);var a=this.getPlatform().type;return r?(a+"").toLowerCase()||"":a||""},e.parsePlatform=function(){var r=this;this.parsedResult.platform={};var e=m.default.find(i.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},e.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},e.getEngineName=function(t){return t?(this.getEngine().name+"").toLowerCase()||"":this.getEngine().name||""},e.parseEngine=function(){var r=this;this.parsedResult.engine={};var e=m.default.find(s.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},e.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},e.getResult=function(){return m.default.assign({},this.parsedResult)},e.satisfies=function(o){var p=this,e={},r=0,g={},i=0;if(Object.keys(o).forEach(function(n){var t=o[n];"string"==typeof t?(g[n]=t,i+=1):"object"==typeof t&&(e[n]=t,r+=1)}),0<r){var t=Object.keys(e),a=m.default.find(t,function(t){return p.isOS(t)});if(a){var u=this.satisfies(e[a]);if(void 0!==u)return u}var d=m.default.find(t,function(t){return p.isPlatform(t)});if(d){var c=this.satisfies(e[d]);if(void 0!==c)return c}}if(0<i){var f=Object.keys(g),l=m.default.find(f,function(t){return p.isBrowser(t,!0)});if(void 0!==l)return this.compareVersion(g[l])}},e.isBrowser=function(a,e){void 0===e&&(e=!1);var s=this.getBrowserName().toLowerCase(),r=a.toLowerCase(),o=m.default.getBrowserTypeByAlias(r);return e&&o&&(r=o.toLowerCase()),r===s},e.compareVersion=function(a){var e=[0],s=a,o=!1,d=this.getBrowserVersion();if("string"==typeof d)return">"===a[0]||"<"===a[0]?(s=a.substr(1),"="===a[1]?(o=!0,s=a.substr(2)):e=[],">"===a[0]?e.push(1):e.push(-1)):"="===a[0]?s=a.substr(1):"~"===a[0]&&(o=!0,s=a.substr(1)),-1<e.indexOf(m.default.compareVersions(d,s,o))},e.isOS=function(t){return this.getOSName(!0)===(t+"").toLowerCase()},e.isPlatform=function(t){return this.getPlatformType(!0)===(t+"").toLowerCase()},e.isEngine=function(t){return this.getEngineName(!0)===(t+"").toLowerCase()},e.is=function(r,e){return void 0===e&&(e=!1),this.isBrowser(r,e)||this.isOS(r)||this.isPlatform(r)},e.some=function(r){var a=this;return void 0===r&&(r=[]),r.some(function(t){return a.is(t)})},r}();e.default=a,c.exports=e.default},92:function(o,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(a=t(17))&&a.__esModule?a:{default:a},i=/version\/(\d+(\.?_?\d+)+)/i,r=[{test:[/googlebot/i],describe:function(a){var e={name:"Googlebot"},t=d.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/opera/i],describe:function(a){var e={name:"Opera"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/opr\/|opios/i],describe:function(a){var e={name:"Opera"},t=d.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/SamsungBrowser/i],describe:function(a){var e={name:"Samsung Internet for Android"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/Whale/i],describe:function(a){var e={name:"NAVER Whale Browser"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/MZBrowser/i],describe:function(a){var e={name:"MZ Browser"},t=d.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/focus/i],describe:function(a){var e={name:"Focus"},t=d.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/swing/i],describe:function(a){var e={name:"Swing"},t=d.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/coast/i],describe:function(a){var e={name:"Opera Coast"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(a){var e={name:"Opera Touch"},t=d.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/yabrowser/i],describe:function(a){var e={name:"Yandex Browser"},t=d.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/ucbrowser/i],describe:function(a){var e={name:"UC Browser"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/Maxthon|mxios/i],describe:function(a){var e={name:"Maxthon"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/epiphany/i],describe:function(a){var e={name:"Epiphany"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/puffin/i],describe:function(a){var e={name:"Puffin"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/sleipnir/i],describe:function(a){var e={name:"Sleipnir"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/k-meleon/i],describe:function(a){var e={name:"K-Meleon"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/micromessenger/i],describe:function(a){var e={name:"WeChat"},t=d.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/qqbrowser/i],describe:function(a){var e={name:/qqbrowserlite/i.test(a)?"QQ Browser Lite":"QQ Browser"},t=d.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/msie|trident/i],describe:function(a){var e={name:"Internet Explorer"},t=d.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/\sedg\//i],describe:function(a){var e={name:"Microsoft Edge"},t=d.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/edg([ea]|ios)/i],describe:function(a){var e={name:"Microsoft Edge"},t=d.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/vivaldi/i],describe:function(a){var e={name:"Vivaldi"},t=d.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/seamonkey/i],describe:function(a){var e={name:"SeaMonkey"},t=d.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/sailfish/i],describe:function(a){var e={name:"Sailfish"},t=d.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,a);return t&&(e.version=t),e}},{test:[/silk/i],describe:function(a){var e={name:"Amazon Silk"},t=d.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/phantom/i],describe:function(a){var e={name:"PhantomJS"},t=d.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/slimerjs/i],describe:function(a){var e={name:"SlimerJS"},t=d.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(a){var e={name:"BlackBerry"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var e={name:"WebOS Browser"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/bada/i],describe:function(a){var e={name:"Bada"},t=d.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/tizen/i],describe:function(a){var e={name:"Tizen"},t=d.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/qupzilla/i],describe:function(a){var e={name:"QupZilla"},t=d.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/firefox|iceweasel|fxios/i],describe:function(a){var e={name:"Firefox"},t=d.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/electron/i],describe:function(a){var e={name:"Electron"},t=d.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/MiuiBrowser/i],describe:function(a){var e={name:"Miui"},t=d.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/chromium/i],describe:function(a){var e={name:"Chromium"},t=d.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/chrome|crios|crmo/i],describe:function(a){var e={name:"Chrome"},t=d.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/GSA/i],describe:function(a){var e={name:"Google Search"},t=d.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:function(a){var e=!a.test(/like android/i),t=a.test(/android/i);return e&&t},describe:function(a){var e={name:"Android Browser"},t=d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/playstation 4/i],describe:function(a){var e={name:"PlayStation 4"},t=d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/safari|applewebkit/i],describe:function(a){var e={name:"Safari"},t=d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/.*/i],describe:function(r){var e=-1===r.search("\\(")?/^(.*)\/(.*) /:/^(.*)\/(.*)[ \t]\((.*)/;return{name:d.default.getFirstMatch(e,r),version:d.default.getSecondMatch(e,r)}}}],a;e.default=r,o.exports=e.default},93:function(o,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(a=t(17))&&a.__esModule?a:{default:a},i=t(18),r=[{test:[/Roku\/DVP/],describe:function(r){var e=d.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,r);return{name:i.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(r){var e=d.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(a){var e=d.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,a),t=d.default.getWindowsVersionName(e);return{name:i.OS_MAP.Windows,version:e,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(a){var e={name:i.OS_MAP.iOS},t=d.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,a);return t&&(e.version=t),e}},{test:[/macintosh/i],describe:function(a){var e=d.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,a).replace(/[_\s]/g,"."),t=d.default.getMacOSVersionName(e),r={name:i.OS_MAP.MacOS,version:e};return t&&(r.versionName=t),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(r){var e=d.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,r).replace(/[_\s]/g,".");return{name:i.OS_MAP.iOS,version:e}}},{test:function(a){var e=!a.test(/like android/i),t=a.test(/android/i);return e&&t},describe:function(a){var e=d.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,a),t=d.default.getAndroidVersionName(e),r={name:i.OS_MAP.Android,version:e};return t&&(r.versionName=t),r}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var e=d.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,a),t={name:i.OS_MAP.WebOS};return e&&e.length&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(r){var e=d.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,r)||d.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,r)||d.default.getFirstMatch(/\bbb(\d+)/i,r);return{name:i.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(r){var e=d.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(r){var e=d.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:i.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:i.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(r){var e=d.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.PlayStation4,version:e}}}],a;e.default=r,o.exports=e.default},94:function(o,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(a=t(17))&&a.__esModule?a:{default:a},i=t(18),r=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(a){var e=d.default.getFirstMatch(/(can-l01)/i,a)&&"Nova",t={type:i.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(t.model=e),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(a){var e=a.test(/ipod|iphone/i),t=a.test(/like (ipod|iphone)/i);return e&&!t},describe:function(r){var e=d.default.getFirstMatch(/(ipod|iphone)/i,r);return{type:i.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(r){var e=+(r.getOSVersion()+"").split(".")[0];return"android"===r.getOSName(!0)&&3<=e},describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(t){return"playstation 4"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}},{test:function(t){return"roku"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}}],a;e.default=r,o.exports=e.default},95:function(o,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(a=t(17))&&a.__esModule?a:{default:a},i=t(18),r=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(r){if(/\sedg\//i.test(r))return{name:i.ENGINE_MAP.Blink};var e=d.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,r);return{name:i.ENGINE_MAP.EdgeHTML,version:e}}},{test:[/trident/i],describe:function(a){var e={name:i.ENGINE_MAP.Trident},t=d.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:function(t){return t.test(/presto/i)},describe:function(a){var e={name:i.ENGINE_MAP.Presto},t=d.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:function(a){var e=a.test(/gecko/i),t=a.test(/like gecko/i);return e&&!t},describe:function(a){var e={name:i.ENGINE_MAP.Gecko},t=d.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:i.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(a){var e={name:i.ENGINE_MAP.WebKit},t=d.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}}],a;e.default=r,o.exports=e.default}})})},{}],61:[function(e,t,r){(function(a){function n(){let e;try{e=r.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof a&&"env"in a&&(e=a.env.DEBUG),e}r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let a=0,n=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"===e||(a++,"%c"===e&&(n=a))}),e.splice(n,0,r)},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=n,r.useColors=function(){return!!("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},r.storage=function(){try{return localStorage}catch(e){}}(),r.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.log=console.debug||console.log||(()=>{}),t.exports=e("./common")(r);const{formatters:s}=t.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e("_process"))},{"./common":62,_process:64}],62:[function(t,r){r.exports=function(r){function a(e){function t(...e){if(!t.enabled)return;const r=t,n=+new Date,o=n-(s||n);r.diff=o,r.prev=s,r.curr=n,s=n,e[0]=a.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,n)=>{if("%%"===t)return"%";i++;const s=a.formatters[n];if("function"==typeof s){const a=e[i];t=s.call(r,a),e.splice(i,1),i--}return t}),a.formatArgs.call(r,e);const d=r.log||a.log;d.apply(r,e)}let r=null,s;return t.namespace=e,t.useColors=a.useColors(),t.color=a.selectColor(e),t.extend=n,t.destroy=a.destroy,Object.defineProperty(t,"enabled",{enumerable:!0,configurable:!1,get:()=>null===r?a.enabled(e):r,set:e=>{r=e}}),"function"==typeof a.init&&a.init(t),t}function n(e,t){const r=a(this.namespace+("undefined"==typeof t?":":t)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return a.debug=a,a.default=a,a.coerce=function(e){return e instanceof Error?e.stack||e.message:e},a.disable=function(){const e=[...a.names.map(s),...a.skips.map(s).map(e=>"-"+e)].join(",");return a.enable(""),e},a.enable=function(e){a.save(e),a.names=[],a.skips=[];let t;const r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&(e=r[t].replace(/\*/g,".*?"),"-"===e[0]?a.skips.push(new RegExp("^"+e.substr(1)+"$")):a.names.push(new RegExp("^"+e+"$")))},a.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=a.skips.length;t<r;t++)if(a.skips[t].test(e))return!1;for(t=0,r=a.names.length;t<r;t++)if(a.names[t].test(e))return!0;return!1},a.humanize=t("ms"),a.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(r).forEach(e=>{a[e]=r[e]}),a.names=[],a.skips=[],a.formatters={},a.selectColor=function(t){let r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return a.colors[e(r)%a.colors.length]},a.enable(a.load()),a}},{ms:63}],63:[function(t,r){function a(e){if(e+="",!(100<e.length)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),a=(t[2]||"ms").toLowerCase();return"years"===a||"year"===a||"yrs"===a||"yr"===a||"y"===a?31557600000*r:"weeks"===a||"week"===a||"w"===a?604800000*r:"days"===a||"day"===a||"d"===a?86400000*r:"hours"===a||"hour"===a||"hrs"===a||"hr"===a||"h"===a?3600000*r:"minutes"===a||"minute"===a||"mins"===a||"min"===a||"m"===a?60000*r:"seconds"===a||"second"===a||"secs"===a||"sec"===a||"s"===a?1000*r:"milliseconds"===a||"millisecond"===a||"msecs"===a||"msec"===a||"ms"===a?r:void 0}}}function n(t){var r=e(t);return 86400000<=r?c(t/86400000)+"d":3600000<=r?c(t/3600000)+"h":60000<=r?c(t/60000)+"m":1000<=r?c(t/1000)+"s":t+"ms"}function s(t){var r=e(t);return 86400000<=r?o(t,r,86400000,"day"):3600000<=r?o(t,r,3600000,"hour"):60000<=r?o(t,r,60000,"minute"):1000<=r?o(t,r,1000,"second"):t+" ms"}function o(e,t,r,a){return c(e/r)+" "+a+(t>=1.5*r?"s":"")}var i=24*(60*60000);r.exports=function(e,t){t=t||{};var r=typeof e;if("string"==r&&0<e.length)return a(e);if("number"===r&&isFinite(e))return t.long?s(e):n(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],64:[function(e,t){function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function n(t){if(m===setTimeout)return setTimeout(t,0);if((m===r||!m)&&setTimeout)return m=setTimeout,setTimeout(t,0);try{return m(t,0)}catch(r){try{return m.call(null,t,0)}catch(r){return m.call(this,t,0)}}}function s(t){if(u===clearTimeout)return clearTimeout(t);if((u===a||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{return u(t)}catch(r){try{return u.call(null,t)}catch(r){return u.call(this,t)}}}function o(){f&&_&&(f=!1,_.length?g=_.concat(g):b=-1,g.length&&d())}function d(){if(!f){var e=n(o);f=!0;for(var t=g.length;t;){for(_=g,g=[];++b<t;)_&&_[b].run();b=-1,t=g.length}_=null,f=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function p(){}var l=t.exports={},m,u;(function(){try{m="function"==typeof setTimeout?setTimeout:r}catch(t){m=r}try{u="function"==typeof clearTimeout?clearTimeout:a}catch(t){u=a}})();var g=[],f=!1,b=-1,_;l.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];g.push(new c(e,t)),1!==g.length||f||n(d)},c.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=p,l.addListener=p,l.once=p,l.off=p,l.removeListener=p,l.removeAllListeners=p,l.emit=p,l.prependListener=p,l.prependOnceListener=p,l.listeners=function(){return[]},l.binding=function(){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],65:[function(e,t){const{EventEmitter:r}=e("events"),a=e("./Logger");t.exports=class extends r{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new a("EnhancedEventEmitter")}safeEmit(e,...t){try{this.emit(e,...t)}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}async safeEmitAsPromise(e,...t){return new Promise((r,a)=>{this.safeEmit(e,...t,r,a)})}}},{"./Logger":66,events:26}],66:[function(e,t){const r=e("debug"),a="protoo-client";class n{constructor(e){e?(this._debug=r(`${a}:${e}`),this._warn=r(`${a}:WARN:${e}`),this._error=r(`${a}:ERROR:${e}`)):(this._debug=r(a),this._warn=r(`${a}:WARN`),this._error=r(`${a}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}t.exports=n},{debug:27}],67:[function(e,t){const r=e("./Logger"),{generateRandomNumber:a}=e("./utils"),n=new r("Message");t.exports=class{static parse(e){let t;const r={};try{t=JSON.parse(e)}catch(e){return void n.error("parse() | invalid JSON: %s",e)}if("object"!=typeof t||Array.isArray(t))return void n.error("parse() | not an object");if(t.request){if(r.request=!0,"string"!=typeof t.method)return void n.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void n.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void n.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else if(t.notification){if(r.notification=!0,"string"!=typeof t.method)return void n.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}else return void n.error("parse() | missing request/response field");return r}static createRequest(e,t){const r={request:!0,id:a(),method:e,data:t||{}};return r}static createSuccessResponse(e,t){const r={response:!0,id:e.id,ok:!0,data:t||{}};return r}static createErrorResponse(e,t,r){const a={response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r};return a}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}},{"./Logger":66,"./utils":71}],68:[function(e,t){const r=e("./Logger"),a=e("./EnhancedEventEmitter"),n=e("./Message"),s=new r("Peer");class o extends a{constructor(e){super(s),s.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){s.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,t=void 0){const r=n.createRequest(e,t);return this._logger.debug("request() [method:%s, id:%s]",e,r.id),await this._transport.send(r),new Promise((e,t)=>{const a=1500*(15+.1*this._sents.size),n={id:r.id,method:r.method,resolve:t=>{this._sents.delete(r.id)&&(clearTimeout(n.timer),e(t))},reject:e=>{this._sents.delete(r.id)&&(clearTimeout(n.timer),t(e))},timer:setTimeout(()=>{this._sents.delete(r.id)&&t(new Error("request timeout"))},a),close:()=>{clearTimeout(n.timer),t(new Error("peer closed"))}};this._sents.set(r.id,n)})}async notify(e,t=void 0){const r=n.createNotification(e,t);this._logger.debug("notify() [method:%s]",e),await this._transport.send(r)}_handleTransport(){return this._transport.closed?(this._closed=!0,void setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))})):void(this._transport.on("open",()=>{this._closed||(s.debug("emit \"open\""),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(s.debug("emit \"disconnected\""),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",e=>{this._closed||(s.debug("emit \"failed\" [currentAttempt:%s]",e),this._connected=!1,this.safeEmit("failed",e))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,s.debug("emit \"close\""),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)}))}_handleRequest(e){try{this.emit("request",e,t=>{const r=n.createSuccessResponse(e,t);this._transport.send(r).catch(()=>{})},(t,r)=>{t instanceof Error?(t=500,r=t+""):"number"==typeof t&&r instanceof Error&&(r=r+"");const a=n.createErrorResponse(e,t,r);this._transport.send(a).catch(()=>{})})}catch(t){const r=n.createErrorResponse(e,500,t+"");this._transport.send(r).catch(()=>{})}}_handleResponse(e){const t=this._sents.get(e.id);if(!t)return void s.error("received response does not match any sent request [id:%s]",e.id);if(e.ok)t.resolve(e.data);else{const r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}}_handleNotification(e){this.safeEmit("notification",e)}}t.exports=o},{"./EnhancedEventEmitter":65,"./Logger":66,"./Message":67}],69:[function(e,t,r){const{version:a}=e("../package.json"),n=e("./Peer"),s=e("./transports/WebSocketTransport");r.version=a,r.Peer=n,r.WebSocketTransport=s},{"../package.json":72,"./Peer":68,"./transports/WebSocketTransport":70}],70:[function(e,t){const r=e("websocket").w3cwebsocket,a=e("retry"),n=e("../Logger"),s=e("../EnhancedEventEmitter"),o=e("../Message"),i={retries:10,factor:2,minTimeout:1000,maxTimeout:8000},d=new n("WebSocketTransport");class c extends s{constructor(e,t){super(d),d.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){d.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){d.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){throw d.warn("send() failed:%o",e),e}}_runWebSocket(){const e=a.operation(this._options.retry||i);let t=!1;e.attempt(a=>this._closed?void e.stop():void(d.debug("_runWebSocket() [currentAttempt:%s]",a),this._ws=new r(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(t=!0,this.safeEmit("open"))},this._ws.onclose=r=>{if(!this._closed){if(d.warn("WebSocket \"close\" event [wasClean:%s, code:%s, reason:\"%s\"]",r.wasClean,r.code,r.reason),4e3!==r.code)if(!t){if(this.safeEmit("failed",a),this._closed)return;if(e.retry(!0))return}else return(e.stop(),this.safeEmit("disconnected"),this._closed)?void 0:void this._runWebSocket();this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||d.error("WebSocket \"error\" event")},this._ws.onmessage=e=>{if(!this._closed){const t=o.parse(e.data);return t?0===this.listenerCount("message")?void d.error("no listeners for WebSocket \"message\" event, ignoring received message"):void this.safeEmit("message",t):void 0}}))}}t.exports=c},{"../EnhancedEventEmitter":65,"../Logger":66,"../Message":67,retry:76,websocket:84}],71:[function(e,t,r){r.generateRandomNumber=function(){return c(1e7*Math.random())}},{}],72:[function(e,t){t.exports={_from:"protoo-client@^4.0.3",_id:"protoo-client@4.0.3",_inBundle:!1,_integrity:"sha512-+HnxpBOOZ8WovllUUvfcbJa3gLuzhyYdR4A+ytldLmwq6vl5AzFGsenyLJMX6pVuNEJUZ5D7M92zvPesUG+wyQ==",_location:"/protoo-client",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"protoo-client@^4.0.3",name:"protoo-client",escapedName:"protoo-client",rawSpec:"^4.0.3",saveSpec:null,fetchSpec:"^4.0.3"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.3.tgz",_shasum:"3cc1943ce160785777fbda4dcceab196328d0bfd",_spec:"protoo-client@^4.0.3",_where:"/home/alexey/Desktop/Projects/JS/easy-mediasoup-v3-client/app",author:{name:"I\xF1aki Baz Castillo",email:"ibc@aliax.net"},bugs:{url:"https://github.com/ibc/protoo/issues"},bundleDependencies:!1,dependencies:{debug:"^4.1.1",events:"^3.0.0",retry:"^0.12.0",websocket:"^1.0.28"},deprecated:!1,description:"protoo JavaScript client module",devDependencies:{eslint:"^5.16.0"},engines:{node:">=8.0.0"},homepage:"https://protoojs.org",keywords:["nodejs","browser","websocket"],license:"MIT",main:"lib/index.js",name:"protoo-client",optionalDependencies:{websocket:"^1.0.28"},repository:{type:"git",url:"git+https://github.com/ibc/protoo.git"},scripts:{lint:"eslint -c .eslintrc.js lib"},version:"4.0.3"}},{}],73:[function(e,t,r){'use strict';function a(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return null}}function n(e){for(var t=/([^=?&]+)=?([^&]*)/g,r={},n;n=t.exec(e);){var s=a(n[1]),o=a(n[2]);null===s||null===o||s in r||(r[s]=o)}return r}var s=Object.prototype.hasOwnProperty,o;r.stringify=function(e,t){t=t||"";var r=[],a,n;for(n in"string"!=typeof t&&(t="?"),e)if(s.call(e,n)){if(a=e[n],!a&&(null===a||a===o||isNaN(a))&&(a=""),n=encodeURIComponent(n),a=encodeURIComponent(a),null===n||null===a)continue;r.push(n+"="+a)}return r.length?t+r.join("&"):""},r.parse=n},{}],74:[function(e,t){var r=function(e){"use strict";function t(e,t,r,n){var s=t&&t.prototype instanceof a?t:a,o=Object.create(s.prototype),i=new m(n||[]);return o._invoke=d(e,r,i),o}function r(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function a(){}function n(){}function s(){}function o(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function i(e,t){function a(n,s,o,i){var d=r(e[n],e,s);if("throw"===d.type)i(d.arg);else{var c=d.arg,p=c.value;return p&&"object"==typeof p&&b.call(p,"__await")?t.resolve(p.__await).then(function(e){a("next",e,o,i)},function(e){a("throw",e,o,i)}):t.resolve(p).then(function(e){c.value=e,o(c)},function(e){return a("throw",e,o,i)})}}function n(e,r){function n(){return new t(function(t,n){a(e,r,t,n)})}return s=s?s.then(n,n):n()}var s;this._invoke=n}function d(e,t,a){var n="suspendedStart";return function(s,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===s)throw o;return g()}for(a.method=s,a.arg=o;;){var i=a.delegate;if(i){var d=c(i,a);if(d){if(d===y)continue;return d}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===n)throw n="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);n="executing";var p=r(e,t,a);if("normal"===p.type){if(n=a.done?"completed":"suspendedYield",p.arg===y)continue;return{value:p.arg,done:a.done}}"throw"===p.type&&(n="completed",a.method="throw",a.arg=p.arg)}}}function c(e,t){var a=e.iterator[t.method];if(void 0===a){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=void 0,c(e,t),"throw"===t.method))return y;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var n=r(a,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,y;var s=n.arg;if(!s)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y;if(s.done)t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0);else return s;return t.delegate=null,y}function p(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function l(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function m(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(p,this),this.reset(!0)}function u(e){if(e){var t=e[h];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(b.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:g}}function g(){return{value:void 0,done:!0}}var f=Object.prototype,b=f.hasOwnProperty,_="function"==typeof Symbol?Symbol:{},h=_.iterator||"@@iterator",v=_.asyncIterator||"@@asyncIterator",S=_.toStringTag||"@@toStringTag";e.wrap=t;var y={},P={};P[h]=function(){return this};var R=Object.getPrototypeOf,C=R&&R(R(u([])));C&&C!==f&&b.call(C,h)&&(P=C);var k=s.prototype=a.prototype=Object.create(P);return n.prototype=k.constructor=s,s.constructor=n,s[S]=n.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===n||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,!(S in e)&&(e[S]="GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},o(i.prototype),i.prototype[v]=function(){return this},e.AsyncIterator=i,e.async=function(r,a,n,s,o){void 0===o&&(o=Promise);var d=new i(t(r,a,n,s),o);return e.isGeneratorFunction(a)?d:d.next().then(function(e){return e.done?e.value:d.next()})},o(k),k[S]="Generator",k[h]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var a=t.pop();if(a in e)return r.value=a,r.done=!1,r}return r.done=!0,r}},e.values=u,m.prototype={constructor:m,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(l),!e)for(var t in this)"t"===t.charAt(0)&&b.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,a){return s.type="throw",s.arg=e,r.next=t,a&&(r.method="next",r.arg=void 0),!!a}if(this.done)throw e;for(var r=this,a=this.tryEntries.length-1;0<=a;--a){var n=this.tryEntries[a],s=n.completion;if("root"===n.tryLoc)return t("end");if(n.tryLoc<=this.prev){var o=b.call(n,"catchLoc"),d=b.call(n,"finallyLoc");if(o&&d){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);}else if(!d)throw new Error("try statement without catch or finally");else if(this.prev<n.finallyLoc)return t(n.finallyLoc)}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1,a;0<=r;--r)if(a=this.tryEntries[r],a.tryLoc<=this.prev&&b.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var s=n?n.completion:{};return s.type=e,s.arg=t,n?(this.method="next",this.next=n.finallyLoc,y):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1,r;0<=t;--t)if(r=this.tryEntries[t],r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),l(r),y},catch:function(e){for(var t=this.tryEntries.length-1,r;0<=t;--t)if(r=this.tryEntries[t],r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;l(r)}return n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:u(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),y}},e}("object"==typeof t?t.exports:{});try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},{}],75:[function(e,t){'use strict';t.exports=function(e,t){return(t=t.split(":")[0],e=+e,!!e)&&("http"===t||"ws"===t?80!==e:"https"===t||"wss"===t?443!==e:"ftp"===t?21!==e:"gopher"===t?70!==e:"file"!==t&&0!==e)}},{}],76:[function(e,t){t.exports=e("./lib/retry")},{"./lib/retry":77}],77:[function(e,r,a){var n=e("./retry_operation");a.operation=function(e){var t=a.timeouts(e);return new n(t,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},a.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1000,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],n=0;n<t.retries;n++)a.push(this.createTimeout(n,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(n,t)),a.sort(function(e,t){return e-t}),a},a.createTimeout=function(e,r){var a=r.randomize?Math.random()+1:1,n=c(a*r.minTimeout*p(r.factor,e));return n=t(n,r.maxTimeout),n},a.wrap=function(e,t,r){if(t instanceof Array&&(r=t,t=null),!r)for(var n in r=[],e)"function"==typeof e[n]&&r.push(n);for(var s=0;s<r.length;s++){var o=r[s],d=e[o];e[o]=function(r){var n=a.operation(t),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push(function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),o.apply(this,arguments))}),n.attempt(function(){r.apply(e,s)})}.bind(e,d),e[o].options=t}}},{"./retry_operation":78}],78:[function(e,t){function r(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r)if(this._cachedTimeouts)this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift();else return!1;var a=this,n=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r);return this._options.unref&&n.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var n=this._errors[a],s=n.message,o=(e[s]||0)+1;e[s]=o,o>=r&&(t=n,r=o)}return t}},{}],79:[function(e,t){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null==e.address?"rtcp:%d":"rtcp:%d %s IP%d %s"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null==e.subtype?"rtcp-fb:%s %s":"rtcp-fb:%s %s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null==e.sessionConfig?"crypto:%d %s %s":"crypto:%d %s %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null==e.raddr?"%v%v":" raddr %s rport %d",t+=null==e.tcptype?"%v":" tcptype %s",null!=e.generation&&(t+=" generation %d"),t+=null==e["network-id"]?"%v":" network-id %d",t+=null==e["network-cost"]?"%v":" network-cost %d",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null==e.maxMessageSize?"sctpmap:%s %s":"sctpmap:%s %s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:/^imageattr:(\d+|\*)[\s\t]+(send|recv)[\s\t]+(\*|\[\S+\](?:[\s\t]+\[\S+\])*)(?:[\s\t]+(recv|send)[\s\t]+(\*|\[\S+\](?:[\s\t]+\[\S+\])*))?/,names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:/^simulcast:(send|recv) ([a-zA-Z0-9\-_~;,]+)(?:\s?(send|recv) ([a-zA-Z0-9\-_~;,]+))?$/,names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null==e.clksrcExt?"":"=%s")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null==e.id?"%v%s":"id=%s %s",t+=null==e.mediaClockValue?"":"=%s",t+=null==e.rateNumerator?"":" rate=%s",t+=null==e.rateDenominator?"":"/%s",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){var t=r[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],80:[function(e,t,r){var a=e("./parser"),n=e("./writer");r.write=n,r.parse=a.parse,r.parseParams=a.parseParams,r.parseFmtpConfig=a.parseFmtpConfig,r.parsePayloads=a.parsePayloads,r.parseRemoteCandidates=a.parseRemoteCandidates,r.parseImageAttributes=a.parseImageAttributes,r.parseSimulcastStreamList=a.parseSimulcastStreamList},{"./parser":81,"./writer":82}],81:[function(e,t,r){var a=function(e){return+e+""===e?+e:e},n=function(e,t,r,n){if(n&&!r)t[n]=a(e[1]);else for(var s=0;s<r.length;s+=1)null!=e[s+1]&&(t[r[s]]=a(e[s+1]))},s=function(e,t,r){var a=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:a&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:a?t[e.name]:t;n(r.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},o=e("./grammar"),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},r=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach(function(e){var t=e[0],n=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),a=r[r.length-1]);for(var i=0,d;i<(o[t]||[]).length;i+=1)if(d=o[t][i],d.reg.test(n))return s(d,a,n)}),t.media=r,t};var d=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=a(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e};r.parseParams=function(e){return e.split(/;\s?/).reduce(d,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(a),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(d,{})})},r.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t=!1,r;return"~"===e[0]?(r=a(e.substring(1,e.length)),t=!0):r=a(e),{scid:r,paused:t}})})}},{"./grammar":79}],82:[function(e,t){var r=e("./grammar"),a=/%[sdv%]/g,s=function(e){var t=1,r=arguments,n=r.length;return e.replace(a,function(e){if(t>=n)return e;var a=r[t];return t+=1,"%%"===e?"%":"%s"===e?a+"":"%d"===e?+a:"%v"===e?"":void 0})},o=function(e,t,r){var a=t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format,o=[e+"="+a];if(t.names)for(var d=0,c;d<t.names.length;d+=1)c=t.names[d],t.name?o.push(r[t.name][c]):o.push(r[t.names[d]]);else o.push(r[t.name]);return s.apply(null,o)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],d=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var a=t.outerOrder||i,n=t.innerOrder||d,s=[];return a.forEach(function(t){r[t].forEach(function(r){r.name in e&&null!=e[r.name]?s.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){s.push(o(t,r,e))})})}),e.media.forEach(function(e){s.push(o("m",r.m[0],e)),n.forEach(function(t){r[t].forEach(function(r){r.name in e&&null!=e[r.name]?s.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){s.push(o(t,r,e))})})})}),s.join("\r\n")+"\r\n"}},{"./grammar":79}],83:[function(e,t){(function(r){'use strict';function a(e){return(e?e:"").toString().replace(m,"")}function n(e){var t="undefined"==typeof window?"undefined"==typeof r?"undefined"==typeof self?{}:self:r:window;var a=t.location||{};e=e||a;var n={},s=typeof e,o;if("blob:"===e.protocol)n=new d(unescape(e.pathname),{});else if("string"===s)for(o in n=new d(e,{}),g)delete n[o];else if("object"===s){for(o in e)o in g||(n[o]=e[o]);void 0===n.slashes&&(n.slashes=i.test(e.href))}return n}function s(e){e=a(e);var t=l.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function o(e,t){if(""===e)return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),a=r.length,n=r[a-1],s=!1,o=0;a--;)"."===r[a]?r.splice(a,1):".."===r[a]?(r.splice(a,1),o++):o&&(0===a&&(s=!0),r.splice(a,1),o--);return s&&r.unshift(""),("."===n||".."===n)&&r.push(""),r.join("/")}function d(e,t,r){if(e=a(e),!(this instanceof d))return new d(e,t,r);var l=u.slice(),m=typeof t,g=this,f=0,b,_,h,v,S,y;for("object"!=m&&"string"!==m&&(r=t,t=null),r&&"function"!=typeof r&&(r=p.parse),t=n(t),_=s(e||""),b=!_.protocol&&!_.slashes,g.slashes=_.slashes||b&&t.slashes,g.protocol=_.protocol||t.protocol||"",e=_.rest,_.slashes||(l[3]=[/(.*)/,"pathname"]);f<l.length;f++){if(v=l[f],"function"==typeof v){e=v(e);continue}h=v[0],y=v[1],h===h?"string"==typeof h?~(S=e.indexOf(h))&&("number"==typeof v[2]?(g[y]=e.slice(0,S),e=e.slice(S+v[2])):(g[y]=e.slice(S),e=e.slice(0,S))):(S=h.exec(e))&&(g[y]=S[1],e=e.slice(0,S.index)):g[y]=e,g[y]=g[y]||(b&&v[3]?t[y]||"":""),v[4]&&(g[y]=g[y].toLowerCase())}r&&(g.query=r(g.query)),b&&t.slashes&&"/"!==g.pathname.charAt(0)&&(""!==g.pathname||""!==t.pathname)&&(g.pathname=o(g.pathname,t.pathname)),c(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(v=g.auth.split(":"),g.username=v[0]||"",g.password=v[1]||""),g.origin=g.protocol&&g.host&&"file:"!==g.protocol?g.protocol+"//"+g.host:"null",g.href=g.toString()}var c=e("requires-port"),p=e("querystringify"),i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,l=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,m=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,u=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],g={hash:1,query:1};d.prototype={set:function(e,t,r){var a=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||p.parse)(t)),a[e]=t;break;case"port":a[e]=t,c(t,a.protocol)?t&&(a.host=a.hostname+":"+t):(a.host=a.hostname,a[e]="");break;case"hostname":a[e]=t,a.port&&(t+=":"+a.port),a.host=t;break;case"host":a[e]=t,/:\d+$/.test(t)?(t=t.split(":"),a.port=t.pop(),a.hostname=t.join(":")):(a.hostname=t,a.port="");break;case"protocol":a.protocol=t.toLowerCase(),a.slashes=!r;break;case"pathname":case"hash":if(t){var n="pathname"===e?"/":"#";a[e]=t.charAt(0)===n?t:n+t}else a[e]=t;break;default:a[e]=t;}for(var s=0,o;s<u.length;s++)o=u[s],o[4]&&(a[o[1]]=a[o[1]].toLowerCase());return a.origin=a.protocol&&a.host&&"file:"!==a.protocol?a.protocol+"//"+a.host:"null",a.href=a.toString(),a},toString:function(e){e&&"function"==typeof e||(e=p.stringify);var t=this,r=t.protocol,a;r&&":"!==r.charAt(r.length-1)&&(r+=":");var n=r+(t.slashes?"//":"");return t.username&&(n+=t.username,t.password&&(n+=":"+t.password),n+="@"),n+=t.host+t.pathname,a="object"==typeof t.query?e(t.query):t.query,a&&(n+="?"===a.charAt(0)?a:"?"+a),t.hash&&(n+=t.hash),n}},d.extractProtocol=s,d.location=n,d.trimLeft=a,d.qs=p,t.exports=d}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{querystringify:73,"requires-port":75}],84:[function(e,t){(function(r){function a(e,t){var r;return r=t?new s(e,t):new s(e),r}var n=function(){return this||"undefined"==typeof r?this:r}(),s=n.WebSocket||n.MozWebSocket,o=e("./version");s&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(a,e,{get:function(){return s[e]}})}),t.exports={w3cwebsocket:s?a:null,version:o}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"./version":85}],85:[function(e,t){t.exports=e("../package.json").version},{"../package.json":86}],86:[function(e,t){t.exports={_from:"websocket@^1.0.28",_id:"websocket@1.0.30",_inBundle:!1,_integrity:"sha512-aO6klgaTdSMkhfl5VVJzD5fm+Srhh5jLYbS15+OiI1sN6h/RU/XW6WN9J1uVIpUKNmsTvT3Hs35XAFjn9NMfOw==",_location:"/websocket",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"websocket@^1.0.28",name:"websocket",escapedName:"websocket",rawSpec:"^1.0.28",saveSpec:null,fetchSpec:"^1.0.28"},_requiredBy:["/protoo-client"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.30.tgz",_shasum:"91d3bd00c3d43e916f0cf962f8f8c451bb0b2373",_spec:"websocket@^1.0.28",_where:"/home/alexey/Desktop/Projects/JS/easy-mediasoup-v3-client/app/node_modules/protoo-client",author:{name:"Brian McKelvey",email:"theturtle32@gmail.com",url:"https://github.com/theturtle32"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},bundleDependencies:!1,config:{verbose:!1},contributors:[{name:"I\xF1aki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.14.0","typedarray-to-buffer":"^3.1.5",yaeti:"^0.0.6"},deprecated:!1,description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",faucet:"^0.0.1",gulp:"^4.0.2","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.9.1"},directories:{lib:"./lib"},engines:{node:">=0.10.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.30"}},{}],87:[function(e,t){function r(){}t.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e){this.callbacks=this.callbacks||{};var t=3===arguments.length,r=t?arguments[1]:void 0,a=t?arguments[2]:arguments[1];return a._groupName=r,(this.callbacks[e]=this.callbacks[e]||[]).push(a),this},t.once=function(e){function t(){r.off(e,t),s.apply(this,arguments)}var r=this,a=3===arguments.length,n=a?arguments[1]:void 0,s=a?arguments[2]:arguments[1];return this.on(e,n,t),this},t.releaseGroup=function(e){this.callbacks=this.callbacks||{};var t,r,a,n;for(t in this.callbacks)for(n=this.callbacks[t],r=0,a=n.length;r<a;r++)n[r]._groupName===e&&(n.splice(r,1),r--,a--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r=this.callbacks[e],a;return r?1===arguments.length?(delete this.callbacks[e],this):(a=r.indexOf(t),-1!==a&&(r.splice(a,1),0===r.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t=[].slice.call(arguments,1),r=this.callbacks[e],a=this.getWildcardCallbacks(e),n,s,o;if(r)for(o=r.slice(),n=0,s=o.length;n<s&&!!o[n];++n)o[n].apply(this,t);if(a)for(s=a.length,o=a.slice(),(n=0,s=o.length);n<s&&!!o[n];++n)o[n].apply(this,[e].concat(t));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t=[],r,a;for(r in this.callbacks)a=r.split("*"),("*"===r||2===a.length&&e.slice(0,a[0].length)===a[0])&&(t=t.concat(this.callbacks[r]));return t}},r.mixin(r)},{}],88:[function(e,t){t.exports={name:"easy-mediasoup-v3-client",version:"0.1.56",private:!1,description:"easy-mediasoup-v3-client",author:"Alexey Panfilkin",license:"MIT",main:"dist/easy-mediasoup.bundle.js",scripts:{lint:"eslint -c .eslintrc.js --fix --ext .js,.ts lib",start:"gulp live",clean:"rm -rf es5-bundle && rm -rf dist/*","babel-build":"NODE_ENV=production babel ./lib -d ./es5-bundle --ignore test.js --extensions .ts",bundle_build:"npm run clean && npm run babel-build && NODE_ENV=production node build.js && npm run minify && npm run size",minify:"NODE_ENV=production minify dist/easy-mediasoup.bundle.js -o dist/easy-mediasoup.bundle.min.js",size:"ls -lah dist"},dependencies:{"@types/url-parse":"^1.4.3",bowser:"^2.7.0",debug:"^4.1.1","js-cookie":"^2.2.1","mediasoup-client":"3.6.26","protoo-client":"^4.0.3",redux:"^4.0.4","redux-logger":"^3.0.6","redux-thunk":"^2.3.0","url-parse":"^1.4.7",wildemitter:"^1.2.1"},devDependencies:{"@babel/cli":"7.8.3","@babel/core":"^7.7.4","@babel/plugin-proposal-class-properties":"^7.8.3","@babel/plugin-proposal-object-rest-spread":"^7.7.4","@babel/plugin-transform-runtime":"^7.7.4","@babel/preset-env":"^7.7.4","@babel/preset-react":"^7.7.4","@babel/preset-typescript":"^7.9.0","@babel/runtime":"^7.8.4","babel-minify":"^0.5.1","babel-plugin-jsx-control-statements":"^4.0.0","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-object-rest-spread":"^6.26.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-es2015":"^6.16.0","babel-preset-minify":"^0.4.3",babelify:"^10.0.0","browser-sync":"^2.26.7",browserify:"^16.5.0",del:"^5.1.0",envify:"^4.1.0",eslint:"^6.7.2","eslint-plugin-import":"^2.18.2","eslint-plugin-jsx-control-statements":"^2.2.1","eslint-plugin-react":"^7.17.0",mkdirp:"^0.5.1",ncp:"^2.0.0",nib:"^1.1.2","supports-color":"^7.1.0","uglify-js":"^3.7.6","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0",watchify:"^3.11.1"}}},{}]},{},[8])(8)});